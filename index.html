<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ“‹ PV RÃ‰UNION / RÃ‰PÃ‰TITION TOURNÃ‰E NY AKO 2026</title>
    <style>
        :root {
            --primary-color: #2980b9;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --text-color: #2c3e50;
            --border-radius: 8px;
            --box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            --orange-color: #FF8C00;
            --orange-dark: #FF7A00;
            --apple-green: #4CAF50;
            --apple-green-dark: #45a049;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #f5f7fa;
            padding: 20px;
            background-image: linear-gradient(rgba(255,255,255,0.9), rgba(255,255,255,0.9)), url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path fill="%23e8f5e8" d="M50 20 Q60 10 70 20 Q80 30 70 40 Q60 50 50 40 Q40 30 50 20 Z"/><path fill="%23d4edda" d="M30 60 Q40 50 50 60 Q60 70 50 80 Q40 90 30 80 Q20 70 30 60 Z"/><path fill="%23c8e6c9" d="M70 60 Q80 50 90 60 Q100 70 90 80 Q80 90 70 80 Q60 70 70 60 Z"/></svg>');
            background-size: 200px 200px;
            padding-top: 80px;
        }
        
        /* CONTENEUR PRINCIPAL AVEC DISPOSITION FLEX POUR ORDINATEUR */
        .main-container {
            display: flex;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* PANEL LATÃ‰RAL GAUCHE - 40% - UNIQUEMENT SUR ORDINATEUR */
        .side-panel {
            flex: 0 0 40%;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
            position: sticky;
            top: 100px;
            display: none; /* MasquÃ© par dÃ©faut, affichÃ© uniquement sur ordinateur */
        }
        
        /* CONTENU PRINCIPAL - 60% */
        .main-content {
            flex: 0 0 60%;
            min-width: 0; /* Important pour le flex-shrink */
        }
        
        /* Pour les Ã©crans larges (mode ordinateur) */
        @media (min-width: 1024px) {
            .side-panel {
                display: block;
            }
            
            .main-content {
                flex: 0 0 60%;
            }
            
            /* Cacher les Ã©lÃ©ments de recherche mobile en vue ordinateur */
            .mobile-search-section {
                display: none !important;
            }
            
            /* Section export dans le panneau latÃ©ral */
            .side-panel .export-section {
                margin-top: 30px;
                margin-bottom: 10px;
            }
            
            /* Masquer la section export du contenu principal en vue ordi */
            .main-content .export-section {
                display: none;
            }
        }
        
        /* Pour les tablettes et mobiles - cacher le panneau latÃ©ral */
        @media (max-width: 1023px) {
            .side-panel {
                display: none;
            }
            
            .main-content {
                flex: 1;
                width: 100%;
            }
            
            .main-container {
                flex-direction: column;
            }
            
            /* Afficher la section de recherche mobile */
            .mobile-search-section {
                display: block;
            }
            
            /* Afficher la section export dans le contenu principal en mobile */
            .main-content .export-section {
                display: block;
            }
        }
        
        /* VUE MOBILE - CONTENU ORGANISÃ‰ COMME LE PANEL LATÃ‰RAL */
        .mobile-search-section {
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 25px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* HEADER MODERNE ET ATTRACTIF - FONDS VERT POMME */
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--apple-green) 0%, var(--apple-green-dark) 100%);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
            overflow: hidden;
            border: none;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200"><path fill="%234CAF50" opacity="0.1" d="M100 40 Q120 20 140 40 Q160 60 140 80 Q120 100 100 80 Q80 60 100 40 Z"/><path fill="%2345a049" opacity="0.1" d="M60 120 Q80 100 100 120 Q120 140 100 160 Q80 180 60 160 Q40 140 60 120 Z"/><path fill="%233d8b40" opacity="0.1" d="M140 120 Q160 100 180 120 Q200 140 180 160 Q160 180 140 160 Q120 140 140 120 Z"/></svg>'), 
                          linear-gradient(135deg, var(--apple-green) 0%, var(--apple-green-dark) 100%);
            background-size: 200px 200px, cover;
            background-position: center;
        }
        
        .header-content {
            position: relative;
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .header-icons {
            display: flex;
            gap: 10px;
            font-size: 1.5em;
        }
        
        .header-icons span {
            animation: float 3s ease-in-out infinite;
        }
        
        .header-icons span:nth-child(1) { animation-delay: 0s; }
        .header-icons span:nth-child(2) { animation-delay: 0.5s; }
        .header-icons span:nth-child(3) { animation-delay: 1s; }
        .header-icons span:nth-child(4) { animation-delay: 1.5s; }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }
        
        h1 {
            color: white;
            margin: 0;
            font-size: 1.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .header-tagline {
            color: #e8f5e9;
            font-size: 0.85em;
            font-weight: 400;
            margin-top: 5px;
            position: relative;
            z-index: 1;
            opacity: 0.9;
            font-style: italic;
        }
        
        @media (max-width: 768px) {
            header {
                padding: 10px 15px;
                margin-bottom: 15px;
            }
            
            h1 {
                font-size: 1.2em;
            }
            
            .header-tagline {
                font-size: 0.75em;
            }
            
            .header-icons {
                font-size: 1.2em;
            }
        }
        
        /* Section export en fin de page */
        .export-section {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin: 30px 0;
            position: relative;
        }
        
        .export-section.locked::before {
            content: "ðŸ”’";
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2em;
            opacity: 0.7;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .export-btn {
            background: var(--apple-green);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.95em;
        }
        
        .export-btn:hover:not(:disabled) {
            background: var(--apple-green-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .export-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .export-btn.email {
            background: var(--accent-color);
        }
        
        .export-btn.email:hover:not(:disabled) {
            background: #c0392b;
        }
        
        .export-btn.all {
            background: var(--primary-color);
        }
        
        .export-btn.all:hover:not(:disabled) {
            background: #1a5276;
        }
        
        /* Modal pour l'export de dates sÃ©lectionnÃ©es */
        .export-dates-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .export-dates-content {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .export-dates-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            margin: 15px 0;
            padding: 10px;
        }
        
        .export-date-item {
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .export-date-item:last-child {
            border-bottom: none;
        }
        
        .export-date-checkbox {
            width: 20px;
            height: 20px;
        }
        
        .export-date-label {
            flex: 1;
            cursor: pointer;
        }
        
        /* STATISTIQUES - NOUVELLE TAILLE COMPACTE */
        .stats-section {
            display: flex;
            gap: 8px;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow-x: auto;
            white-space: nowrap;
            justify-content: space-between;
            align-items: center;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 8px 10px;
            border-radius: 6px;
            text-align: center;
            border-left: 3px solid var(--primary-color);
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 60px;
        }
        
        .stat-value {
            font-size: 1.4em;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 2px;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.75em;
            line-height: 1.2;
        }
        
        @media (max-width: 768px) {
            .stats-section {
                gap: 5px;
                padding: 8px;
                margin: 8px 0;
            }
            
            .stat-card {
                padding: 5px 6px;
                height: 50px;
                border-left: 2px solid var(--primary-color);
            }
            
            .stat-value {
                font-size: 1.1em;
                margin-bottom: 1px;
            }
            
            .stat-label {
                font-size: 0.65em;
            }
            
            .export-buttons {
                flex-direction: column;
            }
            
            .export-btn {
                min-width: auto;
                width: 100%;
                padding: 10px 15px;
                font-size: 0.9em;
            }
        }
        
        @media (max-width: 480px) {
            .stats-section {
                gap: 4px;
                padding: 6px;
            }
            
            .stat-card {
                padding: 4px 5px;
                height: 45px;
            }
            
            .stat-value {
                font-size: 1em;
            }
            
            .stat-label {
                font-size: 0.6em;
            }
        }
        
        /* BOUTONS DE FILTRE ORANGE */
        .filter-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            color: white;
            font-weight: bold;
            min-width: auto;
            flex: 1;
            background-color: var(--orange-color);
            border: none;
            padding: 12px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 0.9em;
        }
        
        .filter-btn:hover {
            background-color: var(--orange-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        @media (max-width: 768px) {
            .filter-buttons {
                flex-direction: row;
                gap: 8px;
                margin: 10px 0;
            }
            
            .filter-btn {
                flex: 1;
                min-width: 120px;
                padding: 8px 6px;
                font-size: 0.8em;
            }
        }
        
        /* BOUTONS DE DATES DISPONIBLES EN ROUGE - TAILLE REDUITE */
        .date-button {
            background: linear-gradient(135deg, #ff6b6b 0%, #e74c3c 100%) !important;
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.85em;
            box-shadow: 0 1px 4px rgba(231, 76, 60, 0.3);
            min-width: 120px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }
        
        .date-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(231, 76, 60, 0.4);
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%) !important;
        }
        
        .date-button:active {
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(231, 76, 60, 0.3);
        }
        
        .date-button i {
            font-size: 0.9em;
        }
        
        /* Pour les Ã©crans larges (mode ordinateur) */
        @media (min-width: 769px) {
            .available-dates-container.mobile-dates-above {
                display: none;
            }
            
            .available-dates-desktop {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                margin: 20px 0;
                padding: 12px;
                background: rgba(255, 245, 245, 0.7);
                border-radius: var(--border-radius);
                border: 1px solid #ffcccc;
                position: relative;
            }
            
            .available-dates-desktop::before {
                content: "ðŸ“… Dates disponibles";
                position: absolute;
                top: -25px;
                left: 0;
                font-weight: bold;
                font-size: 1em;
                color: var(--secondary-color);
                width: 100%;
                padding-bottom: 5px;
                border-bottom: 2px solid #ff6b6b;
            }
            
            .available-dates-desktop .date-button {
                min-width: 130px;
                padding: 7px 12px;
                font-size: 0.85em;
                margin: 0;
                flex: 0 0 auto;
            }
            
            .available-dates-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 10px;
                width: 100%;
            }
        }
        
        /* Pour les Ã©crans mobiles - NOUVELLE TAILLE REDUITE */
        @media (max-width: 768px) {
            .dates-buttons {
                gap: 8px;
                justify-content: center;
                padding: 8px;
                background: rgba(255, 245, 245, 0.7);
                border-radius: var(--border-radius);
                border: 1px solid #ffcccc;
                margin-top: 8px;
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            }
            
            .date-button {
                min-width: 120px;
                padding: 6px 10px;
                font-size: 0.8em;
                margin: 0;
                flex: 1 1 auto;
                max-width: 140px;
            }
            
            .available-dates-desktop {
                display: none;
            }
        }
        
        /* Petits Ã©crans (tÃ©lÃ©phones trÃ¨s petits) */
        @media (max-width: 480px) {
            .date-button {
                min-width: 100px;
                padding: 5px 8px;
                font-size: 0.75em;
                max-width: 120px;
                border-radius: 14px;
            }
            
            .dates-buttons {
                grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
                gap: 6px;
                padding: 6px;
            }
        }
        
        /* DATES DISPONIBLES EN BOUTONS VERT POMME - POUR MOBILE */
        .available-dates-container {
            margin: 15px 0;
        }
        
        .dates-title {
            color: var(--text-color);
            margin-bottom: 10px;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .dates-title i {
            color: #e74c3c;
        }
        
        .dates-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        /* CALENDRIER AVEC INFOS DE LIEU ET NOMBRE DE PERSONNES */
        .calendar-day.has-data {
            position: relative;
            min-height: 80px !important;
        }
        
        .calendar-day-info {
            position: absolute;
            bottom: 2px;
            left: 0;
            right: 0;
            font-size: 8px !important;
            line-height: 1.2;
            color: #666;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 2px 3px;
            border-radius: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-align: center;
            font-weight: normal;
            display: flex;
            flex-direction: column;
            gap: 1px;
        }
        
        .calendar-day-location {
            font-weight: bold;
            color: #2980b9;
            font-size: 8px;
        }
        
        .calendar-day-participants {
            color: var(--apple-green);
            font-size: 9px !important;
            font-weight: bold;
        }
        
        .calendar-day.has-data .calendar-day-info {
            display: flex;
        }
        
        /* RESTE DU CSS */
        .search-form {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: flex-end;
            margin-bottom: 15px;
        }
        
        .form-group {
            flex: 1;
            min-width: 250px;
            position: relative;
        }
        
        .calendar-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .calendar-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .calendar-nav {
            display: flex;
            gap: 8px;
        }
        
        .calendar {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 12px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }
        
        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            padding: 6px;
            background-color: var(--light-color);
            border-radius: 4px;
            font-size: 13px;
        }
        
        .calendar-day {
            text-align: center;
            padding: 8px 4px;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.2s;
            position: relative;
            min-height: 80px;
            font-size: 13px;
        }
        
        .calendar-day:hover {
            background-color: var(--light-color);
        }
        
        .calendar-day.selected {
            background-color: var(--primary-color);
            color: white;
        }
        
        .calendar-day.has-data {
            font-weight: bold;
        }
        
        .calendar-day.has-data::after {
            content: '';
            position: absolute;
            top: 2px;
            right: 2px;
            width: 5px;
            height: 5px;
            background-color: var(--accent-color);
            border-radius: 50%;
        }
        
        .calendar-day.other-month {
            color: #ccc;
        }
        
        .date-picker {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 12px;
        }
        
        .date-input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .date-input-group input {
            flex: 1;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--secondary-color);
            font-size: 0.95em;
        }
        
        input, select, button, textarea {
            padding: 10px;
            font-size: 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            width: 100%;
        }
        
        button {
            background-color: #7f8c8d;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
            min-width: 150px;
        }
        
        button:hover {
            background-color: #6c7a7d;
        }
        
        button.secondary {
            background-color: #95a5a6;
        }
        
        button.secondary:hover {
            background-color: #7f8c8d;
        }
        
        .suggestions-container {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            max-height: 180px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        
        .suggestion-item {
            padding: 8px 10px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
            font-size: 0.9em;
        }
        
        .suggestion-item:hover {
            background-color: var(--light-color);
        }
        
        .suggestion-item.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .suggestion-item:last-child {
            border-bottom: none;
        }
        
        .suggestion-highlight {
            color: var(--accent-color);
            font-weight: bold;
        }
        
        .suggestion-item.active .suggestion-highlight {
            color: white;
        }
        
        .results-section {
            display: none;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }
        
        .result-header {
            background-color: var(--secondary-color);
            color: white;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .result-content {
            padding: 15px;
        }
        
        .pv-item {
            margin-bottom: 30px;
            border: 1px solid #e1e1e1;
            border-radius: var(--border-radius);
            overflow: hidden;
        }
        
        /* TITRE DE FICHE */
        .pv-header {
            background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 50%, #c8e6c9 100%);
            color: #2e7d32;
            padding: 12px 15px;
            border-bottom: 2px solid #4CAF50;
            position: relative;
            overflow: hidden;
            min-height: 70px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .pv-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 120 120"><path fill="%234CAF50" opacity="0.08" d="M20 20 L40 10 L60 20 L80 10 L100 20 L100 40 L90 60 L100 80 L80 90 L60 100 L40 90 L20 80 L10 60 L20 40 Z M30 50 Q40 40 50 50 Q60 60 50 70 Q40 80 30 70 Q20 60 30 50 Z M70 50 Q80 40 90 50 Q100 60 90 70 Q80 80 70 70 Q60 60 70 50 Z"/></svg>');
            background-size: 120px 120px;
            background-position: right 10px center;
            opacity: 0.3;
        }
        
        .pv-title {
            color: #2e7d32;
            font-weight: bold;
            margin-top: 0;
            font-size: 1.2em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1;
            line-height: 1.3;
        }
        
        /* STYLE POUR LE NOMBRE DE PERSONNES DANS LE TITRE */
        .participant-count {
            font-size: 0.7em;
            color: var(--apple-green) !important;
            background: rgba(255,255,255,0.3);
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 8px;
            font-weight: bold;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            text-align: left;
            padding: 10px;
            width: 20%;
            background: var(--light-color);
            color: var(--primary-color);
            font-weight: bold;
            font-size: 13px;
            vertical-align: top;
            white-space: normal;
            word-wrap: break-word;
            border-bottom: 1px solid #ddd;
        }
        
        .data-table td {
            padding: 10px;
            font-size: 14px;
            color: var(--text-color);
            white-space: pre-wrap;
            border-bottom: 1px solid #ddd;
        }
        
        .data-table tr:nth-child(even) td {
            background: #f9f9f9;
        }
        
        .data-table img {
            max-width: 95%;
            max-height: 200px;
            display: block;
            margin: 5px auto;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .data-table a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: bold;
            padding: 6px 10px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #e9ecef;
            display: inline-block;
            transition: all 0.3s ease;
        }
        
        .data-table a:hover {
            background: var(--primary-color);
            color: white;
            text-decoration: none;
            transform: translateY(-2px);
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }
        
        .highlight {
            background-color: #fff3cd;
            padding: 1px 3px;
            border-radius: 3px;
            font-weight: bold;
        }

        .search-highlight {
            background-color: #ffeb3b !important;
            padding: 1px 3px;
            border-radius: 3px;
            font-weight: bold;
            color: #333 !important;
        }
        
        .no-results {
            text-align: center;
            padding: 30px;
            color: #7f8c8d;
        }
        
        .loading {
            text-align: center;
            padding: 15px;
            display: none;
        }
        
        .spinner {
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary-color);
            border-radius: 50%;
            width: 25px;
            height: 25px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        .success-message {
            background-color: #27ae60;
            color: white;
            padding: 12px;
            border-radius: 5px;
            margin: 8px 0;
            text-align: center;
            font-size: 0.9em;
        }
        
        .error-message {
            background-color: #e74c3c;
            color: white;
            padding: 12px;
            border-radius: 5px;
            margin: 8px 0;
            text-align: center;
            font-size: 0.9em;
        }
        
        .search-stats {
            background: #e8f4fc;
            padding: 8px 12px;
            border-radius: var(--border-radius);
            margin-bottom: 15px;
            font-size: 13px;
        }

        /* MODAL POUR LES OPTIONS DE DATE */
        .date-options-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .date-options-content {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: 90%;
            max-width: 450px;
        }

        .date-options-title {
            margin-bottom: 15px;
            text-align: center;
            color: var(--secondary-color);
            font-size: 1.1em;
        }

        .date-options-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .date-option-btn {
            padding: 10px 12px;
            font-size: 13px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .date-option-btn.primary {
            background-color: #27ae60;
            color: white;
        }

        .date-option-btn.primary:hover {
            background-color: #219a52;
        }

        .date-option-btn.secondary {
            background-color: #3498db;
            color: white;
        }

        .date-option-btn.secondary:hover {
            background-color: #2980b9;
        }

        .date-option-btn.tertiary {
            background-color: #9b59b6;
            color: white;
        }

        .date-option-btn.tertiary:hover {
            background-color: #8e44ad;
        }

        .date-option-btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }

        .date-option-btn:disabled:hover {
            background-color: #bdc3c7;
        }

        .password-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .password-modal-content {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: 90%;
            max-width: 400px;
        }

        .password-input-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 15px 0;
        }

        .password-input-group input {
            padding: 12px;
            font-size: 16px;
            height: 48px;
            width: 100%;
        }

        .password-buttons {
            display: flex;
            gap: 8px;
        }

        .password-buttons button {
            flex: 1;
            height: 45px;
        }

        .show-links-btn {
            background-color: #e74c3c;
            margin: 8px 0;
            font-size: 0.9em;
        }

        .show-links-btn:hover {
            background-color: #c0392b;
        }

        #showAllButton {
            background-color: #27ae60;
            margin-top: 12px;
            font-size: 0.9em;
        }

        #showAllButton:hover {
            background-color: #219a52;
        }

        .protected-columns-info {
            background: #fff3cd;
            padding: 8px 12px;
            border-radius: var(--border-radius);
            margin: 8px 0;
            border-left: 3px solid #ffc107;
            font-size: 0.85em;
        }
        
        .title-culte {
            background-color: #FFE5B4 !important;
            color: #2c3e50 !important;
            font-weight: bold;
        }
        
        .title-fanamarihana {
            background-color: #FFB6C1 !important;
            color: #2c3e50 !important;
            font-weight: bold;
        }

        .title-fanamarihana-famerenana {
            background-color: #FFD700 !important;
            color: #2c3e50 !important;
            font-weight: bold;
        }
        
        .title-fanapahan-kevitra {
            background-color: #FFB6C1 !important;
            color: #2c3e50 !important;
            font-weight: bold;
        }
        
        .title-vaovao {
            background-color: #87CEEB !important;
            color: #2c3e50 !important;
            font-weight: bold;
        }
        
        .title-horodateur,
        .title-daty,
        .title-ora-fanombohana,
        .title-ora-firavana,
        .title-toerana {
            background-color: #87CEEB !important;
            color: #2c3e50 !important;
            font-weight: bold;
        }
        
        .title-ordre-jour,
        .title-fizotra,
        .title-resaka,
        .title-vaovao,
        .title-famaranana {
            background: linear-gradient(135deg, #d4edda 0%, #c8e6c9 50%, #a5d6a7 100%) !important;
            color: #1b5e20 !important;
            font-weight: bold;
            border-left: 3px solid #4CAF50 !important;
        }

        .title-fahatongavana {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 50%, #90caf9 100%) !important;
            color: #0d47a1 !important;
            font-weight: bold;
            border-left: 3px solid #2196F3 !important;
        }

        .fahatongavana-section {
            background: #f8fdff;
            border: 1px solid #e1f5fe;
            border-radius: 6px;
            padding: 8px 10px;
            margin: 6px 0;
        }

        .fahatongavana-row {
            display: flex;
            align-items: flex-start;
            margin-bottom: 3px;
            padding-bottom: 3px;
            line-height: 1.2;
            min-height: auto;
        }

        .fahatongavana-row:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .fahatongavana-label {
            font-weight: bold;
            min-width: 160px;
            color: #0277bd;
            padding-right: 12px;
            font-size: 12px;
        }

        .fahatongavana-value {
            flex: 1;
            font-weight: 500;
            font-size: 12px;
            line-height: 1.2;
        }

        .date-time-row {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .date-time-item {
            flex: 1;
            display: flex;
            align-items: flex-start;
            gap: 6px;
            padding: 8px;
            background: #f8fdff;
            border-radius: 5px;
            border: 1px solid #e1f5fe;
            min-width: 180px;
        }

        .date-time-item i {
            font-size: 14px;
            margin-top: 2px;
        }

        .date-time-label {
            font-weight: bold;
            color: #0277bd;
            font-size: 13px;
            margin-bottom: 2px;
        }

        .date-time-value {
            font-weight: 500;
            font-size: 14px;
            line-height: 1.2;
        }

        .ordre-du-jour-section {
            margin: 6px 0;
            line-height: 1.2;
        }

        .ordre-du-jour-item {
            margin-bottom: 3px;
            padding-left: 12px;
            font-size: 13px;
            line-height: 1.2;
        }

        .ordre-du-jour-item:last-child {
            margin-bottom: 0;
        }

        .section-title {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 50%, #90caf9 100%);
            color: #0d47a1;
            font-weight: bold;
            padding: 8px 10px;
            border-radius: 5px;
            margin: 12px 0 6px 0;
            border-left: 3px solid #2196F3;
            font-size: 14px;
        }
        
        .names-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin: 12px 0;
        }
        
        .name-tag {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 4px 8px;
            border-radius: 16px;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .name-tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }
        
        .stats-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .stats-modal-content {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: 90%;
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
        }
        
        /* BOUTONS FLOTTANTS - TOUS Ã€ 1CM DE HAUTEUR ET 1CM DE LARGEUR */
        .floating-buttons {
            position: fixed;
            right: 15px;
            bottom: 15px;
            z-index: 999;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        /* CLASSE DE BASE POUR TOUS LES BOUTONS FLOTTANTS */
        .floating-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 2px solid var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            cursor: pointer;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            text-decoration: none;
            position: relative;
            min-width: 40px;
            min-height: 40px;
            padding: 0;
            margin: 0;
        }
        
        /* SPÃ‰CIFIQUE POUR CHAQUE BOUTON */
        .floating-button.home {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
        }
        
        .floating-button.search {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
        }
        
        .floating-button.calendar {
            background: linear-gradient(135deg, #1abc9c, #16a085);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
        }
        
        .floating-button.list {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
        }
        
        .floating-button.lock {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
        }
        
        .floating-button.export {
            background: linear-gradient(135deg, var(--apple-green), var(--apple-green-dark));
            color: white;
            border: none;
            width: 40px;
            height: 40px;
        }
        
        .floating-button:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
        }
        
        .floating-button-tooltip {
            position: absolute;
            right: 55px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 11px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }
        
        .floating-button:hover .floating-button-tooltip {
            opacity: 1;
        }
        
        /* Graphique pour les statistiques */
        .progress-bar-container {
            width: 100%;
            background-color: #f0f0f0;
            border-radius: 8px;
            overflow: hidden;
            margin: 8px 0;
            height: 16px;
            position: relative;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 8px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 4px;
            color: white;
            font-size: 10px;
            font-weight: bold;
        }
        
        /* STYLE POUR LES CYLINDRES */
        .cylinder-chart-container {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin: 12px 0;
        }
        
        .cylinder-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .cylinder-label {
            min-width: 140px;
            font-weight: 500;
            font-size: 12px;
        }
        
        .cylinder-bar-container {
            flex: 1;
            height: 16px;
            background-color: #f0f0f0;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }
        
        .cylinder-bar {
            height: 100%;
            border-radius: 8px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 6px;
            color: white;
            font-size: 10px;
            font-weight: bold;
        }
        
        .cylinder-value {
            min-width: 45px;
            text-align: right;
            font-weight: bold;
            font-size: 12px;
        }
        
        .donut-chart {
            width: 100px;
            height: 100px;
            margin: 0 auto 12px;
            position: relative;
        }
        
        .donut-chart-svg {
            transform: rotate(-90deg);
        }
        
        .donut-chart-background {
            fill: none;
            stroke: #f0f0f0;
            stroke-width: 8;
        }
        
        .donut-chart-foreground {
            fill: none;
            stroke: #4CAF50;
            stroke-width: 8;
            stroke-linecap: round;
            stroke-dasharray: 314;
            stroke-dashoffset: 314;
            transition: stroke-dashoffset 1s ease;
        }
        
        .donut-chart-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .donut-chart-value {
            font-size: 20px;
            line-height: 1;
        }
        
        .donut-chart-label {
            font-size: 11px;
            color: #666;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .search-form {
                flex-direction: row;
                align-items: center;
            }
            
            .search-form .form-group {
                flex: 1;
                min-width: auto;
            }
            
            .search-form button {
                min-width: 45px;
                width: 45px;
                padding: 10px;
                background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ffffff" width="20px" height="20px"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>');
                background-repeat: no-repeat;
                background-position: center;
                background-size: 20px;
            }
            
            .search-form button span {
                display: none;
            }
            
            .calendar-container {
                flex-direction: column;
            }
            
            .data-table th, .data-table td {
                display: block;
                width: 100%;
            }
            
            .data-table th {
                background: var(--secondary-color);
                color: white;
                margin-top: 8px;
            }
            
            h1 {
                font-size: 1.5em;
            }
            
            .date-time-row {
                flex-direction: column;
                gap: 6px;
            }

            .date-time-item {
                min-width: auto;
            }

            .fahatongavana-row {
                flex-direction: column;
            }

            .fahatongavana-label {
                min-width: auto;
                margin-bottom: 2px;
                padding-right: 0;
            }

            .date-options-buttons {
                gap: 8px;
            }

            .date-option-btn {
                padding: 10px;
                font-size: 12px;
            }
            
            .floating-buttons {
                right: 10px;
                bottom: 10px;
            }
            
            .floating-button {
                width: 35px;
                height: 35px;
                font-size: 1em;
            }
            
            /* Calendrier mobile ajustements */
            .calendar-day {
                min-height: 60px;
                padding: 6px 2px;
                font-size: 11px;
            }
            
            .calendar-day-header {
                font-size: 11px;
                padding: 5px;
            }
            
            .calendar-day-info {
                font-size: 6px !important;
                bottom: 1px;
            }
            
            .available-dates-desktop {
                display: none;
            }
            
            .cylinder-label {
                min-width: 110px;
                font-size: 11px;
            }
            
            .cylinder-value {
                min-width: 35px;
                font-size: 11px;
            }
            
            .names-list {
                gap: 4px;
                margin: 8px 0;
            }
            
            .name-tag {
                padding: 3px 6px;
                font-size: 0.75em;
                border-radius: 14px;
            }
            
            .pv-header {
                padding: 10px 12px;
                min-height: 60px;
            }
            
            .pv-title {
                font-size: 1em;
            }
            
            .participant-count {
                font-size: 0.65em;
                padding: 1px 6px;
                margin-left: 6px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="header-icons">
                <span>ðŸ“‹</span>
                <span>ðŸŽµ</span>
                <span>ðŸ“…</span>
                <span>ðŸŽ¤</span>
            </div>
            <div>
                <h1>PV RÃ‰UNION / RÃ‰PÃ‰TITION TOURNÃ‰E NY AKO 2026</h1>
                <div class="header-tagline">Agenda musical â€¢ Calendrier des rÃ©unions â€¢ Gestion des PV</div>
            </div>
        </div>
    </header>
    
    <!-- VUE MOBILE - ORGANISÃ‰E COMME LE PANEL LATÃ‰RAL GAUCHE -->
    <div class="mobile-search-section">
        <form id="searchForm" class="search-form" autocomplete="off">
            <div class="form-group">
                <label for="searchText">Rechercher un mot ou une phrase :</label>
                <input type="text" id="searchText" placeholder="Entrez votre recherche..." autocomplete="off">
                <div class="suggestions-container" id="suggestionsContainer">
                    <!-- Les suggestions dynamiques apparaÃ®tront ici -->
                </div>
            </div>
            
            <div class="form-group">
                <button type="submit"><span>ðŸ” Rechercher</span></button>
            </div>
        </form>
        
        <!-- Section Statistiques - TAILLE REDUITE -->
        <div class="stats-section" id="statsSection">
            <div class="stat-card">
                <div class="stat-value" id="totalPV">0</div>
                <div class="stat-label">Total PV</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="toeranaStats">0</div>
                <div class="stat-label">Lieux diffÃ©rents</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalParticipants">0</div>
                <div class="stat-label">Participants uniques</div>
            </div>
        </div>
        
        <!-- Section Dates disponibles en boutons - Position mobile -->
        <div class="available-dates-container mobile-dates-above" id="availableDatesContainer" style="display: none;">
            <h3 class="dates-title" style="color: #e74c3c; border-bottom: 2px solid #ff6b6b; padding-bottom: 6px;">
                <i>ðŸ“…</i> Dates disponibles
                <span style="font-size: 0.75em; color: #666; margin-left: 8px;" id="datesCount"></span>
            </h3>
            <div class="dates-buttons" id="datesButtons">
                <!-- Les boutons de dates seront gÃ©nÃ©rÃ©s ici -->
            </div>
        </div>
        
        <!-- Section Dates disponibles en mode ordinateur -->
        <div class="available-dates-desktop" id="availableDatesDesktop" style="display: none;">
            <!-- Les boutons de dates seront gÃ©nÃ©rÃ©s ici -->
        </div>
        
        <!-- Liste des noms -->
        <div id="namesListContainer" style="display: none;">
            <h3>ðŸ‘¤ Liste des participants</h3>
            <div class="names-list" id="namesList"></div>
        </div>
        
        <!-- Liste des lieux -->
        <div id="toeranaListContainer" style="display: none;">
            <h3>ðŸ“ RÃ©unions par lieu</h3>
            <div id="toeranaList"></div>
        </div>
        
        <!-- Boutons de filtre orange -->
        <div class="filter-buttons">
            <button id="showFanamarihanaButton" class="filter-btn">
                ðŸ“ Fanamarihana Famerenana
            </button>
            <button id="showFanapahanKevitraButton" class="filter-btn">
                ðŸ“‹ Fanapahan-kevitra & Asa
            </button>
            <button id="showVaovaoButton" class="filter-btn">
                ðŸ“¢ Vaovao
            </button>
        </div>
        
        <!-- Section calendrier uniquement -->
        <div class="calendar-container">
            <div class="calendar">
                <div class="calendar-header">
                    <button id="prevMonth" class="secondary">â—€</button>
                    <h3 id="currentMonth"></h3>
                    <button id="nextMonth" class="secondary">â–¶</button>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                    <!-- Le calendrier sera gÃ©nÃ©rÃ© ici -->
                </div>
            </div>
            
            <div class="date-picker" id="desktopDateList">
                <h3>SÃ©lection directe par date</h3>
                <div class="date-input-group">
                    <input type="date" id="dateInput">
                    <button id="goToDate">Aller</button>
                </div>
            </div>
        </div>
        
        <button id="showAllButton">
            ðŸ“‹ Afficher tous les PV
        </button>

        <button id="showLinksButton" class="show-links-btn" style="margin-top: 10px;">
            ðŸ”— Admin - Afficher les colonnes protÃ©gÃ©es
        </button>
        
        <button id="retryButton" style="margin-top: 10px; display: none;">
            ðŸ”„ RÃ©essayer le chargement
        </button>
    </div>
    
    <!-- CONTENEUR PRINCIPAL AVEC DISPOSITION FLEX -->
    <div class="main-container">
        <!-- PANEL LATÃ‰RAL GAUCHE (40%) - UNIQUEMENT SUR ORDINATEUR -->
        <div class="side-panel">
            <section class="search-section">
                <form id="searchFormDesktop" class="search-form" autocomplete="off">
                    <div class="form-group">
                        <label for="searchTextDesktop">Rechercher un mot ou une phrase :</label>
                        <input type="text" id="searchTextDesktop" placeholder="Entrez votre recherche..." autocomplete="off">
                        <div class="suggestions-container" id="suggestionsContainerDesktop">
                            <!-- Les suggestions dynamiques apparaÃ®tront ici -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <button type="submit"><span>ðŸ” Rechercher</span></button>
                    </div>
                </form>
                
                <!-- Section Statistiques - TAILLE REDUITE -->
                <div class="stats-section" id="statsSectionDesktop">
                    <div class="stat-card">
                        <div class="stat-value" id="totalPVDesktop">0</div>
                        <div class="stat-label">Total PV</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="toeranaStatsDesktop">0</div>
                        <div class="stat-label">Lieux diffÃ©rents</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalParticipantsDesktop">0</div>
                        <div class="stat-label">Participants uniques</div>
                    </div>
                </div>
                
                <!-- Section Dates disponibles en mode ordinateur -->
                <div class="available-dates-desktop" id="availableDatesDesktopSide" style="display: none;">
                    <!-- Les boutons de dates seront gÃ©nÃ©rÃ©s ici -->
                </div>
                
                <!-- Liste des noms -->
                <div id="namesListContainerDesktop" style="display: none;">
                    <h3>ðŸ‘¤ Liste des participants</h3>
                    <div class="names-list" id="namesListDesktop"></div>
                </div>
                
                <!-- Liste des lieux -->
                <div id="toeranaListContainerDesktop" style="display: none;">
                    <h3>ðŸ“ RÃ©unions par lieu</h3>
                    <div id="toeranaListDesktop"></div>
                </div>
                
                <!-- Boutons de filtre orange -->
                <div class="filter-buttons">
                    <button id="showFanamarihanaButtonDesktop" class="filter-btn">
                        ðŸ“ Fanamarihana Famerenana
                    </button>
                    <button id="showFanapahanKevitraButtonDesktop" class="filter-btn">
                        ðŸ“‹ Fanapahan-kevitra & Asa
                    </button>
                    <button id="showVaovaoButtonDesktop" class="filter-btn">
                        ðŸ“¢ Vaovao
                    </button>
                </div>
                
                <!-- Section calendrier uniquement -->
                <div class="calendar-container">
                    <div class="calendar">
                        <div class="calendar-header">
                            <button id="prevMonthDesktop" class="secondary">â—€</button>
                            <h3 id="currentMonthDesktop"></h3>
                            <button id="nextMonthDesktop" class="secondary">â–¶</button>
                        </div>
                        <div class="calendar-grid" id="calendarGridDesktop">
                            <!-- Le calendrier sera gÃ©nÃ©rÃ© ici -->
                        </div>
                    </div>
                    
                    <div class="date-picker" id="desktopDateListSide">
                        <h3>SÃ©lection directe par date</h3>
                        <div class="date-input-group">
                            <input type="date" id="dateInputDesktop">
                            <button id="goToDateDesktop">Aller</button>
                        </div>
                    </div>
                </div>
                
                <button id="showAllButtonDesktop">
                    ðŸ“‹ Afficher tous les PV
                </button>

                <button id="showLinksButtonDesktop" class="show-links-btn" style="margin-top: 10px;">
                    ðŸ”— Admin - Afficher les colonnes protÃ©gÃ©es
                </button>
                
                <!-- SECTION EXPORT DANS LE PANEL LATÃ‰RAL (EN BAS) -->
                <section class="export-section locked" id="exportSectionSide">
                    <h3>ðŸ“¤ Export des donnÃ©es <small style="color: #e74c3c; font-size: 0.75em;">(AccÃ¨s admin requis)</small></h3>
                    <div class="export-buttons">
                        <button class="export-btn" id="exportSelectedSide" disabled>
                            <span>ðŸ“…</span> Exporter par sÃ©lection de dates
                        </button>
                        <button class="export-btn all" id="exportAllSide" disabled>
                            <span>ðŸ“Š</span> Exporter toutes les donnÃ©es
                        </button>
                        <button class="export-btn email" id="sendEmailSide" disabled>
                            <span>ðŸ“§</span> Envoyer rapport par email
                        </button>
                    </div>
                </section>
                
                <button id="retryButtonDesktop" style="margin-top: 10px; display: none;">
                    ðŸ”„ RÃ©essayer le chargement
                </button>
            </section>
        </div>
        
        <!-- CONTENU PRINCIPAL (60%) -->
        <div class="main-content">
            <div class="loading" id="loadingIndicator">
                <div class="spinner"></div>
                <p>Chargement des donnÃ©es depuis Google Sheets...</p>
            </div>

            <div id="dataInfo" style="display: none;"></div>
            
            <section class="results-section" id="resultsSection">
                <div class="result-header">
                    <h2 id="resultTitle">RÃ©sultats de la recherche</h2>
                    <button id="closeResults">âœ• Fermer</button>
                </div>
                <div class="result-content" id="resultContent">
                    <!-- Les rÃ©sultats seront affichÃ©s ici -->
                </div>
            </section>

            <!-- Section export en fin de page (VISIBLE UNIQUEMENT EN MOBILE) -->
            <section class="export-section locked" id="exportSection">
                <h3>ðŸ“¤ Export des donnÃ©es <small style="color: #e74c3c; font-size: 0.75em;">(AccÃ¨s admin requis)</small></h3>
                <div class="export-buttons">
                    <button class="export-btn" id="exportSelected" disabled>
                        <span>ðŸ“…</span> Exporter par sÃ©lection de dates
                    </button>
                    <button class="export-btn all" id="exportAll" disabled>
                        <span>ðŸ“Š</span> Exporter toutes les donnÃ©es
                    </button>
                    <button class="export-btn email" id="sendEmail" disabled>
                        <span>ðŸ“§</span> Envoyer rapport par email
                    </button>
                </div>
            </section>

            <!-- Modal pour les options de date -->
            <div class="date-options-modal" id="dateOptionsModal">
                <div class="date-options-content">
                    <h3 class="date-options-title" id="dateOptionsTitle">Options pour la date sÃ©lectionnÃ©e</h3>
                    <div class="date-options-buttons" id="dateOptionsButtons">
                        <!-- Les boutons d'options seront gÃ©nÃ©rÃ©s dynamiquement ici -->
                    </div>
                </div>
            </div>

            <!-- Modal pour le mot de passe -->
            <div class="password-modal" id="passwordModal">
                <div class="password-modal-content">
                    <h3>ðŸ”‘ Admin - AccÃ¨s aux colonnes protÃ©gÃ©es</h3>
                    <p>Veuillez entrer le mot de passe pour afficher les colonnes protÃ©gÃ©es :</p>
                    <div class="password-input-group">
                        <input type="password" id="passwordInput" placeholder="Entrez le mot de passe ici">
                        <div class="password-buttons">
                            <button id="submitPassword">Valider</button>
                            <button id="cancelPassword" class="secondary">Annuler</button>
                        </div>
                    </div>
                    <div id="passwordError" style="color: #e74c3c; margin-top: 10px; display: none;">
                        Mot de passe incorrect
                    </div>
                </div>
            </div>
            
            <!-- Modal pour les statistiques des noms -->
            <div class="stats-modal" id="statsModal">
                <div class="stats-modal-content">
                    <h3 id="statsModalTitle">Statistiques</h3>
                    <div id="statsModalContent"></div>
                    <button id="closeStatsModal" class="secondary" style="margin-top: 20px; width: 100%;">Fermer</button>
                </div>
            </div>

            <!-- Modal pour l'export de dates sÃ©lectionnÃ©es -->
            <div class="export-dates-modal" id="exportDatesModal">
                <div class="export-dates-content">
                    <h3>ðŸ“… SÃ©lection des dates Ã  exporter</h3>
                    <p>SÃ©lectionnez les dates que vous souhaitez exporter :</p>
                    
                    <div class="export-dates-list" id="exportDatesList">
                        <!-- Les dates seront ajoutÃ©es ici dynamiquement -->
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <label>
                            <input type="checkbox" id="selectAllDates">
                            SÃ©lectionner toutes les dates
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label for="exportFormatSelect">Format d'export :</label>
                        <select id="exportFormatSelect">
                            <option value="csv">CSV (Tableur)</option>
                            <option value="excel">Excel (XLSX)</option>
                            <option value="pdf">PDF (Rapport)</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button id="cancelExportDates" class="secondary" style="flex: 1;">Annuler</button>
                        <button id="confirmExportDates" class="primary" style="flex: 1; background: var(--apple-green);">Exporter</button>
                    </div>
                </div>
            </div>

            <!-- Modal pour l'envoi par email avec sÃ©lection de PV -->
            <div class="export-dates-modal" id="emailExportModal">
                <div class="export-dates-content">
                    <h3>ðŸ“§ Envoyer le rapport par email</h3>
                    <p>SÃ©lectionnez les PV que vous souhaitez envoyer :</p>
                    
                    <div class="export-dates-list" id="emailPVList">
                        <!-- Les PV seront ajoutÃ©s ici dynamiquement -->
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <label>
                            <input type="checkbox" id="selectAllPVs">
                            SÃ©lectionner tous les PV
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label for="emailRecipients">Destinataires :</label>
                        <textarea id="emailRecipients" placeholder="exemple1@gmail.com, exemple2@hotmail.com, exemple3@yahoo.com" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="emailSubject">Sujet :</label>
                        <input type="text" id="emailSubject" value="Rapport PV - TournÃ©e NY AKO 2026">
                    </div>
                    
                    <div class="form-group">
                        <label for="emailMessage">Message :</label>
                        <textarea id="emailMessage" rows="4" placeholder="Message accompagnant le rapport..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="emailFormatSelect">Format du rapport :</label>
                        <select id="emailFormatSelect">
                            <option value="pdf">PDF (Rapport complet)</option>
                            <option value="csv">CSV (DonnÃ©es brutes)</option>
                            <option value="excel">Excel (Tableur)</option>
                        </select>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <label>
                            <input type="checkbox" id="includePVContent" checked>
                            Inclure le contenu des PV dans le message
                        </label>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button id="cancelEmailExport" class="secondary" style="flex: 1;">Annuler</button>
                        <button id="confirmEmailExport" class="primary" style="flex: 1; background: var(--accent-color);">Envoyer</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Boutons flottants AVEC bouton calendrier AJOUTE -->
    <div class="floating-buttons">
        <a href="#" class="floating-button home" id="floatingHome" title="Accueil">
            ðŸ 
            <span class="floating-button-tooltip">Accueil</span>
        </a>
        <a href="#" class="floating-button search" id="floatingSearch" title="Recherche">
            ðŸ”
            <span class="floating-button-tooltip">Recherche</span>
        </a>
        <a href="#" class="floating-button calendar" id="floatingCalendar" title="Calendrier">
            ðŸ“…
            <span class="floating-button-tooltip">Calendrier</span>
        </a>
        <a href="#" class="floating-button list" id="floatingList" title="Tous les PV">
            ðŸ“‹
            <span class="floating-button-tooltip">Tous les PV</span>
        </a>
        <a href="#" class="floating-button lock" id="floatingLock" title="Admin">
            ðŸ”“
            <span class="floating-button-tooltip">Admin</span>
        </a>
        <a href="#" class="floating-button export" id="floatingExport" title="Export">
            ðŸ“¤
            <span class="floating-button-tooltip">Export</span>
        </a>
    </div>

    <script>
        const GOOGLE_SHEETS_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSXIJyclDLf2asT-FMnmaeWMSPtQHxpAC1wiGJ_xzXbl2StziwiUw9ElW9XyK5yemQ-PHaWlRQbtdHb/pub?gid=1509861479&single=true&output=csv';
        const PASSWORD = "admin";
        const GOOGLE_FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSdFwjo69WNzQlrGSI8GQUTP-M8_wXsEVc6T7JogUzoj1V-JlA/viewform?usp=header";
        
        let showProtectedColumns = false;
        const PROTECTED_COLUMNS = ['Rohy fiche'];
        
        let sheetData = [];
        let headers = [];
        let datesWithData = [];
        let currentDate = new Date();
        let selectedDate = null;
        let currentSearchTerm = '';
        let isAdminAuthenticated = false;
        
        // Variables pour les statistiques
        let allNames = new Set();
        let nameStatistics = {};
        let toeranaStats = {};
        let totalPV = 0;
        
        // MODIFICATION : Nouvelle variable pour suivre les PV par personne
        let pvCountByPerson = {};
        
        document.addEventListener('DOMContentLoaded', function() {
            // Initialisation des Ã©vÃ©nements pour la vue mobile
            initMobileView();
            
            // Initialisation des Ã©vÃ©nements pour la vue desktop
            initDesktopView();
            
            // Ã‰vÃ©nements communs
            document.getElementById('closeResults').addEventListener('click', closeResults);
            document.getElementById('retryButton').addEventListener('click', loadDataFromGoogleSheets);
            document.getElementById('submitPassword').addEventListener('click', checkPassword);
            document.getElementById('cancelPassword').addEventListener('click', hidePasswordModal);
            
            // Modal d'export de dates
            document.getElementById('cancelExportDates').addEventListener('click', hideExportDatesModal);
            document.getElementById('confirmExportDates').addEventListener('click', confirmExportDates);
            document.getElementById('selectAllDates').addEventListener('change', selectAllExportDates);
            
            // Modal d'email
            document.getElementById('cancelEmailExport').addEventListener('click', hideEmailExportModal);
            document.getElementById('confirmEmailExport').addEventListener('click', confirmEmailExport);
            document.getElementById('selectAllPVs').addEventListener('change', selectAllPVsForEmail);
            
            // Boutons flottants
            document.getElementById('floatingHome').addEventListener('click', function(e) {
                e.preventDefault();
                scrollToTop();
            });
            document.getElementById('floatingSearch').addEventListener('click', function(e) {
                e.preventDefault();
                if (window.innerWidth >= 1024) {
                    document.getElementById('searchTextDesktop').focus();
                } else {
                    document.getElementById('searchText').focus();
                }
            });
            document.getElementById('floatingCalendar').addEventListener('click', function(e) {
                e.preventDefault();
                scrollToCalendar();
            });
            document.getElementById('floatingList').addEventListener('click', function(e) {
                e.preventDefault();
                showAllData();
            });
            document.getElementById('floatingLock').addEventListener('click', function(e) {
                e.preventDefault();
                showPasswordModal();
            });
            document.getElementById('floatingExport').addEventListener('click', function(e) {
                e.preventDefault();
                if (isAdminAuthenticated) {
                    if (window.innerWidth >= 1024) {
                        // Scroll vers la section export dans le panneau latÃ©ral
                        document.getElementById('exportSectionSide').scrollIntoView({ behavior: 'smooth' });
                    } else {
                        // Scroll vers la section export dans le contenu principal
                        document.getElementById('exportSection').scrollIntoView({ behavior: 'smooth' });
                    }
                } else {
                    showPasswordModalForAction('export');
                }
            });
            
            // Statistiques
            document.getElementById('closeStatsModal').addEventListener('click', hideStatsModal);
            
            // Ajuster l'affichage des dates sur mobile
            adjustDateDisplay();
            window.addEventListener('resize', adjustDateDisplay);
            
            loadDataFromGoogleSheets();
        });

        function initMobileView() {
            const searchInput = document.getElementById('searchText');
            const suggestionsContainer = document.getElementById('suggestionsContainer');
            
            document.getElementById('searchForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleSearch(e, 'mobile');
            });
            
            document.getElementById('prevMonth').addEventListener('click', function() {
                prevMonth('mobile');
            });
            document.getElementById('nextMonth').addEventListener('click', function() {
                nextMonth('mobile');
            });
            document.getElementById('goToDate').addEventListener('click', function() {
                goToSelectedDate('mobile');
            });
            document.getElementById('showAllButton').addEventListener('click', showAllData);
            document.getElementById('showLinksButton').addEventListener('click', showPasswordModal);
            document.getElementById('retryButton').addEventListener('click', loadDataFromGoogleSheets);
            
            // Boutons de filtre mobile
            document.getElementById('showFanamarihanaButton').addEventListener('click', showFanamarihanaFamerenana);
            document.getElementById('showFanapahanKevitraButton').addEventListener('click', showFanapahanKevitra);
            document.getElementById('showVaovaoButton').addEventListener('click', showVaovao);
            
            // Boutons d'export mobile
            document.getElementById('exportSelected').addEventListener('click', showExportDatesModal);
            document.getElementById('exportAll').addEventListener('click', exportAllData);
            document.getElementById('sendEmail').addEventListener('click', showEmailExportModal);
            
            searchInput.addEventListener('input', function() {
                showSuggestions(this.value, 'mobile');
            });
            
            searchInput.addEventListener('focus', function() {
                if (this.value) {
                    showSuggestions(this.value, 'mobile');
                }
            });
            
            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !suggestionsContainer.contains(e.target)) {
                    suggestionsContainer.style.display = 'none';
                }
            });
        }
        
        function initDesktopView() {
            const searchInputDesktop = document.getElementById('searchTextDesktop');
            const suggestionsContainerDesktop = document.getElementById('suggestionsContainerDesktop');
            
            document.getElementById('searchFormDesktop').addEventListener('submit', function(e) {
                e.preventDefault();
                handleSearch(e, 'desktop');
            });
            
            document.getElementById('prevMonthDesktop').addEventListener('click', function() {
                prevMonth('desktop');
            });
            document.getElementById('nextMonthDesktop').addEventListener('click', function() {
                nextMonth('desktop');
            });
            document.getElementById('goToDateDesktop').addEventListener('click', function() {
                goToSelectedDate('desktop');
            });
            document.getElementById('showAllButtonDesktop').addEventListener('click', showAllData);
            document.getElementById('showLinksButtonDesktop').addEventListener('click', showPasswordModal);
            document.getElementById('retryButtonDesktop').addEventListener('click', loadDataFromGoogleSheets);
            
            // Boutons de filtre desktop
            document.getElementById('showFanamarihanaButtonDesktop').addEventListener('click', showFanamarihanaFamerenana);
            document.getElementById('showFanapahanKevitraButtonDesktop').addEventListener('click', showFanapahanKevitra);
            document.getElementById('showVaovaoButtonDesktop').addEventListener('click', showVaovao);
            
            // Boutons d'export desktop (dans le panneau latÃ©ral)
            document.getElementById('exportSelectedSide').addEventListener('click', showExportDatesModal);
            document.getElementById('exportAllSide').addEventListener('click', exportAllData);
            document.getElementById('sendEmailSide').addEventListener('click', showEmailExportModal);
            
            searchInputDesktop.addEventListener('input', function() {
                showSuggestions(this.value, 'desktop');
            });
            
            searchInputDesktop.addEventListener('focus', function() {
                if (this.value) {
                    showSuggestions(this.value, 'desktop');
                }
            });
            
            document.addEventListener('click', function(e) {
                if (!searchInputDesktop.contains(e.target) && !suggestionsContainerDesktop.contains(e.target)) {
                    suggestionsContainerDesktop.style.display = 'none';
                }
            });
        }

        function scrollToCalendar() {
            if (window.innerWidth >= 1024) {
                const calendarElement = document.querySelector('.side-panel .calendar-container');
                if (calendarElement) {
                    calendarElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            } else {
                const calendarElement = document.querySelector('.mobile-search-section .calendar-container');
                if (calendarElement) {
                    calendarElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }
        }

        function adjustDateDisplay() {
            const desktopDateList = document.getElementById('desktopDateList');
            const availableDatesDesktop = document.getElementById('availableDatesDesktop');
            const availableDatesContainer = document.getElementById('availableDatesContainer');
            const desktopDateListSide = document.getElementById('desktopDateListSide');
            const availableDatesDesktopSide = document.getElementById('availableDatesDesktopSide');
            
            if (window.innerWidth <= 768) {
                // Vue mobile
                if (desktopDateList) desktopDateList.style.display = 'none';
                if (availableDatesDesktop) availableDatesDesktop.style.display = 'none';
                if (desktopDateListSide) desktopDateListSide.style.display = 'none';
                if (availableDatesDesktopSide) availableDatesDesktopSide.style.display = 'none';
                
                // En mobile, les dates disponibles sont dÃ©jÃ  au-dessus du calendrier
                if (availableDatesContainer && datesWithData.length > 0) {
                    availableDatesContainer.style.display = 'block';
                    document.getElementById('datesCount').textContent = `(${datesWithData.length} dates)`;
                }
            } else if (window.innerWidth >= 1024) {
                // Vue ordinateur - panneau latÃ©ral
                if (desktopDateListSide) desktopDateListSide.style.display = 'block';
                if (availableDatesDesktopSide && datesWithData.length > 0) {
                    availableDatesDesktopSide.style.display = 'flex';
                }
                if (availableDatesContainer) {
                    availableDatesContainer.style.display = 'none';
                }
            } else {
                // Tablette (768px - 1023px)
                if (desktopDateList) desktopDateList.style.display = 'block';
                if (availableDatesDesktop && datesWithData.length > 0) {
                    availableDatesDesktop.style.display = 'flex';
                }
                if (availableDatesContainer) {
                    availableDatesContainer.style.display = 'none';
                }
            }
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // MODAL D'EXPORT DE DATES SELECTIONNEES
        function showExportDatesModal() {
            if (!isAdminAuthenticated) {
                showPasswordModalForAction('export');
                return;
            }
            
            const modal = document.getElementById('exportDatesModal');
            const datesList = document.getElementById('exportDatesList');
            
            datesList.innerHTML = '';
            
            if (datesWithData.length === 0) {
                datesList.innerHTML = '<div style="color: #7f8c8d; font-style: italic; text-align: center; padding: 20px;">Aucune date avec donnÃ©es</div>';
            } else {
                datesWithData.forEach((item, index) => {
                    const dateItem = document.createElement('div');
                    dateItem.className = 'export-date-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'export-date-checkbox';
                    checkbox.value = item.dateStr;
                    checkbox.id = `export-date-${index}`;
                    
                    const label = document.createElement('label');
                    label.className = 'export-date-label';
                    label.htmlFor = `export-date-${index}`;
                    label.textContent = formatDateForDisplay(item.date);
                    
                    dateItem.appendChild(checkbox);
                    dateItem.appendChild(label);
                    datesList.appendChild(dateItem);
                });
            }
            
            modal.style.display = 'flex';
        }
        
        function hideExportDatesModal() {
            document.getElementById('exportDatesModal').style.display = 'none';
        }
        
        function selectAllExportDates() {
            const checkAll = document.getElementById('selectAllDates').checked;
            const checkboxes = document.querySelectorAll('.export-date-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = checkAll;
            });
        }
        
        function confirmExportDates() {
            const selectedDates = [];
            const checkboxes = document.querySelectorAll('.export-date-checkbox:checked');
            const format = document.getElementById('exportFormatSelect').value;
            
            if (checkboxes.length === 0) {
                alert('Veuillez sÃ©lectionner au moins une date.');
                return;
            }
            
            checkboxes.forEach(checkbox => {
                selectedDates.push(checkbox.value);
            });
            
            // Filtrer les donnÃ©es selon les dates sÃ©lectionnÃ©es
            const rowsToExport = [];
            selectedDates.forEach(dateStr => {
                const date = parseDate(dateStr);
                if (date) {
                    const matchingRows = findPVByDate(date);
                    rowsToExport.push(...matchingRows);
                }
            });
            
            if (rowsToExport.length > 0) {
                switch(format) {
                    case 'csv':
                        exportToCSV(rowsToExport, `pv_selection_${new Date().toISOString().split('T')[0]}.csv`);
                        break;
                    case 'excel':
                        exportToExcel(rowsToExport, `pv_selection_${new Date().toISOString().split('T')[0]}.xlsx`);
                        break;
                    case 'pdf':
                        exportToPDF(rowsToExport, `Rapport PV sÃ©lection`);
                        break;
                }
                hideExportDatesModal();
            } else {
                alert('Aucune donnÃ©e trouvÃ©e pour les dates sÃ©lectionnÃ©es.');
            }
        }
        
        // NOUVELLE FONCTION : Modal d'envoi par email avec sÃ©lection de PV
        function showEmailExportModal() {
            if (!isAdminAuthenticated) {
                showPasswordModalForAction('export');
                return;
            }
            
            const modal = document.getElementById('emailExportModal');
            const pvList = document.getElementById('emailPVList');
            
            pvList.innerHTML = '';
            
            if (sheetData.length === 0) {
                pvList.innerHTML = '<div style="color: #7f8c8d; font-style: italic; text-align: center; padding: 20px;">Aucun PV disponible</div>';
            } else {
                sheetData.forEach((row, index) => {
                    const dateStr = row[1] || 'Date non spÃ©cifiÃ©e';
                    const titre = row[2] || `PV ${index + 1}`;
                    
                    const pvItem = document.createElement('div');
                    pvItem.className = 'export-date-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'export-date-checkbox pv-checkbox';
                    checkbox.value = index;
                    checkbox.id = `email-pv-${index}`;
                    checkbox.checked = true;
                    
                    const label = document.createElement('label');
                    label.className = 'export-date-label';
                    label.htmlFor = `email-pv-${index}`;
                    label.textContent = `${titre} - ${dateStr}`;
                    
                    pvItem.appendChild(checkbox);
                    pvItem.appendChild(label);
                    pvList.appendChild(pvItem);
                });
            }
            
            // PrÃ©-remplir le sujet
            document.getElementById('emailSubject').value = `Rapport PV - TournÃ©e NY AKO 2026 - ${new Date().toLocaleDateString('fr-FR')}`;
            
            // PrÃ©-remplir le message
            const message = `Bonjour,

Veuillez trouver ci-joint le rapport des procÃ¨s-verbaux de la TournÃ©e NY AKO 2026.

Cordialement,
L'Ã©quipe de gestion des PV`;
            
            document.getElementById('emailMessage').value = message;
            
            modal.style.display = 'flex';
        }
        
        function hideEmailExportModal() {
            document.getElementById('emailExportModal').style.display = 'none';
        }
        
        function selectAllPVsForEmail() {
            const checkAll = document.getElementById('selectAllPVs').checked;
            const checkboxes = document.querySelectorAll('.pv-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = checkAll;
            });
        }
        
        function confirmEmailExport() {
            const recipients = document.getElementById('emailRecipients').value;
            const subject = document.getElementById('emailSubject').value;
            const message = document.getElementById('emailMessage').value;
            const format = document.getElementById('emailFormatSelect').value;
            const includePVContent = document.getElementById('includePVContent').checked;
            
            if (!recipients || recipients.trim() === '') {
                alert('Veuillez entrer au moins une adresse email.');
                return;
            }
            
            // RÃ©cupÃ©rer les PV sÃ©lectionnÃ©s
            const selectedPVs = [];
            const checkboxes = document.querySelectorAll('.pv-checkbox:checked');
            
            if (checkboxes.length === 0) {
                alert('Veuillez sÃ©lectionner au moins un PV.');
                return;
            }
            
            checkboxes.forEach(checkbox => {
                const pvIndex = parseInt(checkbox.value);
                if (!isNaN(pvIndex) && pvIndex >= 0 && pvIndex < sheetData.length) {
                    selectedPVs.push(pvIndex);
                }
            });
            
            // PrÃ©parer les donnÃ©es pour l'email
            const dataToExport = sheetData.filter((row, index) => selectedPVs.includes(index));
            
            // CrÃ©er le contenu du message avec les PV si demandÃ©
            let emailBody = message;
            
            if (includePVContent && dataToExport.length > 0) {
                emailBody += '\n\n--- CONTENU DES PV SELECTIONNES ---\n\n';
                
                dataToExport.forEach((row, index) => {
                    const dateStr = row[1] || 'Date non spÃ©cifiÃ©e';
                    const titre = row[2] || `PV ${selectedPVs[index] + 1}`;
                    
                    emailBody += `PV: ${titre}\n`;
                    emailBody += `Date: ${dateStr}\n`;
                    
                    // Ajouter les informations principales
                    headers.forEach((header, colIndex) => {
                        const value = row[colIndex] || '';
                        if (value && value.trim() !== '' && 
                            !header.toLowerCase().includes('rohy fiche') &&
                            !header.toLowerCase().includes('horodateur')) {
                            emailBody += `${header}: ${value}\n`;
                        }
                    });
                    
                    emailBody += '\n---\n\n';
                });
            }
            
            // CrÃ©er le lien mailto
            const encodedBody = encodeURIComponent(emailBody);
            const encodedSubject = encodeURIComponent(subject);
            const emailRecipients = recipients.split(',').map(email => email.trim()).join(',');
            
            const mailtoLink = `mailto:${emailRecipients}?subject=${encodedSubject}&body=${encodedBody}`;
            
            window.open(mailtoLink);
            hideEmailExportModal();
            
            // Pour l'export rÃ©el du fichier
            setTimeout(() => {
                switch(format) {
                    case 'csv':
                        exportToCSV(dataToExport, `Rapport_PV_${new Date().toISOString().split('T')[0]}.csv`);
                        break;
                    case 'excel':
                        exportToExcel(dataToExport, `Rapport_PV_${new Date().toISOString().split('T')[0]}.xlsx`);
                        break;
                    case 'pdf':
                        exportToPDF(dataToExport, `Rapport_PV_${new Date().toISOString().split('T')[0]}`);
                        break;
                }
            }, 1000);
        }
        
        // FONCTIONS D'EXPORT
        function exportAllData() {
            if (!isAdminAuthenticated) {
                showPasswordModalForAction('export');
                return;
            }
            
            if (sheetData.length > 0) {
                // Demander le format
                const format = prompt('Choisissez le format d\'export :\n1. CSV (Tableur)\n2. Excel (XLSX)\n3. PDF (Rapport)\n\nEntrez 1, 2 ou 3 :', '1');
                
                switch(format) {
                    case '1':
                        exportToCSV(sheetData, `pv_complet_${new Date().toISOString().split('T')[0]}.csv`);
                        break;
                    case '2':
                        exportToExcel(sheetData, `pv_complet_${new Date().toISOString().split('T')[0]}.xlsx`);
                        break;
                    case '3':
                        exportToPDF(sheetData, `Rapport PV complet`);
                        break;
                }
            } else {
                alert('Aucune donnÃ©e Ã  exporter.');
            }
        }
        
        function exportToCSV(data, filename) {
            let csvContent = 'data:text/csv;charset=utf-8,';
            
            // Ajouter les en-tÃªtes
            csvContent += headers.map(header => `"${header}"`).join(',') + '\n';
            
            // Ajouter les donnÃ©es
            data.forEach(row => {
                const rowData = headers.map((header, index) => {
                    const value = row[index] || '';
                    return `"${value.replace(/"/g, '""')}"`;
                });
                csvContent += rowData.join(',') + '\n';
            });
            
            // TÃ©lÃ©charger le fichier
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', filename);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        function exportToExcel(data, filename) {
            // Pour Excel, nous utilisons CSV pour l'instant
            exportToCSV(data, filename.replace('.xlsx', '.csv'));
        }
        
        function exportToPDF(data, title) {
            // Ouvrir une nouvelle fenÃªtre avec le contenu HTML pour impression
            const printWindow = window.open('', '_blank');
            let html = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${title}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #2c3e50; border-bottom: 2px solid #4CAF50; padding-bottom: 10px; }
                        h2 { color: #3498db; margin-top: 20px; }
                        .pv-item { margin-bottom: 30px; border: 1px solid #ddd; padding: 15px; }
                        .pv-header { background: #e8f5e8; padding: 10px; margin: -15px -15px 15px -15px; }
                        .data-table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
                        .data-table th { background: #f8f9fa; text-align: left; padding: 8px; border-bottom: 1px solid #ddd; }
                        .data-table td { padding: 8px; border-bottom: 1px solid #eee; }
                        .stats-summary { background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
                        @media print { 
                            body { margin: 0; font-size: 12px; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <h1>${title}</h1>
                    <p>GÃ©nÃ©rÃ© le ${new Date().toLocaleDateString('fr-FR')} Ã  ${new Date().toLocaleTimeString('fr-FR')}</p>
                    
                    <div class="stats-summary">
                        <h2>RÃ©sumÃ© des statistiques</h2>
                        <p><strong>Total PV exportÃ©s:</strong> ${data.length}</p>
                        <p><strong>Noms uniques:</strong> ${allNames.size}</p>
                        <p><strong>Lieux de rÃ©union:</strong> ${Object.keys(toeranaStats).length}</p>
                    </div>
            `;
            
            data.forEach((row, index) => {
                const dateStr = row[1] || 'Date non spÃ©cifiÃ©e';
                const titre = row[2] || `PV ${index + 1}`;
                
                html += `
                    <div class="pv-item">
                        <div class="pv-header">
                            <h2>${titre}</h2>
                            <p><strong>Date:</strong> ${dateStr}</p>
                        </div>
                        <table class="data-table">
                `;
                
                headers.forEach((header, colIndex) => {
                    const value = row[colIndex] || '';
                    if (value && value.trim() !== '') {
                        html += `
                            <tr>
                                <th>${header}</th>
                                <td>${value.replace(/\n/g, '<br>')}</td>
                            </tr>
                        `;
                    }
                });
                
                html += `</table></div>`;
            });
            
            html += `
                    <div class="no-print" style="margin-top: 30px; text-align: center;">
                        <button onclick="window.print()" style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ðŸ–¨ï¸ Imprimer ce rapport
                        </button>
                    </div>
                </body>
                </html>
            `;
            
            printWindow.document.write(html);
            printWindow.document.close();
            printWindow.focus();
        }
        
        // MODIFICATION : GÃ©nÃ©rer les boutons de dates pour mobile et desktop avec disposition amÃ©liorÃ©e
        function renderDatesButtons() {
            const datesButtons = document.getElementById('datesButtons');
            const availableDatesContainer = document.getElementById('availableDatesContainer');
            const availableDatesDesktop = document.getElementById('availableDatesDesktop');
            const availableDatesDesktopSide = document.getElementById('availableDatesDesktopSide');
            
            if (datesWithData.length === 0) {
                if (availableDatesContainer) availableDatesContainer.style.display = 'none';
                if (availableDatesDesktop) availableDatesDesktop.style.display = 'none';
                if (availableDatesDesktopSide) availableDatesDesktopSide.style.display = 'none';
                return;
            }
            
            // Mettre Ã  jour le compteur de dates
            if (document.getElementById('datesCount')) {
                document.getElementById('datesCount').textContent = `(${datesWithData.length} dates)`;
            }
            
            // Version mobile (boutons)
            if (availableDatesContainer) {
                availableDatesContainer.style.display = 'block';
                datesButtons.innerHTML = '';
                
                datesWithData.forEach(item => {
                    const dateButton = createDateButton(item);
                    datesButtons.appendChild(dateButton);
                });
            }
            
            // Version desktop dans la vue mobile (pour tablettes)
            if (availableDatesDesktop) {
                availableDatesDesktop.innerHTML = '';
                
                // CrÃ©er un conteneur de grille pour les dates
                const datesGrid = document.createElement('div');
                datesGrid.className = 'available-dates-grid';
                
                datesWithData.forEach(item => {
                    const dateButton = createDateButton(item);
                    datesGrid.appendChild(dateButton);
                });
                
                availableDatesDesktop.appendChild(datesGrid);
            }
            
            // Version desktop dans le panneau latÃ©ral
            if (availableDatesDesktopSide) {
                availableDatesDesktopSide.innerHTML = '';
                
                // CrÃ©er un conteneur de grille pour les dates
                const datesGrid = document.createElement('div');
                datesGrid.className = 'available-dates-grid';
                
                datesWithData.forEach(item => {
                    const dateButton = createDateButton(item);
                    datesGrid.appendChild(dateButton);
                });
                
                availableDatesDesktopSide.appendChild(datesGrid);
            }
            
            // Afficher ou masquer selon la taille de l'Ã©cran
            adjustDateDisplay();
        }
        
        // NOUVELLE FONCTION : CrÃ©er un bouton de date avec Ã©vÃ©nement
        function createDateButton(item) {
            const dateButton = document.createElement('button');
            dateButton.className = 'date-button';
            
            // Formater la date : jjj jj-mm-aa
            const dayName = item.date.toLocaleDateString('fr-FR', { weekday: 'short' });
            const day = item.date.getDate().toString().padStart(2, '0');
            const month = (item.date.getMonth() + 1).toString().padStart(2, '0');
            const year = item.date.getFullYear().toString().slice(-2);
            
            dateButton.innerHTML = `
                <i>ðŸ“…</i>
                ${dayName} ${day}-${month}-${year}
            `;
            
            // Ajouter info-bulle avec nombre de participants si disponible
            if (item.totalParticipants > 0) {
                dateButton.title = `${item.totalParticipants} participant(s) - ${item.toerana || 'Lieu non spÃ©cifiÃ©'}`;
            } else if (item.toerana) {
                dateButton.title = item.toerana;
            }
            
            dateButton.addEventListener('click', () => {
                // Afficher directement les donnÃ©es de cette date
                displayDataForDate(item.date);
                currentDate = new Date(item.date);
                renderCalendar('mobile');
                renderCalendar('desktop');
                
                // Mettre en Ã©vidence la date sÃ©lectionnÃ©e
                document.querySelectorAll('.date-button').forEach(btn => {
                    btn.style.opacity = '0.8';
                    btn.style.boxShadow = '0 1px 4px rgba(231, 76, 60, 0.3)';
                });
                dateButton.style.opacity = '1';
                dateButton.style.boxShadow = '0 0 0 2px #ff6b6b, 0 3px 10px rgba(231, 76, 60, 0.4)';
                
                // Retirer la mise en Ã©vidence aprÃ¨s 3 secondes
                setTimeout(() => {
                    dateButton.style.opacity = '0.8';
                    dateButton.style.boxShadow = '0 1px 4px rgba(231, 76, 60, 0.3)';
                }, 3000);
            });
            
            return dateButton;
        }
        
        // NOUVELLE FONCTION : Compter le nombre total de participants
        function countTotalParticipants(fahatongavanaData) {
            let count = 0;
            const countedNames = new Set();
            
            // Compter les noms uniques dans toutes les catÃ©gories de prÃ©sence
            const categories = [
                'araPotoana', 'taraLatsaky30min', 'taraLatsaky1h', 
                'taraMihoatra1h', 'tapakAndro'
            ];
            
            categories.forEach(category => {
                fahatongavanaData[category].forEach(fullName => {
                    if (fullName && fullName.trim()) {
                        const names = fullName.split(/[,/]/).map(name => name.trim()).filter(name => name);
                        names.forEach(name => {
                            if (name && !countedNames.has(name)) {
                                countedNames.add(name);
                                count++;
                            }
                        });
                    }
                });
            });
            
            return count;
        }

        function showDateOptions(date) {
            const modal = document.getElementById('dateOptionsModal');
            const title = document.getElementById('dateOptionsTitle');
            const buttonsContainer = document.getElementById('dateOptionsButtons');
            
            const formattedDate = formatDateForDisplay(date);
            title.textContent = `Options pour le ${formattedDate}`;
            
            // VÃ©rifier si la date a dÃ©jÃ  un PV
            const hasPV = datesWithData.some(item => 
                item.date.getDate() === date.getDate() &&
                item.date.getMonth() === date.getMonth() &&
                item.date.getFullYear() === date.getFullYear()
            );
            
            buttonsContainer.innerHTML = '';
            
            if (!hasPV) {
                // Date vierge - option pour crÃ©er un nouveau PV
                buttonsContainer.innerHTML = `
                    <button class="date-option-btn primary" id="createPVButton">
                        <span>âœï¸</span> CrÃ©er un nouveau PV pour cette date
                    </button>
                `;
                
                document.getElementById('createPVButton').addEventListener('click', function() {
                    if (isAdminAuthenticated) {
                        // Ouvrir le formulaire Google
                        window.open(GOOGLE_FORM_URL, '_blank');
                        hideDateOptionsModal();
                    } else {
                        // Demander le mot de passe
                        showPasswordModalForAction('create');
                    }
                });
            } else {
                // Date avec PV existant - options pour voir ou modifier
                buttonsContainer.innerHTML = `
                    <button class="date-option-btn secondary" id="viewPVButton">
                        <span>ðŸ‘ï¸</span> Voir le PV
                    </button>
                    <button class="date-option-btn primary" id="editPVButton" ${isAdminAuthenticated ? '' : 'disabled'}>
                        <span>âœï¸</span> Modifier le PV
                    </button>
                    <button class="date-option-btn tertiary" id="downloadPDFButton">
                        <span>ðŸ“„</span> TÃ©lÃ©charger la fiche du jour en PDF
                    </button>
                `;
                
                document.getElementById('viewPVButton').addEventListener('click', function() {
                    // AFFICHER DIRECTEMENT LES DONNÃ‰ES
                    displayDataForDate(date);
                    hideDateOptionsModal();
                });
                
                document.getElementById('editPVButton').addEventListener('click', function() {
                    if (isAdminAuthenticated) {
                        // Ouvrir le lien "Rohy fiche" correspondant
                        openEditLinkForDate(date);
                        hideDateOptionsModal();
                    } else {
                        // Si pas authentifiÃ©, afficher le bouton pour s'authentifier
                        showPasswordModalForAction('edit');
                    }
                });
                
                document.getElementById('downloadPDFButton').addEventListener('click', function() {
                    // Exporter le PV de cette date en PDF
                    const matchingRows = findPVByDate(date);
                    if (matchingRows.length > 0) {
                        exportToPDF(matchingRows, `PV du ${formatDateForDisplay(date)}`);
                        hideDateOptionsModal();
                    }
                });
                
                // Si pas authentifiÃ© comme admin, afficher le bouton pour s'authentifier
                if (!isAdminAuthenticated) {
                    const authButton = document.createElement('button');
                    authButton.className = 'date-option-btn secondary';
                    authButton.innerHTML = '<span>ðŸ”‘</span> Authentifier pour modifier';
                    authButton.addEventListener('click', function() {
                        showPasswordModalForAction('edit');
                        hideDateOptionsModal();
                    });
                    buttonsContainer.appendChild(authButton);
                }
            }
            
            // Bouton annuler
            const cancelButton = document.createElement('button');
            cancelButton.className = 'date-option-btn secondary';
            cancelButton.innerHTML = '<span>âŒ</span> Annuler';
            cancelButton.addEventListener('click', hideDateOptionsModal);
            buttonsContainer.appendChild(cancelButton);
            
            modal.style.display = 'flex';
        }

        // NOUVELLE FONCTION : Afficher directement les donnÃ©es pour une date
        function displayDataForDate(date) {
            const matchingRows = findPVByDate(date);
            if (matchingRows.length > 0) {
                displayResults(matchingRows, `PV du ${formatDateForDisplay(date)}`);
            } else {
                // Ce cas ne devrait normalement pas se produire car on vÃ©rifie hasPV avant
                alert('Aucun PV trouvÃ© pour cette date.');
            }
        }

        function hideDateOptionsModal() {
            document.getElementById('dateOptionsModal').style.display = 'none';
        }

        function showPasswordModalForAction(action) {
            const modal = document.getElementById('passwordModal');
            const submitButton = document.getElementById('submitPassword');
            
            // Stocker l'action Ã  effectuer aprÃ¨s authentification
            submitButton.dataset.action = action;
            
            modal.style.display = 'flex';
            document.getElementById('passwordInput').value = '';
            document.getElementById('passwordError').style.display = 'none';
            document.getElementById('passwordInput').focus();
        }

        function openEditLinkForDate(date) {
            // Trouver la ligne correspondant Ã  la date
            const matchingRows = findPVByDate(date);
            if (matchingRows.length > 0) {
                const row = matchingRows[0];
                
                // Trouver l'index de la colonne "Rohy fiche"
                const rohyFicheIndex = headers.findIndex(header => 
                    header.toLowerCase().includes('rohy fiche')
                );
                
                if (rohyFicheIndex !== -1 && row[rohyFicheIndex]) {
                    const editLink = row[rohyFicheIndex];
                    if (editLink.startsWith('http')) {
                        window.open(editLink, '_blank');
                    } else {
                        alert('Aucun lien de modification disponible pour cette date.');
                    }
                } else {
                    alert('Aucun lien de modification disponible pour cette date.');
                }
            }
        }

        function showPasswordModal() {
            document.getElementById('passwordModal').style.display = 'flex';
            document.getElementById('passwordInput').value = '';
            document.getElementById('passwordError').style.display = 'none';
            document.getElementById('passwordInput').focus();
            
            // Effacer l'action stockÃ©e
            document.getElementById('submitPassword').dataset.action = '';
        }

        function hidePasswordModal() {
            document.getElementById('passwordModal').style.display = 'none';
        }

        function checkPassword() {
            const passwordInput = document.getElementById('passwordInput').value;
            const submitButton = document.getElementById('submitPassword');
            const action = submitButton.dataset.action;
            
            if (passwordInput === PASSWORD) {
                isAdminAuthenticated = true;
                showProtectedColumns = true;
                hidePasswordModal();
                
                // Activer les boutons d'export dans les deux vues
                document.querySelectorAll('.export-btn').forEach(btn => {
                    btn.disabled = false;
                });
                document.getElementById('exportSection').classList.remove('locked');
                document.getElementById('exportSectionSide').classList.remove('locked');
                
                // Mettre Ã  jour le bouton modifier dans la modal si elle est ouverte
                const editButton = document.getElementById('editPVButton');
                if (editButton) {
                    editButton.disabled = false;
                    editButton.textContent = 'âœï¸ Modifier le PV';
                }
                
                // Si une action Ã©tait en attente, l'exÃ©cuter
                if (action === 'create') {
                    window.open(GOOGLE_FORM_URL, '_blank');
                } else if (action === 'edit' && selectedDate) {
                    openEditLinkForDate(selectedDate);
                } else if (action === 'export') {
                    if (window.innerWidth >= 1024) {
                        document.getElementById('exportSectionSide').scrollIntoView({ behavior: 'smooth' });
                    } else {
                        document.getElementById('exportSection').scrollIntoView({ behavior: 'smooth' });
                    }
                }
                
                // Recharger les rÃ©sultats actuels si des rÃ©sultats sont affichÃ©s
                if (document.getElementById('resultsSection').style.display === 'block') {
                    const currentSearch = document.getElementById('resultTitle').textContent.replace('RÃ©sultats pour "', '').replace('"', '');
                    if (currentSearch.includes('PV du')) {
                        const dateText = currentSearch.replace('PV du ', '');
                        const dateParts = dateText.split(' ');
                        const day = parseInt(dateParts[0]);
                        const month = getMonthNumber(dateParts[1]);
                        const year = parseInt(dateParts[3]);
                        const date = new Date(year, month, day);
                        const matchingRows = findPVByDate(date);
                        displayResults(matchingRows, `PV du ${formatDateForDisplay(date)}`);
                    } else if (currentSearch === 'Tous les PV') {
                        showAllData();
                    } else {
                        handleSearch(new Event('submit'), window.innerWidth >= 1024 ? 'desktop' : 'mobile');
                    }
                }
            } else {
                document.getElementById('passwordError').style.display = 'block';
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }

        function getMonthNumber(monthName) {
            const months = {
                'janvier': 0, 'fÃ©vrier': 1, 'mars': 2, 'avril': 3, 'mai': 4, 'juin': 5,
                'juillet': 6, 'aoÃ»t': 7, 'septembre': 8, 'octobre': 9, 'novembre': 10, 'dÃ©cembre': 11
            };
            return months[monthName.toLowerCase()] || 0;
        }
        
        // MODIFICATION : Ajouter l'appel Ã  renderDatesButtons et collecter les informations
        function extractDatesWithData() {
            datesWithData = [];
            
            const dateColumnIndex = 1;
            
            sheetData.forEach((row, index) => {
                const dateStr = row[dateColumnIndex] || '';
                if (dateStr && dateStr.trim() !== '') {
                    const date = parseDate(dateStr);
                    if (date) {
                        // Trouver le lieu (Toerana) pour cette date
                        const toeranaIndex = headers.findIndex(h => 
                            h && h.toLowerCase().includes('toerana')
                        );
                        let toerana = '';
                        if (toeranaIndex !== -1) {
                            toerana = row[toeranaIndex] || '';
                        }
                        
                        // Calculer le nombre de participants pour cette date
                        const fahatongavanaData = extractFahatongavanaData(row);
                        const totalParticipants = countTotalParticipants(fahatongavanaData);
                        
                        datesWithData.push({
                            date: date,
                            dateStr: dateStr,
                            rowIndex: index,
                            toerana: toerana,
                            totalParticipants: totalParticipants
                        });
                    }
                }
            });
            
            datesWithData.sort((a, b) => a.date - b.date);
            
            console.log(`ðŸ“… ${datesWithData.length} dates avec donnÃ©es trouvÃ©es`);
            
            // GÃ©nÃ©rer les boutons de dates
            renderDatesButtons();
        }

        // MODIFICATION : Le calendrier montre les options, le lieu et le nombre de participants
        function renderCalendar(view = 'mobile') {
            let calendarGrid, currentMonthElement, calendarId, dateInputId, goToDateId;
            
            if (view === 'desktop') {
                calendarGrid = document.getElementById('calendarGridDesktop');
                currentMonthElement = document.getElementById('currentMonthDesktop');
                calendarId = 'calendarGridDesktop';
                dateInputId = 'dateInputDesktop';
                goToDateId = 'goToDateDesktop';
            } else {
                calendarGrid = document.getElementById('calendarGrid');
                currentMonthElement = document.getElementById('currentMonth');
                calendarId = 'calendarGrid';
                dateInputId = 'dateInput';
                goToDateId = 'goToDate';
            }
            
            if (!calendarGrid || !currentMonthElement) return;
            
            currentMonthElement.textContent = currentDate.toLocaleDateString('fr-FR', {
                month: 'long',
                year: 'numeric'
            });
            
            calendarGrid.innerHTML = '';
            
            const daysOfWeek = ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'];
            daysOfWeek.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-day-header';
                dayHeader.textContent = day;
                calendarGrid.appendChild(dayHeader);
            });
            
            const firstDayOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDayOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            
            let firstDayOfWeek = firstDayOfMonth.getDay();
            firstDayOfWeek = firstDayOfWeek === 0 ? 6 : firstDayOfWeek - 1;
            
            const prevMonthLastDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0).getDate();
            for (let i = firstDayOfWeek - 1; i >= 0; i--) {
                const day = document.createElement('div');
                day.className = 'calendar-day other-month';
                day.textContent = prevMonthLastDay - i;
                calendarGrid.appendChild(day);
            }
            
            for (let i = 1; i <= lastDayOfMonth.getDate(); i++) {
                const day = document.createElement('div');
                day.className = 'calendar-day';
                day.textContent = i;
                
                const dateToCheck = new Date(currentDate.getFullYear(), currentDate.getMonth(), i);
                const dateData = datesWithData.find(item => 
                    item.date.getDate() === dateToCheck.getDate() &&
                    item.date.getMonth() === dateToCheck.getMonth() &&
                    item.date.getFullYear() === dateToCheck.getFullYear()
                );
                
                if (dateData) {
                    day.classList.add('has-data');
                    
                    // Ajouter l'information du lieu et nombre de participants
                    const infoSpan = document.createElement('div');
                    infoSpan.className = 'calendar-day-info';
                    
                    if (dateData.toerana && dateData.toerana.trim() !== '') {
                        const locationSpan = document.createElement('div');
                        locationSpan.className = 'calendar-day-location';
                        locationSpan.textContent = `ðŸ“ ${dateData.toerana}`;
                        infoSpan.appendChild(locationSpan);
                    }
                    
                    if (dateData.totalParticipants > 0) {
                        const participantsSpan = document.createElement('div');
                        participantsSpan.className = 'calendar-day-participants';
                        participantsSpan.textContent = `ðŸ‘¥ ${dateData.totalParticipants}`;
                        infoSpan.appendChild(participantsSpan);
                    }
                    
                    day.appendChild(infoSpan);
                }
                
                if (selectedDate && 
                    selectedDate.getDate() === i &&
                    selectedDate.getMonth() === currentDate.getMonth() &&
                    selectedDate.getFullYear() === currentDate.getFullYear()) {
                    day.classList.add('selected');
                }
                
                day.addEventListener('click', () => {
                    // AFFICHER LES OPTIONS (seulement pour le calendrier)
                    const clickedDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), i);
                    showDateOptions(clickedDate);
                });
                
                calendarGrid.appendChild(day);
            }
            
            const totalCells = 42;
            const daysInCalendar = firstDayOfWeek + lastDayOfMonth.getDate();
            const nextMonthDays = totalCells - daysInCalendar;
            
            for (let i = 1; i <= nextMonthDays; i++) {
                const day = document.createElement('div');
                day.className = 'calendar-day other-month';
                day.textContent = i;
                calendarGrid.appendChild(day);
            }
        }

        // MODIFICATION : La sÃ©lection de date via le champ de date va directement aux options
        function goToSelectedDate(view = 'mobile') {
            let dateInput, dateValue;
            
            if (view === 'desktop') {
                dateInput = document.getElementById('dateInputDesktop');
            } else {
                dateInput = document.getElementById('dateInput');
            }
            
            dateValue = dateInput.value;
            
            if (!dateValue) {
                alert('Veuillez sÃ©lectionner une date');
                return;
            }
            
            const selectedDate = new Date(dateValue);
            currentDate = new Date(selectedDate);
            renderCalendar('mobile');
            renderCalendar('desktop');
            
            // AFFICHER LES OPTIONS (comme pour le calendrier)
            showDateOptions(selectedDate);
        }

        // MODIFICATION : FONCTION POUR CALCULER LES STATISTIQUES - ENLEVE TEXTE D'EXPLICATION
        function calculateStatistics() {
            // RÃ©initialiser les statistiques
            allNames.clear();
            nameStatistics = {};
            toeranaStats = {};
            totalPV = sheetData.length;
            pvCountByPerson = {}; // RÃ©initialiser
            
            // MODIFICATION : Compter d'abord le nombre total de PV
            const totalPVCount = sheetData.length;
            
            sheetData.forEach((row, pvIndex) => {
                // Extraire les donnÃ©es de prÃ©sence
                const fahatongavanaData = extractFahatongavanaData(row);
                
                // CrÃ©er un Set pour chaque catÃ©gorie pour Ã©viter les doublons dans une mÃªme PV
                const araPotoanaSet = new Set();
                const taraLatsaky30minSet = new Set();
                const taraLatsaky1hSet = new Set();
                const taraMihoatra1hSet = new Set();
                const tapakAndroSet = new Set();
                const nodyAlohaSet = new Set();
                const tsyTongaSet = new Set();
                const nialaTsinyTaraSet = new Set();
                const nialaTsinyTsyHoAvySet = new Set();
                
                // Traiter les noms dans chaque catÃ©gorie
                const processCategory = (namesArray, targetSet) => {
                    namesArray.forEach(fullName => {
                        if (fullName && fullName.trim()) {
                            const names = fullName.split(/[,/]/).map(name => name.trim()).filter(name => name);
                            names.forEach(name => {
                                if (name) {
                                    targetSet.add(name);
                                    allNames.add(name);
                                }
                            });
                        }
                    });
                };
                
                processCategory(fahatongavanaData.araPotoana, araPotoanaSet);
                processCategory(fahatongavanaData.taraLatsaky30min, taraLatsaky30minSet);
                processCategory(fahatongavanaData.taraLatsaky1h, taraLatsaky1hSet);
                processCategory(fahatongavanaData.taraMihoatra1h, taraMihoatra1hSet);
                processCategory(fahatongavanaData.tapakAndro, tapakAndroSet);
                processCategory(fahatongavanaData.nodyAloha, nodyAlohaSet);
                processCategory(fahatongavanaData.tsyTonga, tsyTongaSet);
                processCategory(fahatongavanaData.nialaTsinyTara, nialaTsinyTaraSet);
                processCategory(fahatongavanaData.nialaTsinyTsyHoAvy, nialaTsinyTsyHoAvySet);
                
                // MODIFICATION : Pour chaque nom, compter le nombre de PV oÃ¹ il apparaÃ®t
                const updateStatsForCategory = (nameSet, categoryKey) => {
                    nameSet.forEach(name => {
                        if (!nameStatistics[name]) {
                            nameStatistics[name] = {
                                araPotoana: 0,
                                taraLatsaky30min: 0,
                                taraLatsaky1h: 0,
                                taraMihoatra1h: 0,
                                tapakAndro: 0,
                                nodyAloha: 0,
                                tsyTonga: 0,
                                nialaTsinyTara: 0,
                                nialaTsinyTsyHoAvy: 0,
                                presenceCount: 0,
                                totalPVs: totalPVCount
                            };
                        }
                        
                        // IncrÃ©menter le compteur pour cette catÃ©gorie
                        nameStatistics[name][categoryKey]++;
                        
                        // Compter les prÃ©sences (somme des catÃ©gories de prÃ©sence)
                        if (categoryKey === 'araPotoana' || 
                            categoryKey === 'taraLatsaky30min' || 
                            categoryKey === 'taraLatsaky1h' || 
                            categoryKey === 'taraMihoatra1h' || 
                            categoryKey === 'tapakAndro') {
                            nameStatistics[name].presenceCount++;
                        }
                    });
                };
                
                updateStatsForCategory(araPotoanaSet, 'araPotoana');
                updateStatsForCategory(taraLatsaky30minSet, 'taraLatsaky30min');
                updateStatsForCategory(taraLatsaky1hSet, 'taraLatsaky1h');
                updateStatsForCategory(taraMihoatra1hSet, 'taraMihoatra1h');
                updateStatsForCategory(tapakAndroSet, 'tapakAndro');
                updateStatsForCategory(nodyAlohaSet, 'nodyAloha');
                updateStatsForCategory(tsyTongaSet, 'tsyTonga');
                updateStatsForCategory(nialaTsinyTaraSet, 'nialaTsinyTara');
                updateStatsForCategory(nialaTsinyTsyHoAvySet, 'nialaTsinyTsyHoAvy');
                
                // Statistiques des lieux (Toerana)
                const toeranaIndex = headers.findIndex(h => 
                    h && h.toLowerCase().includes('toerana')
                );
                
                if (toeranaIndex !== -1) {
                    const toerana = row[toeranaIndex] || '';
                    if (toerana && toerana.trim() !== '') {
                        if (!toeranaStats[toerana]) {
                            toeranaStats[toerana] = 0;
                        }
                        toeranaStats[toerana]++;
                    }
                }
            });
            
            // Mettre Ã  jour l'affichage des statistiques
            updateStatsDisplay();
            
            // Afficher la liste des noms
            displayNamesList();
            
            // Afficher la liste des lieux
            displayToeranaList();
        }
        
        function updateStatsDisplay() {
            // Mise Ã  jour pour la vue mobile
            if (document.getElementById('totalPV')) {
                document.getElementById('totalPV').textContent = totalPV;
                document.getElementById('toeranaStats').textContent = Object.keys(toeranaStats).length;
                document.getElementById('totalParticipants').textContent = allNames.size;
            }
            
            // Mise Ã  jour pour la vue desktop
            if (document.getElementById('totalPVDesktop')) {
                document.getElementById('totalPVDesktop').textContent = totalPV;
                document.getElementById('toeranaStatsDesktop').textContent = Object.keys(toeranaStats).length;
                document.getElementById('totalParticipantsDesktop').textContent = allNames.size;
            }
        }
        
        function displayNamesList() {
            // Vue mobile
            const namesListContainer = document.getElementById('namesListContainer');
            const namesList = document.getElementById('namesList');
            
            // Vue desktop
            const namesListContainerDesktop = document.getElementById('namesListContainerDesktop');
            const namesListDesktop = document.getElementById('namesListDesktop');
            
            if (allNames.size === 0) {
                if (namesListContainer) namesListContainer.style.display = 'none';
                if (namesListContainerDesktop) namesListContainerDesktop.style.display = 'none';
                return;
            }
            
            // Vue mobile
            if (namesListContainer) {
                namesListContainer.style.display = 'block';
                if (namesList) {
                    namesList.innerHTML = '';
                    
                    Array.from(allNames).sort().forEach(name => {
                        const nameTag = document.createElement('div');
                        nameTag.className = 'name-tag';
                        nameTag.textContent = name;
                        nameTag.addEventListener('click', () => {
                            showNameStatistics(name);
                        });
                        namesList.appendChild(nameTag);
                    });
                }
            }
            
            // Vue desktop
            if (namesListContainerDesktop) {
                namesListContainerDesktop.style.display = 'block';
                if (namesListDesktop) {
                    namesListDesktop.innerHTML = '';
                    
                    Array.from(allNames).sort().forEach(name => {
                        const nameTag = document.createElement('div');
                        nameTag.className = 'name-tag';
                        nameTag.textContent = name;
                        nameTag.addEventListener('click', () => {
                            showNameStatistics(name);
                        });
                        namesListDesktop.appendChild(nameTag);
                    });
                }
            }
        }
        
        function displayToeranaList() {
            // Vue mobile
            const toeranaListContainer = document.getElementById('toeranaListContainer');
            const toeranaList = document.getElementById('toeranaList');
            
            // Vue desktop
            const toeranaListContainerDesktop = document.getElementById('toeranaListContainerDesktop');
            const toeranaListDesktop = document.getElementById('toeranaListDesktop');
            
            if (Object.keys(toeranaStats).length === 0) {
                if (toeranaListContainer) toeranaListContainer.style.display = 'none';
                if (toeranaListContainerDesktop) toeranaListContainerDesktop.style.display = 'none';
                return;
            }
            
            // Trier les lieux par nombre de rÃ©unions (dÃ©croissant)
            const sortedToerana = Object.entries(toeranaStats).sort((a, b) => b[1] - a[1]);
            
            // Vue mobile
            if (toeranaListContainer) {
                toeranaListContainer.style.display = 'block';
                if (toeranaList) {
                    toeranaList.innerHTML = '';
                    
                    sortedToerana.forEach(([toerana, count]) => {
                        const toeranaItem = document.createElement('div');
                        toeranaItem.className = 'date-item';
                        toeranaItem.innerHTML = `
                            <strong>${toerana}</strong>
                            <span style="float: right; background: #3498db; color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.75em;">
                                ${count} rÃ©union${count > 1 ? 's' : ''}
                            </span>
                        `;
                        toeranaItem.addEventListener('click', () => {
                            // Filtrer les PV pour ce lieu
                            const filteredData = sheetData.filter(row => {
                                const toeranaIndex = headers.findIndex(h => 
                                    h && h.toLowerCase().includes('toerana')
                                );
                                return toeranaIndex !== -1 && row[toeranaIndex] === toerana;
                            });
                            displayResults(filteredData, `PV au lieu: ${toerana}`);
                        });
                        toeranaList.appendChild(toeranaItem);
                    });
                }
            }
            
            // Vue desktop
            if (toeranaListContainerDesktop) {
                toeranaListContainerDesktop.style.display = 'block';
                if (toeranaListDesktop) {
                    toeranaListDesktop.innerHTML = '';
                    
                    sortedToerana.forEach(([toerana, count]) => {
                        const toeranaItem = document.createElement('div');
                        toeranaItem.className = 'date-item';
                        toeranaItem.innerHTML = `
                            <strong>${toerana}</strong>
                            <span style="float: right; background: #3498db; color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.75em;">
                                ${count} rÃ©union${count > 1 ? 's' : ''}
                            </span>
                        `;
                        toeranaItem.addEventListener('click', () => {
                            // Filtrer les PV pour ce lieu
                            const filteredData = sheetData.filter(row => {
                                const toeranaIndex = headers.findIndex(h => 
                                    h && h.toLowerCase().includes('toerana')
                                );
                                return toeranaIndex !== -1 && row[toeranaIndex] === toerana;
                            });
                            displayResults(filteredData, `PV au lieu: ${toerana}`);
                        });
                        toeranaListDesktop.appendChild(toeranaItem);
                    });
                }
            }
        }
        
        // MODIFICATION : Affiche les statistiques avec graphiques cylindriques
        function showNameStatistics(name) {
            const stats = nameStatistics[name];
            if (!stats) return;
            
            const modal = document.getElementById('statsModal');
            const title = document.getElementById('statsModalTitle');
            const content = document.getElementById('statsModalContent');
            
            title.textContent = `Statistiques pour ${name}`;
            
            // MODIFICATION : Calculer le pourcentage de prÃ©sence par rapport au nombre total de PV
            const presencePercentage = stats.totalPVs > 0 ? ((stats.presenceCount / stats.totalPVs) * 100).toFixed(1) : 0;
            
            // CrÃ©er un graphique donut pour le pourcentage
            const donutOffset = 314 - (presencePercentage * 314 / 100);
            
            let html = `
                <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 15px;">
                    <div style="flex: 1; min-width: 180px;">
                        <div class="donut-chart">
                            <svg class="donut-chart-svg" width="100" height="100" viewBox="0 0 120 120">
                                <circle class="donut-chart-background" cx="60" cy="60" r="50"></circle>
                                <circle class="donut-chart-foreground" cx="60" cy="60" r="50" stroke-dashoffset="${donutOffset}"></circle>
                            </svg>
                            <div class="donut-chart-center">
                                <div class="donut-chart-value">${presencePercentage}%</div>
                                <div class="donut-chart-label">PrÃ©sence</div>
                            </div>
                        </div>
                    </div>
                    <div style="flex: 2; min-width: 180px;">
                        <p><strong>Nombre total de PV :</strong> ${stats.totalPVs}</p>
                        <p><strong>PrÃ©sence totale :</strong> ${stats.presenceCount}</p>
                        <em>${stats.presenceCount}/${stats.totalPVs} PV</em>
                    </div>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" style="width: ${presencePercentage}%">
                        ${presencePercentage}%
                    </div>
                </div>
                <h4 style="margin-top: 20px; margin-bottom: 12px; color: #2c3e50;">DÃ©tails par catÃ©gorie :</h4>
                <div class="cylinder-chart-container">
            `;
            
            // Liste des catÃ©gories Ã  afficher avec couleurs
            const categories = [
                { key: 'araPotoana', label: 'Ara-potoana', color: '#4CAF50' },
                { key: 'taraLatsaky30min', label: 'Tara latsaky ny 30min', color: '#8BC34A' },
                { key: 'taraLatsaky1h', label: 'Tara latsaky ny 1h', color: '#CDDC39' },
                { key: 'taraMihoatra1h', label: 'Tara mihoatra ny 1h', color: '#FFC107' },
                { key: 'tapakAndro', label: 'Tapak\'andro', color: '#FF9800' },
                { key: 'nodyAloha', label: 'Nody aloha', color: '#2196F3' },
                { key: 'tsyTonga', label: 'Tsy tonga', color: '#F44336' },
                { key: 'nialaTsinyTara', label: 'Niala-tsiny tara', color: '#9C27B0' },
                { key: 'nialaTsinyTsyHoAvy', label: 'Niala-tsiny tsy ho avy', color: '#607D8B' }
            ];
            
            categories.forEach(cat => {
                const count = stats[cat.key] || 0;
                const percentage = stats.totalPVs > 0 ? ((count / stats.totalPVs) * 100).toFixed(1) : '0.0';
                
                html += `
                    <div class="cylinder-item">
                        <div class="cylinder-label">${cat.label}</div>
                        <div class="cylinder-bar-container">
                            <div class="cylinder-bar" style="width: ${percentage}%; background: ${cat.color};">
                                ${count}
                            </div>
                        </div>
                        <div class="cylinder-value">${percentage}%</div>
                    </div>
                `;
            });
            
            html += `
                </div>
            `;
            
            content.innerHTML = html;
            modal.style.display = 'flex';
        }
        
        function hideStatsModal() {
            document.getElementById('statsModal').style.display = 'none';
        }
        
        function parseDate(dateStr) {
            const formats = [
                'DD/MM/YYYY',
                'DD-MM-YYYY', 
                'YYYY-MM-DD',
                'MM/DD/YYYY'
            ];
            
            for (const format of formats) {
                const date = parseDateWithFormat(dateStr, format);
                if (date && !isNaN(date.getTime())) {
                    return date;
                }
            }
            
            const nativeDate = new Date(dateStr);
            if (!isNaN(nativeDate.getTime())) {
                return nativeDate;
            }
            
            console.warn(`Impossible de parser la date: ${dateStr}`);
            return null;
        }
        
        function parseDateWithFormat(dateStr, format) {
            const parts = dateStr.split(/[/\-.]/);
            const formatParts = format.split(/[/\-.]/);
            
            if (parts.length !== 3) return null;
            
            let day, month, year;
            
            for (let i = 0; i < 3; i++) {
                if (formatParts[i] === 'DD') day = parseInt(parts[i], 10);
                else if (formatParts[i] === 'MM') month = parseInt(parts[i], 10) - 1;
                else if (formatParts[i] === 'YYYY') year = parseInt(parts[i], 10);
            }
            
            if (day && month !== undefined && year) {
                return new Date(year, month, day);
            }
            
            return null;
        }
        
        function formatDateForDisplay(date) {
            return date.toLocaleDateString('fr-FR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        function findMatchingDates(searchTerm) {
            if (!searchTerm || searchTerm.length < 2) return [];
            
            const searchLower = searchTerm.toLowerCase();
            const matchingDates = [];
            
            sheetData.forEach((row, index) => {
                const hasMatch = row.some(cell => {
                    const cellValue = String(cell).toLowerCase();
                    return cellValue.includes(searchLower);
                });
                
                if (hasMatch) {
                    const dateStr = row[1] || '';
                    if (dateStr && dateStr.trim() !== '') {
                        matchingDates.push({
                            dateStr: dateStr,
                            date: parseDate(dateStr)
                        });
                    }
                }
            });
            
            const uniqueDates = [];
            const seenDates = new Set();
            
            matchingDates.forEach(item => {
                if (item.dateStr && !seenDates.has(item.dateStr)) {
                    seenDates.add(item.dateStr);
                    uniqueDates.push(item);
                }
            });
            
            return uniqueDates.slice(0, 10);
        }
        
        function showSuggestions(searchTerm, view = 'mobile') {
            let suggestionsContainer;
            
            if (view === 'desktop') {
                suggestionsContainer = document.getElementById('suggestionsContainerDesktop');
            } else {
                suggestionsContainer = document.getElementById('suggestionsContainer');
            }
            
            if (!suggestionsContainer) return;
            
            if (!searchTerm || searchTerm.length < 2) {
                suggestionsContainer.style.display = 'none';
                return;
            }
            
            const matchingDates = findMatchingDates(searchTerm);
            
            if (matchingDates.length === 0) {
                suggestionsContainer.style.display = 'none';
                return;
            }
            
            suggestionsContainer.innerHTML = matchingDates
                .map(item => {
                    return `
                        <div class="suggestion-item" data-search="${searchTerm}" data-date="${item.dateStr}">
                            ðŸ“… ${item.dateStr} - Cliquez pour voir les PV contenant "${searchTerm}"
                        </div>
                    `;
                })
                .join('');
            
            suggestionsContainer.style.display = 'block';
            
            document.querySelectorAll('.suggestion-item').forEach(item => {
                item.addEventListener('click', function() {
                    const searchTerm = this.getAttribute('data-search');
                    const dateStr = this.getAttribute('data-date');
                    
                    // Mettre Ã  jour le champ de recherche correspondant
                    if (view === 'desktop') {
                        document.getElementById('searchTextDesktop').value = searchTerm;
                    } else {
                        document.getElementById('searchText').value = searchTerm;
                    }
                    
                    currentSearchTerm = searchTerm;
                    
                    suggestionsContainer.style.display = 'none';
                    
                    const date = parseDate(dateStr);
                    if (date) {
                        const matchingRows = findPVByDate(date);
                        displayResults(matchingRows, `PV du ${formatDateForDisplay(date)} contenant "${searchTerm}"`);
                    }
                });
            });
        }
        
        function showDataInfo() {
            const dataInfo = document.getElementById('dataInfo');
            dataInfo.innerHTML = `
                <div class="success-message">
                    âœ… DonnÃ©es chargÃ©es avec succÃ¨s : ${sheetData.length} PV trouvÃ©(s)
                    <br><small>${allNames.size} participants uniques â€¢ ${Object.keys(toeranaStats).length} lieux de rÃ©union</small>
                </div>
            `;
            dataInfo.style.display = 'block';
        }
        
        function showError(message) {
            const searchSection = document.querySelector('.mobile-search-section');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.innerHTML = `
                <strong>âŒ Erreur de chargement:</strong> ${message}
            `;
            searchSection.appendChild(errorDiv);
            
            document.getElementById('retryButton').style.display = 'block';
            if (document.getElementById('retryButtonDesktop')) {
                document.getElementById('retryButtonDesktop').style.display = 'block';
            }
        }
        
        function clearErrorMessages() {
            const errorMessages = document.querySelectorAll('.error-message');
            errorMessages.forEach(msg => msg.remove());
        }
        
        function handleSearch(event, view = 'mobile') {
            if (event) event.preventDefault();
            
            let searchValue;
            if (view === 'desktop') {
                searchValue = document.getElementById('searchTextDesktop').value.trim();
            } else {
                searchValue = document.getElementById('searchText').value.trim();
            }
            
            currentSearchTerm = searchValue;
            
            if (!searchValue) {
                alert('Veuillez entrer un mot ou une phrase pour la recherche');
                return;
            }
            
            if (sheetData.length === 0) {
                alert('Aucune donnÃ©e chargÃ©e');
                return;
            }
            
            const results = searchData(searchValue);
            displayResults(results, searchValue);
            
            // Masquer les suggestions
            if (view === 'desktop') {
                document.getElementById('suggestionsContainerDesktop').style.display = 'none';
            } else {
                document.getElementById('suggestionsContainer').style.display = 'none';
            }
        }
        
        function showAllData() {
            if (sheetData.length === 0) {
                alert('Aucune donnÃ©e chargÃ©e');
                return;
            }
            
            currentSearchTerm = '';
            displayResults(sheetData, 'Tous les PV');
        }
        
        function searchData(searchValue) {
            const searchLower = searchValue.toLowerCase();
            
            return sheetData.filter(row => {
                return row.some(cell => {
                    const cellValue = String(cell).toLowerCase();
                    return cellValue.includes(searchLower);
                });
            });
        }
        
        function findPVByDate(date) {
            return sheetData.filter((row, index) => {
                const rowDateStr = row[1] || '';
                const rowDate = parseDate(rowDateStr);
                
                if (rowDate) {
                    return rowDate.getDate() === date.getDate() &&
                           rowDate.getMonth() === date.getMonth() &&
                           rowDate.getFullYear() === date.getFullYear();
                }
                
                return false;
            });
        }
        
        function prevMonth(view = 'mobile') {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar('mobile');
            renderCalendar('desktop');
        }
        
        function nextMonth(view = 'mobile') {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar('mobile');
            renderCalendar('desktop');
        }
        
        function highlightSearchText(text, searchTerm) {
            if (!searchTerm) return text;
            
            const searchLower = searchTerm.toLowerCase();
            const textStr = String(text);
            const textLower = textStr.toLowerCase();
            
            let result = '';
            let lastIndex = 0;
            let index = textLower.indexOf(searchLower);
            
            while (index !== -1) {
                result += textStr.substring(lastIndex, index);
                result += `<span class="search-highlight">${textStr.substring(index, index + searchTerm.length)}</span>`;
                lastIndex = index + searchTerm.length;
                index = textLower.indexOf(searchLower, lastIndex);
            }
            
            result += textStr.substring(lastIndex);
            
            return result;
        }
        
        function getTitleClass(header) {
            if (!header) return '';
            
            const headerLower = header.toLowerCase();
            
            if (headerLower.includes('fanamarihana famerenana')) {
                return 'title-fanamarihana-famerenana';
            }
            
            if (headerLower.includes('culte')) {
                return 'title-culte';
            }
            
            if (headerLower.includes('fanamarihana') || headerLower.includes('manokana')) {
                return 'title-fanamarihana';
            }
            
            if (headerLower.includes('fanapahan') || headerLower.includes('kevitra') || headerLower.includes('asa') || headerLower.includes('atao')) {
                return 'title-fanapahan-kevitra';
            }
            
            if (headerLower.includes('vaovao') || headerLower.includes('nouvelle') || headerLower.includes('news')) {
                return 'title-vaovao';
            }
            
            if (headerLower.includes('horodateur') || headerLower.includes('timestamp')) {
                return 'title-horodateur';
            }
            
            if (headerLower.includes('daty') || headerLower.includes('date')) {
                return 'title-daty';
            }
            
            if (headerLower.includes('ora fanombohana') || headerLower.includes('heure de dÃ©but') || headerLower.includes('dÃ©but')) {
                return 'title-ora-fanombohana';
            }
            
            if (headerLower.includes('ora firavana') || headerLower.includes('heure de fin') || headerLower.includes('fin')) {
                return 'title-ora-firavana';
            }
            
            if (headerLower.includes('toerana') || headerLower.includes('lieu') || headerLower.includes('endroit')) {
                return 'title-toerana';
            }
            
            if (headerLower.includes('ordre du jour') || headerLower.includes('ordre') || headerLower.includes('agenda')) {
                return 'title-ordre-jour';
            }
            
            if (headerLower.includes('fizotra') || headerLower.includes('ankapobeny') || headerLower.includes('fivoriana')) {
                return 'title-fizotra';
            }
            
            if (headerLower.includes('resaka') || headerLower.includes('discussion')) {
                return 'title-resaka';
            }
            
            if (headerLower.includes('vaovao') || headerLower.includes('nouvelle') || headerLower.includes('news')) {
                return 'title-vaovao';
            }
            
            if (headerLower.includes('famaranana') || headerLower.includes('fin') || headerLower.includes('conclusion')) {
                return 'title-famaranana';
            }
            
            if (headerLower.includes('fahatongavana') || headerLower.includes('prÃ©sence') || headerLower.includes('prÃ©sent')) {
                return 'title-fahatongavana';
            }
            
            return '';
        }

        function isProtectedColumn(header) {
            return PROTECTED_COLUMNS.some(protectedCol => 
                header.toLowerCase().includes(protectedCol.toLowerCase())
            );
        }

        function formatCellValue(value, header) {
            const strValue = String(value);
            
            if (strValue.startsWith('http://') || strValue.startsWith('https://')) {
                if (strValue.match(/\.(jpeg|jpg|png|gif|webp|bmp|svg)$/i)) {
                    return `<img src="${strValue}" alt="Image" onerror="this.style.display='none'" style="max-width: 100%; height: auto; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">`;
                }
                else {
                    return `<a href="${strValue}" target="_blank" style="color: #2980b9; text-decoration: none; font-weight: bold; padding: 6px 10px; background: #f8f9fa; border-radius: 5px; border: 1px solid #e9ecef; display: inline-block; transition: all 0.3s ease;">
                        ðŸ”— Ouvrir le lien
                    </a>`;
                }
            }
            
            return `<div style="font-size:14px; font-weight:500; white-space:pre-wrap; line-height:1.6; font-family: inherit;">${strValue}</div>`;
        }

        function extractFahatongavanaData(row) {
            const fahatongavanaData = {
                araPotoana: [],
                taraLatsaky30min: [],
                taraLatsaky1h: [],
                taraMihoatra1h: [],
                tapakAndro: [],
                nodyAloha: [],
                tsyTonga: [],
                nialaTsinyTara: [],
                nialaTsinyTsyHoAvy: []
            };

            headers.forEach((header, index) => {
                const value = row[index] || '';
                if (!value || value.trim() === '') return;

                const headerLower = header.toLowerCase();
                
                if (headerLower.includes('ara-potoana')) {
                    fahatongavanaData.araPotoana.push(value);
                } else if (headerLower.includes('tara latsaky ny 30min')) {
                    fahatongavanaData.taraLatsaky30min.push(value);
                } else if (headerLower.includes('tara latsaky ny 1h')) {
                    fahatongavanaData.taraLatsaky1h.push(value);
                } else if (headerLower.includes('tara mihoatra ny 1h')) {
                    fahatongavanaData.taraMihoatra1h.push(value);
                } else if (headerLower.includes('tapak\'andro')) {
                    fahatongavanaData.tapakAndro.push(value);
                } else if (headerLower.includes('nody aloha')) {
                    fahatongavanaData.nodyAloha.push(value);
                } else if (headerLower.includes('tsy tonga')) {
                    fahatongavanaData.tsyTonga.push(value);
                } else if (headerLower.includes('niala-tsiny tara')) {
                    fahatongavanaData.nialaTsinyTara.push(value);
                } else if (headerLower.includes('niala-tsiny tsy ho avy')) {
                    fahatongavanaData.nialaTsinyTsyHoAvy.push(value);
                }
            });

            return fahatongavanaData;
        }

        function extractOrdreDuJourData(row) {
            const ordreDuJourData = [];
            
            headers.forEach((header, index) => {
                const value = row[index] || '';
                if (!value || value.trim() === '') return;

                const headerLower = header.toLowerCase();
                
                if (headerLower.includes('ordre du jour')) {
                    ordreDuJourData.push({
                        header: header,
                        value: value
                    });
                }
            });

            ordreDuJourData.sort((a, b) => {
                const numA = extractNumber(a.header);
                const numB = extractNumber(b.header);
                return numA - numB;
            });

            return ordreDuJourData;
        }

        function extractNumber(text) {
            const match = text.match(/\[(\d+)\]/);
            return match ? parseInt(match[1]) : 0;
        }

        function formatFahatongavanaSection(fahatongavanaData) {
            let html = '<div class="fahatongavana-section">';
            
            if (fahatongavanaData.araPotoana.length > 0) {
                html += `
                    <div class="fahatongavana-row">
                        <div class="fahatongavana-label">Ara-potoana</div>
                        <div class="fahatongavana-value">${fahatongavanaData.araPotoana.join(' / ')}</div>
                    </div>
                `;
            }
            
            if (fahatongavanaData.taraLatsaky30min.length > 0) {
                html += `
                    <div class="fahatongavana-row">
                        <div class="fahatongavana-label">Tara latsaky ny 30min</div>
                        <div class="fahatongavana-value">${fahatongavanaData.taraLatsaky30min.join(' / ')}</div>
                    </div>
                `;
            }
            
            if (fahatongavanaData.taraLatsaky1h.length > 0) {
                html += `
                    <div class="fahatongavana-row">
                        <div class="fahatongavana-label">Tara latsaky ny 1h</div>
                        <div class="fahatongavana-value">${fahatongavanaData.taraLatsaky1h.join(' / ')}</div>
                    </div>
                `;
            }
            
            if (fahatongavanaData.taraMihoatra1h.length > 0) {
                html += `
                    <div class="fahatongavana-row">
                        <div class="fahatongavana-label">Tara mihoatra ny 1h</div>
                        <div class="fahatongavana-value">${fahatongavanaData.taraMihoatra1h.join(' / ')}</div>
                    </div>
                `;
            }
            
            if (fahatongavanaData.tapakAndro.length > 0) {
                html += `
                    <div class="fahatongavana-row">
                        <div class="fahatongavana-label">Tapak'andro</div>
                        <div class="fahatongavana-value">${fahatongavanaData.tapakAndro.join(' / ')}</div>
                    </div>
                `;
            }
            
            if (fahatongavanaData.nodyAloha.length > 0) {
                html += `
                    <div class="fahatongavana-row">
                        <div class="fahatongavana-label">Nody aloha</div>
                        <div class="fahatongavana-value">${fahatongavanaData.nodyAloha.join(' / ')}</div>
                    </div>
                `;
            }
            
            if (fahatongavanaData.tsyTonga.length > 0) {
                html += `
                    <div class="fahatongavana-row">
                        <div class="fahatongavana-label">Tsy tonga</div>
                        <div class="fahatongavana-value">${fahatongavanaData.tsyTonga.join(' / ')}</div>
                    </div>
                `;
            }
            
            if (fahatongavanaData.nialaTsinyTara.length > 0) {
                html += `
                    <div class="fahatongavana-row">
                        <div class="fahatongavana-label">Niala-tsiny tara</div>
                        <div class="fahatongavana-value">${fahatongavanaData.nialaTsinyTara.join(' / ')}</div>
                    </div>
                `;
            }
            
            if (fahatongavanaData.nialaTsinyTsyHoAvy.length > 0) {
                html += `
                    <div class="fahatongavana-row">
                        <div class="fahatongavana-label">Niala-tsiny tsy ho avy</div>
                        <div class="fahatongavana-value">${fahatongavanaData.nialaTsinyTsyHoAvy.join(' / ')}</div>
                    </div>
                `;
            }
            
            html += '</div>';
            return html;
        }

        function formatOrdreDuJourSection(ordreDuJourData) {
            if (ordreDuJourData.length === 0) return '';
            
            let html = '<div class="ordre-du-jour-section">';
            
            ordreDuJourData.forEach((item, index) => {
                const num = extractNumber(item.header) || (index + 1);
                html += `
                    <div class="ordre-du-jour-item">
                        <strong>${num}.</strong> ${item.value}
                    </div>
                `;
            });
            
            html += '</div>';
            return html;
        }
        
        function displayResults(results, searchTerm) {
            const resultsSection = document.getElementById('resultsSection');
            const resultContent = document.getElementById('resultContent');
            const resultTitle = document.getElementById('resultTitle');
            
            if (results.length === 0) {
                resultContent.innerHTML = `
                    <div class="no-results">
                        <h3>âŒ Aucun PV trouvÃ© ou selectionnÃ© </h3>
                        <p>Aucun procÃ¨s-verbal ne correspond Ã  votre recherche "${searchTerm}"</p>
                    </div>
                `;
            } else {
                let html = `
                    <div class="search-stats">
                        <strong>${results.length} PV trouvÃ©(s)</strong> pour : "${searchTerm}"
                        ${currentSearchTerm ? `<br><small>Le mot recherchÃ© est surlignÃ© en <span style="background-color: #ffeb3b; padding: 1px 3px; border-radius: 3px;">jaune</span></small>` : ''}
                    </div>
                `;

                if (!showProtectedColumns && headers.some(header => isProtectedColumn(header))) {
                    html += `
                        <div class="protected-columns-info">
                            <strong>â„¹ï¸ Information :</strong> La colonne "Rohy fiche" est masquÃ©e pour des raisons de sÃ©curitÃ©.
                            <br>Utilisez le bouton "ðŸ”— Admin - Afficher les colonnes protÃ©gÃ©es" pour y accÃ©der.
                        </div>
                    `;
                }
                
                results.forEach((row, index) => {
                    let dateStr = 'Date non spÃ©cifiÃ©e';
                    let titre = `PV ${index + 1}`;
                    
                    if (row.originalIndex !== undefined) {
                        const originalRow = sheetData[row.originalIndex];
                        dateStr = originalRow[1] || 'Date non spÃ©cifiÃ©e';
                        titre = originalRow[2] || `PV ${index + 1}`;
                    } else {
                        dateStr = row[1] || 'Date non spÃ©cifiÃ©e';
                        titre = row[2] || `PV ${index + 1}`;
                    }
                    
                    // NOUVEAU : Calculer le nombre de personnes prÃ©sentes pour ce PV
                    const fahatongavanaData = extractFahatongavanaData(row);
                    const totalParticipants = countTotalParticipants(fahatongavanaData);
                    const participantText = totalParticipants > 0 ? `${totalParticipants} personnes prÃ©sentes` : '';
                    
                    html += `
                        <div class="pv-item">
                            <div class="pv-header">
                                <h2>ðŸ“‹ ProcÃ¨s-Verbal de RÃ©union</h2>
                                <h3 class="pv-title">
                                    ${currentSearchTerm ? highlightSearchText(titre, currentSearchTerm) : titre} â€” ${dateStr}
                                    ${participantText ? `<span class="participant-count">${participantText}</span>` : ''}
                                </h3>
                            </div>
                            <div style="padding: 15px;">
                    `;
                    
                    let datyValue = '';
                    let oraFanombohanaValue = '';
                    let oraFiravanaValue = '';
                    let toeranaValue = '';
                    
                    for (let colIndex = 0; colIndex < headers.length; colIndex++) {
                        const header = headers[colIndex] || '';
                        const value = row[colIndex] || '';
                        
                        if (header.toLowerCase().includes('daty')) {
                            datyValue = value;
                        } else if (header.toLowerCase().includes('ora fanombohana')) {
                            oraFanombohanaValue = value;
                        } else if (header.toLowerCase().includes('ora firavana')) {
                            oraFiravanaValue = value;
                        } else if (header.toLowerCase().includes('toerana')) {
                            toeranaValue = value;
                        }
                    }
                    
                    if (datyValue || oraFanombohanaValue || oraFiravanaValue || toeranaValue) {
                        html += `
                            <div class="date-time-row">
                                ${datyValue ? `
                                    <div class="date-time-item">
                                        <div>ðŸ“…</div>
                                        <div>
                                            <div class="date-time-label">Daty</div>
                                            <div class="date-time-value">${currentSearchTerm ? highlightSearchText(datyValue, currentSearchTerm) : datyValue}</div>
                                        </div>
                                    </div>
                                ` : ''}
                                ${oraFanombohanaValue ? `
                                    <div class="date-time-item">
                                        <div>â°</div>
                                        <div>
                                            <div class="date-time-label">Ora fanombohana</div>
                                            <div class="date-time-value">${currentSearchTerm ? highlightSearchText(oraFanombohanaValue, currentSearchTerm) : oraFanombohanaValue}</div>
                                        </div>
                                    </div>
                                ` : ''}
                                ${oraFiravanaValue ? `
                                    <div class="date-time-item">
                                        <div>â°</div>
                                        <div>
                                            <div class="date-time-label">Ora firavana</div>
                                            <div class="date-time-value">${currentSearchTerm ? highlightSearchText(oraFiravanaValue, currentSearchTerm) : oraFiravanaValue}</div>
                                        </div>
                                    </div>
                                ` : ''}
                                ${toeranaValue ? `
                                    <div class="date-time-item">
                                        <div>ðŸ“</div>
                                        <div>
                                            <div class="date-time-label">Toerana</div>
                                            <div class="date-time-value">${currentSearchTerm ? highlightSearchText(toeranaValue, currentSearchTerm) : toeranaValue}</div>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    }
                    
                    const hasFahatongavana = Object.values(fahatongavanaData).some(arr => arr.length > 0);
                    
                    if (hasFahatongavana) {
                        html += `
                            <div class="section-title">FAHATONGAVANA</div>
                            ${formatFahatongavanaSection(fahatongavanaData)}
                        `;
                    }
                    
                    const ordreDuJourData = extractOrdreDuJourData(row);
                    if (ordreDuJourData.length > 0) {
                        html += `
                            <div class="section-title">ORDRE DU JOUR</div>
                            ${formatOrdreDuJourSection(ordreDuJourData)}
                        `;
                    }
                    
                    const excludedHeaders = [
                        'horodateur', 'timestamp', 'daty', 'ora fanombohana', 'ora firavana', 'toerana'
                    ];
                    
                    const processedHeaders = new Set();
                    
                    for (let colIndex = 0; colIndex < headers.length; colIndex++) {
                        const header = headers[colIndex] || `Colonne ${colIndex + 1}`;
                        let value = row[colIndex] || '';
                        
                        if (!showProtectedColumns && isProtectedColumn(header)) {
                            continue;
                        }
                        
                        if (excludedHeaders.some(excluded => header.toLowerCase().includes(excluded)) ||
                            processedHeaders.has(header)) {
                            continue;
                        }
                        
                        if ((searchTerm === 'Fanamarihana Famerenana' || 
                             searchTerm === 'Fanapahan-kevitra sy Asa ho atao' || 
                             searchTerm === 'Vaovao') && 
                            value === '') {
                            continue;
                        }
                        
                        if (header.toLowerCase().includes('ara-potoana') ||
                            header.toLowerCase().includes('tara latsaky') ||
                            header.toLowerCase().includes('tara mihoatra') ||
                            header.toLowerCase().includes('tapak') ||
                            header.toLowerCase().includes('nody') ||
                            header.toLowerCase().includes('tsy tonga') ||
                            header.toLowerCase().includes('niala-tsiny') ||
                            header.toLowerCase().includes('ordre du jour')) {
                            continue;
                        }
                        
                        if (value !== undefined && value !== null && value !== '' && value.trim() !== '') {
                            const highlightedValue = currentSearchTerm ? highlightSearchText(value, currentSearchTerm) : value;
                            const titleClass = getTitleClass(header);
                            
                            html += `
                                <table class="data-table" style="margin-bottom: 12px;">
                                    <tr>
                                        <th class="${titleClass}">${header}</th>
                                        <td>${formatCellValue(highlightedValue, header)}</td>
                                    </tr>
                                </table>
                            `;
                            
                            processedHeaders.add(header);
                        }
                    }
                    
                    html += `
                            </div>
                        </div>
                    `;
                });
                
                resultContent.innerHTML = html;
            }
            
            resultTitle.textContent = `RÃ©sultats pour "${searchTerm}"`;
            resultsSection.style.display = 'block';
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        function closeResults() {
            document.getElementById('resultsSection').style.display = 'none';
            currentSearchTerm = '';
        }

        async function loadDataFromGoogleSheets() {
            console.log('ðŸ” DÃ©but du chargement des donnÃ©es PV...');
            document.getElementById('loadingIndicator').style.display = 'block';
            if (document.getElementById('retryButton')) {
                document.getElementById('retryButton').style.display = 'none';
            }
            if (document.getElementById('retryButtonDesktop')) {
                document.getElementById('retryButtonDesktop').style.display = 'none';
            }
            clearErrorMessages();
            
            try {
                console.log('ðŸ”„ Essai 1: AccÃ¨s direct...');
                let response = await fetch(GOOGLE_SHEETS_URL);
                
                if (response.ok) {
                    const csvText = await response.text();
                    console.log('âœ… SuccÃ¨s avec accÃ¨s direct');
                    processCSVData(csvText);
                    return;
                }
                throw new Error(`Direct failed: ${response.status}`);
                
            } catch (error1) {
                console.log('âŒ Ã‰chec accÃ¨s direct:', error1.message);
                
                try {
                    console.log('ðŸ”„ Essai 2: AllOrigins...');
                    const allOriginsUrl = 'https://api.allorigins.win/raw?url=';
                    let response = await fetch(allOriginsUrl + encodeURIComponent(GOOGLE_SHEETS_URL));
                    
                    if (response.ok) {
                        const csvText = await response.text();
                        console.log('âœ… SuccÃ¨s avec AllOrigins');
                        processCSVData(csvText);
                        return;
                    }
                    throw new Error(`AllOrigins failed: ${response.status}`);
                    
                } catch (error2) {
                    console.log('âŒ Ã‰chec AllOrigins:', error2.message);
                    showError('Impossible de charger les donnÃ©es. VÃ©rifiez votre connexion internet et que le Google Sheet est bien publiÃ©.');
                }
            }
        }

        function parseCSV(csvText) {
            const lines = [];
            let currentLine = [];
            let currentField = '';
            let inQuotes = false;
            
            for (let i = 0; i < csvText.length; i++) {
                const char = csvText[i];
                const nextChar = csvText[i + 1];
                
                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        currentField += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    currentLine.push(currentField);
                    currentField = '';
                } else if (char === '\n' && !inQuotes) {
                    currentLine.push(currentField);
                    lines.push(currentLine);
                    currentLine = [];
                    currentField = '';
                } else if (char === '\r') {
                    continue;
                } else {
                    currentField += char;
                }
            }
            
            if (currentField !== '' || currentLine.length > 0) {
                currentLine.push(currentField);
                lines.push(currentLine);
            }
            
            return lines;
        }
        
        function processCSVData(csvText) {
            try {
                console.log('ðŸ“„ Traitement des donnÃ©es CSV...');
                
                if (!csvText || csvText.trim().length === 0) {
                    throw new Error('Le fichier CSV est vide');
                }
                
                const lines = parseCSV(csvText);
                
                if (!lines || lines.length === 0) {
                    throw new Error('Aucune donnÃ©e parsÃ©e');
                }
                
                headers = lines[0] || [];
                console.log('ðŸ·ï¸ En-tÃªtes dÃ©tectÃ©s:', headers);
                
                sheetData = lines.slice(1).filter(row => 
                    row && row.some(cell => cell && cell.trim() !== '')
                );
                
                console.log('ðŸ“ˆ DonnÃ©es extraites:', sheetData.length, 'PV trouvÃ©s');
                
                if (sheetData.length === 0) {
                    throw new Error('Aucun PV avec des donnÃ©es trouvÃ©');
                }
                
                extractDatesWithData();
                calculateStatistics();
                showDataInfo();
                renderCalendar('mobile');
                renderCalendar('desktop');
                
            } catch (error) {
                console.error('âŒ Erreur de traitement:', error);
                showError(error.message);
            } finally {
                document.getElementById('loadingIndicator').style.display = 'none';
            }
        }

        function showFanamarihanaFamerenana() {
            if (sheetData.length === 0) {
                alert('Aucune donnÃ©e chargÃ©e');
                return;
            }
            
            currentSearchTerm = '';
            const filteredData = sheetData.map((row, originalIndex) => {
                const filteredRow = [];
                for (let colIndex = 0; colIndex < headers.length; colIndex++) {
                    const header = headers[colIndex] || '';
                    if (header.toLowerCase().includes('fanamarihana famerenana')) {
                        filteredRow[colIndex] = row[colIndex] || '';
                    } else {
                        filteredRow[colIndex] = '';
                    }
                }
                filteredRow.originalIndex = originalIndex;
                return filteredRow;
            }).filter(row => row.some(cell => cell && cell.trim() !== ''));
            
            displayResults(filteredData, 'Fanamarihana Famerenana');
        }
        
        function showFanapahanKevitra() {
            if (sheetData.length === 0) {
                alert('Aucune donnÃ©e chargÃ©e');
                return;
            }
            
            currentSearchTerm = '';
            const filteredData = sheetData.map((row, originalIndex) => {
                const filteredRow = [];
                for (let colIndex = 0; colIndex < headers.length; colIndex++) {
                    const header = headers[colIndex] || '';
                    if (header.toLowerCase().includes('fanapahan') || 
                        header.toLowerCase().includes('kevitra') || 
                        header.toLowerCase().includes('asa ho atao') ||
                        header.toLowerCase().includes('asa ata')) {
                        filteredRow[colIndex] = row[colIndex] || '';
                    } else {
                        filteredRow[colIndex] = '';
                    }
                }
                filteredRow.originalIndex = originalIndex;
                return filteredRow;
            }).filter(row => row.some(cell => cell && cell.trim() !== ''));
            
            displayResults(filteredData, 'Fanapahan-kevitra sy Asa ho atao');
        }
        
        function showVaovao() {
            if (sheetData.length === 0) {
                alert('Aucune donnÃ©e chargÃ©e');
                return;
            }
            
            currentSearchTerm = '';
            const filteredData = sheetData.map((row, originalIndex) => {
                const filteredRow = [];
                for (let colIndex = 0; colIndex < headers.length; colIndex++) {
                    const header = headers[colIndex] || '';
                    if (header.toLowerCase().includes('vaovao') || 
                        header.toLowerCase().includes('nouvelle') || 
                        headerLower.includes('news')) {
                        filteredRow[colIndex] = row[colIndex] || '';
                    } else {
                        filteredRow[colIndex] = '';
                    }
                }
                filteredRow.originalIndex = originalIndex;
                return filteredRow;
            }).filter(row => row.some(cell => cell && cell.trim() !== ''));
            
            displayResults(filteredData, 'Vaovao');
        }
    </script>
</body>
</html>
