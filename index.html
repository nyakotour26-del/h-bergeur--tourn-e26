<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H√©bergements Tourn√©e 2026</title>
    <style>
        :root {
            --primary-color: #8b0000;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --text-color: #2c3e50;
            --border-radius: 8px;
            --box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            --orange-color: #ff6b35;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #f5f7fa;
            padding: 20px;
            background-image: linear-gradient(rgba(245, 247, 250, 0.9), rgba(245, 247, 250, 0.9)), 
                              url('https://images.unsplash.com/photo-1513584684374-8bab748fbf90?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 40% 1fr;
            gap: 20px;
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        header {
            grid-column: 1 / -1;
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white url('https://images.unsplash.com/photo-1586023492125-27b2c045efd7?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80') center center;
            background-size: cover;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            color: white;
            position: sticky;
            top: 20px;
            z-index: 100;
            border-bottom: 3px solid var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }
        
        .header-overlay {
            background: rgba(139, 0, 0, 0.7);
            padding: 15px;
            border-radius: var(--border-radius);
            width: 100%;
        }
        
        .header-left {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            text-align: left;
            flex: 1;
        }
        
        .header-search {
            display: none; /* Supprim√© selon la demande */
        }
        
        .decoration-images {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 10px;
            font-size: 1.5em;
            opacity: 0.6;
        }
        
        .decoration-images-left {
            position: absolute;
            top: 10px;
            left: 20px;
            display: flex;
            gap: 10px;
            font-size: 1.5em;
            opacity: 0.6;
        }
        
        h1 {
            margin-bottom: 5px;
            font-size: 2.2em;
            font-weight: 600;
            color: white;
            letter-spacing: 0.5px;
            line-height: 1.2;
        }
        
        header p {
            font-size: 1.1em;
            opacity: 0.9;
            margin-bottom: 0;
            color: white;
            line-height: 1.3;
        }
        
        .fixed-nav-buttons {
            position: fixed;
            top: 150px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }
        
        .icon-button {
            background: rgba(44, 62, 80, 0.9);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            font-size: 24px;
        }
        
        .icon-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }
        
        .icon-button.home {
            background: rgba(39, 174, 96, 0.9);
        }
        
        .icon-button.list {
            background: rgba(52, 152, 219, 0.9);
        }
        
        .icon-button.calendar-btn {
            background: rgba(231, 76, 60, 0.9);
        }
        
        .icon-button.email-btn {
            background: rgba(155, 89, 182, 0.9);
        }
        
        .icon-button.export {
            background: rgba(241, 196, 15, 0.9);
        }
        
        .icon-button.search-btn {
            background: rgba(41, 128, 185, 0.9);
        }
        
        .icon-button.email-btn.disabled {
            background: rgba(149, 165, 166, 0.9);
            cursor: not-allowed;
        }
        
        .icon-button.export.locked {
            background: rgba(149, 165, 166, 0.9);
            cursor: not-allowed;
        }
        
        .icon-button.export.locked:hover,
        .icon-button.email-btn.disabled:hover {
            transform: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .search-section {
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            position: relative;
            background-image: linear-gradient(to bottom right, rgba(255,255,255,0.95), rgba(255,255,255,0.98));
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .action-buttons-sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .action-button {
            background: linear-gradient(135deg, #27ae60, #219a53);
            color: white;
            border: none;
            padding: 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .action-button.priere {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .calendar-section {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
        }
        
        .calendar-section::before {
            content: "";
            position: absolute;
            top: -50px;
            right: -50px;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(139,0,0,0.1) 0%, transparent 70%);
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .calendar-nav {
            display: flex;
            gap: 10px;
        }
        
        .calendar-nav button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .calendar-nav button:hover {
            background: #6a0000;
            transform: scale(1.05);
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            padding: 10px;
            background-color: var(--light-color);
            border-radius: 4px;
            color: var(--secondary-color);
        }
        
        .calendar-day {
            text-align: center;
            padding: 12px;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.2s;
            border: 1px solid #f0f0f0;
            position: relative;
            min-height: 60px;
            font-size: 14px;
        }
        
        .calendar-day:hover {
            background-color: #f8f9fa;
        }
        
        .calendar-day.has-data {
            background-color: #e8f4fd;
            font-weight: bold;
        }
        
        .calendar-day.selected {
            background-color: var(--primary-color);
            color: white;
        }
        
        .calendar-day.other-month {
            background-color: #f9f9f9;
            color: #aaa;
        }
        
        .calendar-day.booking-period {
            background-color: #fff3cd;
            border: 2px solid #ffc107;
        }
        
        .calendar-day.booking-period::after {
            content: 'üè®';
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 12px;
        }
        
        .calendar-day.today {
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
            border: 2px solid #388E3C;
        }
        
        .stats-section {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, white, #f8f9fa);
            padding: 12px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
            border: 1px solid #e9ecef;
            transition: transform 0.3s ease;
            cursor: pointer;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        
        .stat-value {
            font-size: 1.3em;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 3px;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.75em;
            line-height: 1.2;
        }
        
        .filters-sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .filter-group {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: var(--border-radius);
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            position: relative;
        }
        
        .filter-group h3 {
            margin-bottom: 10px;
            color: #3498db;
            font-size: 1.1em; /* Augment√© */
            font-weight: 600; /* Ajout√© */
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        .filter-group h3.toggle-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .filter-group h3.toggle-title .toggle-indicator {
            font-size: 0.8em;
            color: #666;
            margin-left: auto;
        }
        
        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .tag {
            background: var(--primary-color);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tag:hover {
            background: #6a0000;
            transform: translateY(-2px);
        }
        
        .tag.nom {
            background: #3498db;
        }
        
        .tag.nom:hover {
            background: #2980b9;
        }
        
        .tag.pays {
            background: #27ae60;
        }
        
        .tag.pays:hover {
            background: #219653;
        }
        
        .tag.lieu {
            background: #9b59b6;
        }
        
        .tag.lieu:hover {
            background: #8e44ad;
        }
        
        .tag.priere {
            background: #e74c3c;
        }
        
        .tag.priere:hover {
            background: #c0392b;
        }
        
        .tag.heberge {
            background: #f39c12;
        }
        
        .tag.heberge:hover {
            background: #d35400;
        }
        
        .tag.type {
            background: #2196F3;
        }
        
        .tag.type:hover {
            background: #0d47a1;
        }
        
        .results-section {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            margin-top: 0;
        }
        
        .result-header {
            background-color: var(--secondary-color);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .result-content {
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .fiche-item {
            margin-bottom: 40px;
            border: 1px solid #e1e1e1;
            border-radius: var(--border-radius);
            overflow: hidden;
            background: #f8f9fa;
            position: relative;
        }
        
        .fiche-header {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            padding: 20px;
            position: relative;
        }
        
        .fiche-title {
            color: white;
            font-weight: bold;
            margin-top: 0;
            font-size: 1.4em;
        }
        
        .fiche-pays {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9em;
            color: white;
            font-weight: normal;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .info-item {
            padding: 15px;
            border-right: 1px solid #e9ecef;
        }
        
        .info-item:last-child {
            border-right: none;
        }
        
        .info-label {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 0.9em;
            margin-bottom: 5px;
            display: block;
        }
        
        .info-value {
            color: var(--text-color);
            font-size: 1.1em;
        }
        
        .date-clickable {
            cursor: pointer;
            color: #3498db;
            text-decoration: underline;
            transition: all 0.3s ease;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .date-clickable:hover {
            background-color: #e8f4fd;
            color: #2980b9;
        }
        
        .location-clickable {
            cursor: pointer;
            color: #27ae60;
            text-decoration: underline;
            transition: all 0.3s ease;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .location-clickable:hover {
            background-color: #e8f5e8;
            color: #219653;
        }
        
        .localisation-section {
            padding: 15px;
            background: linear-gradient(135deg, #e8f5e8, #d4edda);
            border-bottom: 1px solid #c3e6cb;
        }
        
        .localisation-label {
            font-weight: bold;
            color: #27ae60;
            font-size: 1.1em; /* Augment√© */
            margin-bottom: 5px;
            display: block;
        }
        
        .localisation-content {
            color: var(--text-color);
            font-size: 1.2em; /* Augment√© */
            font-weight: bold; /* Ajout√© */
            line-height: 1.4;
        }
        
        .phone-clickable {
            cursor: pointer;
            color: #e74c3c;
            text-decoration: underline;
            transition: all 0.3s ease;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .phone-clickable:hover {
            background-color: #fde8e6;
            color: #c0392b;
        }
        
        .hote-section {
            padding: 20px;
            background: linear-gradient(135deg, #f8fff8, #e8f5e8);
            border-bottom: 1px solid #d4edda;
            text-align: left;
        }
        
        .hote-label {
            font-weight: bold;
            color: #27ae60;
            font-size: 1em;
            margin-bottom: 10px;
            display: block;
        }
        
        .hote-name {
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Marker Felt', cursive;
            font-size: 2.2em;
            color: #27ae60;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            line-height: 1.2;
        }
        
        .links-section {
            display: none; /* Cach√© car les boutons photo ont √©t√© supprim√©s */
        }
        
        .link-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            text-align: center;
            text-decoration: none;
            display: block;
            transition: all 0.3s;
        }
        
        .link-button:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
    /* =============== STYLE POUR LES APER√áUS PHOTOS - AGRANDI 10cm =============== */
.photo-preview-container {
    display: inline-block;
    margin: 10px;
    text-align: center;
    vertical-align: top;
    width: 400px; /* Environ 10cm */
    max-width: 100%;
}

.photo-link-with-preview {
    display: block;
    width: 400px; /* Environ 10cm */
    height: 400px; /* Environ 10cm */
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    border: 3px solid #ffd700;
    position: relative;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
}
        
        .photo-link-with-preview:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            border-color: #2c3e50;
        }
        
        .photo-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
            cursor: pointer;
        }
        
        .photo-link-with-preview:hover .photo-thumbnail {
            transform: scale(1.1);
        }
        
        .photo-link-with-preview::after {
            content: 'üîç Voir en grand';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px;
            font-size: 0.9em;
            font-weight: 600;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            text-align: center;
        }
        
        .photo-link-with-preview:hover::after {
            transform: translateY(0);
        }
        
        .photo-label {
            margin-top: 12px;
            font-size: 0.95em;
            font-weight: 600;
            color: var(--primary-color);
            padding: 8px 12px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
            border-left: 4px solid var(--secondary-color);
        }
        
        .photo-thumbnail.loading {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .photos-preview-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start;
            gap: 20px;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: var(--border-radius);
            border: 1px solid #e9ecef;
        }
        
        .photo-link-preview:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .photo-link-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        
        .photo-link-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            text-align: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .photo-link-popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .photo-link-popup-content {
            max-width: 90%;
            max-height: 90%;
            position: relative;
        }
        
        .photo-link-popup-content img {
            max-width: 100%;
            max-height: 90vh;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(255,255,255,0.1);
        }
        
        .photo-link-popup-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.8);
            color: #333;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .photo-link-popup-close:hover {
            background: white;
            transform: rotate(90deg);
        }
        
        .photo-link-section {
            padding: 15px;
            background: #f8f9fa;
            border-radius: var(--border-radius);
            margin: 15px 0;
            border-left: 4px solid #9b59b6;
        }
        
        .photo-link-label {
            font-weight: bold;
            color: #9b59b6;
            font-size: 1em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .observations-section {
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #fff8e1, #ffecb3);
            border-radius: var(--border-radius);
            border-left: 4px solid #ff9800;
        }
        
        .observations-label {
            font-weight: bold;
            color: #e65100;
            font-size: 1em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .observations-content {
            color: var(--text-color);
            line-height: 1.5;
            font-style: italic;
        }
        
        .heberges-list {
            margin-top: 15px;
            padding: 15px;
            background: #fff3cd;
            border-radius: var(--border-radius);
            border-left: 4px solid #ffc107;
        }
        
        .heberges-label {
            font-weight: bold;
            color: var(--orange-color);
            font-size: 1em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .heberges-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .heberge-tag {
            background: #ffc107;
            color: #856404;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .heberge-tag:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .marquants-section {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: var(--border-radius);
            border-left: 4px solid #9b59b6;
        }
        
        .marquants-label {
            font-weight: bold;
            color: #9b59b6;
            font-size: 1em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .marquants-content {
            color: var(--text-color);
            line-height: 1.5;
        }
        
        .priere-section {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: var(--border-radius);
            border-left: 4px solid #e74c3c;
        }
        
        .priere-label {
            font-weight: bold;
            color: #e74c3c;
            font-size: 1em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .priere-content {
            color: var(--text-color);
            font-style: italic;
            line-height: 1.5;
            white-space: pre-wrap;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            text-align: left;
            padding: 12px;
            width: 20%;
            background: var(--light-color);
            color: var(--primary-color);
            font-weight: bold;
            font-size: 14px;
            vertical-align: top;
            white-space: normal;
            word-wrap: break-word;
            border-bottom: 1px solid #ddd;
        }
        
        .data-table td {
            padding: 12px;
            font-size: 15px;
            color: var(--text-color);
            white-space: pre-wrap;
            border-bottom: 1px solid #ddd;
        }
        
        .data-table tr:nth-child(even) td {
            background: #f9f9f9;
        }
        
        .data-table img {
            max-width: 95%;
            max-height: 250px;
            display: block;
            margin: 5px auto;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .data-table a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: bold;
        }
        
        .data-table a:hover {
            text-decoration: underline;
        }
        
        .contact-section {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: var(--border-radius);
            border-left: 4px solid #3498db;
        }
        
        .contact-label {
            font-weight: bold;
            color: var(--orange-color);
            font-size: 1em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .contact-link {
            color: #3498db;
            text-decoration: none;
            font-weight: bold;
        }
        
        .contact-link:hover {
            text-decoration: underline;
        }
        
        .loading {
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }
        
        .error-message {
            background-color: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
        }
        
        .success-message {
            background-color: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
        }
        
        .export-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .export-modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .export-options {
            margin: 20px 0;
        }
        
        .export-type {
            margin-bottom: 20px;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .export-type:hover {
            border-color: var(--primary-color);
            background: #f8f9fa;
        }
        
        .export-type.selected {
            border-color: var(--primary-color);
            background: #f8f9fa;
        }
        
        .export-type-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .export-type-description {
            font-size: 0.9em;
            color: #666;
        }
        
        .export-format-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .format-option {
            flex: 1;
            padding: 10px;
            text-align: center;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .format-option:hover {
            border-color: var(--primary-color);
        }
        
        .format-option.selected {
            border-color: var(--primary-color);
            background: #f8f9fa;
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .email-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .email-modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .email-recipients {
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            background: #f9f9f9;
        }
        
        .recipient-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
        }
        
        .recipient-item:last-child {
            border-bottom: none;
        }
        
        .upload-section {
            margin: 20px 0;
            padding: 15px;
            border: 2px dashed #3498db;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .upload-area {
            text-align: center;
            padding: 20px;
        }
        
        .upload-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        
        .upload-button:hover {
            background: #2980b9;
        }
        
        .photos-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .photo-preview {
            position: relative;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .photo-preview img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            display: block;
        }
        
        .remove-photo {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(231, 76, 60, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .photo-info {
            padding: 5px;
            background: rgba(0,0,0,0.7);
            color: white;
            font-size: 10px;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
        }
        
        .upload-instructions {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
            text-align: center;
        }

        .hote-info-section {
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #fff3e0, #ffe0b2);
            border-radius: var(--border-radius);
            border-left: 4px solid #ff9800;
        }
        
        .hote-info-label {
            font-weight: bold;
            color: #e65100;
            font-size: 1em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .hote-info-content {
            color: var(--text-color);
            line-height: 1.5;
            font-style: italic;
        }

        .hebergement-type-section {
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-radius: var(--border-radius);
            border-left: 4px solid #2196F3;
        }
        
        .hebergement-type-label {
            font-weight: bold;
            color: #0d47a1;
            font-size: 1em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .hebergement-type-content {
            color: var(--text-color);
            line-height: 1.5;
            font-style: italic;
        }

        .password-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1001;
            justify-content: center;
            align-items: center;
        }
        
        .password-modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
        }
        
        .password-input {
            width: 100%;
            padding: 10px;
            margin: 15px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .password-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .data-info {
            grid-column: 1 / -1;
        }

        .action-buttons-mobile {
            display: none;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .action-button-mobile {
            background: linear-gradient(135deg, #27ae60, #219a53);
            color: white;
            border: none;
            padding: 12px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.9em;
        }
        
        .action-button-mobile.priere {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .action-button-mobile.tableau {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }

        .mobile-filters {
            display: none;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .mobile-filter-group {
            background: white;
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        .mobile-filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
            padding: 5px 0;
        }
        
        .mobile-filter-title {
            font-weight: bold;
            font-size: 1em; /* Augment√© */
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .mobile-filter-title.hotes { color: #3498db; }
        .mobile-filter-title.pays { color: #27ae60; }
        .mobile-filter-title.lieux { color: #9b59b6; }
        .mobile-filter-title.heberges { color: #f39c12; }
        .mobile-filter-title.types { color: #2196F3; }
        
        .mobile-filter-toggle {
            font-size: 0.8em;
            color: #666;
            transition: transform 0.3s ease;
        }
        
        .mobile-filter-toggle.collapsed::after {
            content: '‚ñ∂ Cliquer pour afficher';
            font-size: 0.7em;
            margin-left: 5px;
        }
        
        .mobile-filter-toggle.expanded::after {
            content: '‚ñº R√©duire';
            font-size: 0.7em;
            margin-left: 5px;
        }
        
        .mobile-filter-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .mobile-filter-content.open {
            max-height: 200px;
            overflow-y: auto;
        }

        .options-bubble {
            position: absolute;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            min-width: 250px;
            display: none;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid #ddd;
        }
        
        .option-item {
            padding: 12px 15px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .option-item:hover {
            background-color: #f8f9fa;
        }
        
        .option-item:last-child {
            border-bottom: none;
        }
        
        .option-icon {
            font-size: 1.2em;
            width: 24px;
            text-align: center;
        }
        
        .option-label {
            flex-grow: 1;
            font-size: 14px;
        }
        
        .date-bubble {
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .person-bubble {
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
        }

        .calendar-day.has-data::before {
            content: '‚è∫Ô∏è';
            position: absolute;
            top: 3px;
            right: 3px;
            font-size: 8px;
            color: #3498db;
        }

        .mobile-stats {
            display: none;
        }

        .tableau-export-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .tableau-export-button {
            background: linear-gradient(135deg, #ff6b35, #e74c3c);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            min-width: 180px;
        }
        
        .tableau-export-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .tableau-export-button.pdf {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .tableau-export-button.excel {
            background: linear-gradient(135deg, #27ae60, #219a53);
        }
        
        .tableau-container {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            margin-top: 20px;
        }
        
        .tableau-header {
            background-color: var(--secondary-color);
            color: white;
            padding: 15px 20px;
        }
        
        .tableau-content {
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .tableau-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            table-layout: fixed;
        }
        
        .tableau-table th {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 12px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
            white-space: normal;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .tableau-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #e9ecef;
            vertical-align: top;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .tableau-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .tableau-table tr:hover {
            background-color: #f0f0f0;
        }
        
        .clickable-hote {
            cursor: pointer;
            color: #27ae60;
            font-weight: bold;
            text-decoration: underline;
            transition: all 0.3s ease;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .clickable-hote:hover {
            background-color: #e8f5e8;
            color: #219653;
        }
        
        .clickable-pays {
            cursor: pointer;
            color: #27ae60;
            text-decoration: underline;
            transition: all 0.3s ease;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .clickable-pays:hover {
            background-color: #e8f5e8;
            color: #219653;
        }
        
        .clickable-lieu {
            cursor: pointer;
            color: #9b59b6;
            text-decoration: underline;
            transition: all 0.3s ease;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .clickable-lieu:hover {
            background-color: #f5e8f8;
            color: #8e44ad;
        }
        
        .clickable-date {
            cursor: pointer;
            color: #3498db;
            text-decoration: underline;
            transition: all 0.3s ease;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .clickable-date:hover {
            background-color: #e8f4fd;
            color: #2980b9;
        }
        
        .hote-cell {
            font-weight: 600;
            min-width: 100px;
            max-width: 150px;
            overflow-wrap: break-word;
            word-wrap: break-word;
            white-space: normal !important;
            line-height: 1.3;
            word-break: break-word;
        }
        
        .pays-cell {
            min-width: 80px;
            max-width: 100px;
        }
        
        .lieu-cell {
            min-width: 80px;
            max-width: 100px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .duration-cell {
            min-width: 60px;
            text-align: center;
            font-weight: bold;
        }
        
        .heberge-list-cell {
            max-width: 200px;
        }
        
        .heberge-item {
            display: inline-block;
            background: #ffc107;
            color: #856404;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            margin: 2px;
            white-space: nowrap;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
            text-decoration: underline;
            transition: all 0.3s ease;
        }
        
        .heberge-item:hover {
            background: #e0a800;
            color: #856404;
            transform: translateY(-2px);
        }

        /* Styles pour les options d'export dans la bulle qui n√©cessitent un mot de passe */
        .option-item.requires-password {
            opacity: 0.5;
            cursor: not-allowed;
            position: relative;
        }
        
        .option-item.requires-password:hover::after {
            content: 'üîí Mot de passe requis';
            position: absolute;
            top: -30px;
            left: 0;
            background: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1001;
        }
        
        .option-item.requires-password:hover {
            background-color: inherit;
        }
        
        /* Masquer les boutons d'export dans le tableau par personne */
        .person-tableau-export-buttons {
            display: none !important;
        }
        
        .person-tableau-export-button {
            display: none !important;
        }

        /* Styles pour la barre de recherche globale - MODIFI√â */
        .global-search-container {
            position: relative;
            width: 100%;
            margin-bottom: 20px;
            grid-column: 1 / -1;
        }
        
        .global-search-input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            transition: all 0.3s ease;
            background-color: white;
            box-shadow: var(--box-shadow);
        }
        
        .global-search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(139, 0, 0, 0.1);
        }
        
        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #7f8c8d;
            font-size: 20px;
        }
        
        .global-search-button {
            width: 100%;
            margin-top: 10px;
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--primary-color), #6a0000);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .global-search-button:hover {
            background: linear-gradient(135deg, #6a0000, var(--primary-color));
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .suggestions-container {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            border: 1px solid #ddd;
        }
        
        .suggestion-item {
            padding: 12px 15px;
            cursor: pointer;
            transition: background-color 0.2s;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .suggestion-item:hover {
            background-color: #f8f9fa;
        }
        
        .suggestion-item:last-child {
            border-bottom: none;
        }
        
        .suggestion-text {
            flex: 1;
            font-size: 14px;
        }
        
        .suggestion-context {
            font-size: 12px;
            color: #7f8c8d;
            text-align: right;
            margin-left: 15px;
            white-space: nowrap;
        }
        
        .suggestion-context span {
            display: inline-block;
            margin-left: 8px;
            padding: 2px 6px;
            background: #ecf0f1;
            border-radius: 3px;
        }
        
        .no-suggestions {
            padding: 15px;
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
        }
        
        .search-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1002;
            justify-content: center;
            align-items: center;
        }
        
        .search-modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .search-results-summary {
            padding: 15px;
            background: #ecf0f1;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        /* Styles pour les r√©sultats surlign√©s - AM√âLIOR√â */
        .highlight {
            background-color: #FFD700 !important;
            color: #333 !important;
            padding: 1px 3px;
            border-radius: 3px;
            font-weight: bold;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
            border: 1px solid #FFA500;
        }
        
        .highlighted-field {
            background-color: #e8f4fd;
            padding: 8px;
            border-radius: 4px;
            margin: 5px 0;
            border-left: 3px solid #3498db;
        }
        
        .highlighted-field-label {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 0.9em;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .highlighted-field-content {
            color: var(--text-color);
            line-height: 1.5;
        }

@media (max-width: 1024px) {
    .container {
        grid-template-columns: 35% 1fr;
    }
    
    .stats-grid {
        grid-template-columns: repeat(3, 1fr);
    }
    
    .fixed-nav-buttons {
        flex-direction: row;
        top: 100px;
        right: 10px;
    }
    
    .icon-button {
        width: 50px;
        height: 50px;
        font-size: 20px;
    }
    
    .photo-preview-container {
        width: 400px; /* 10cm x 10cm sur tablette aussi */
    }
    
    .photo-link-with-preview {
        width: 400px;
        height: 400px; /* 10cm x 10cm sur tablette aussi */
    }
    
    .photos-preview-grid {
        display: flex;
        flex-wrap: nowrap; /* IMPORTANT : emp√™che le retour √† la ligne */
        overflow-x: auto; /* Permet le d√©filement horizontal */
        justify-content: flex-start; /* Aligne √† gauche */
        gap: 15px;
        padding: 10px;
        -webkit-overflow-scrolling: touch; /* D√©filement fluide sur mobile */
    }
    
    .photo-preview-container {
        flex: 0 0 auto; /* Emp√™che le redimensionnement */
    }
}
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: 2;
                display: none;
            }
            
            .main-content {
                order: 1;
            }
            
            header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
                padding: 10px;
            }
            
            .header-left {
                align-items: center;
                text-align: center;
                width: 100%;
            }
            
            .decoration-images,
            .decoration-images-left {
                display: none;
            }
            
            .fixed-nav-buttons {
                position: fixed;
                bottom: 20px;
                top: auto;
                right: 20px;
                flex-direction: column;
            }
            
            .action-buttons-sidebar {
                display: none;
            }
            
            .action-buttons-mobile {
                display: grid;
                margin-top: 10px;
            }
            
            .mobile-stats {
                display: block;
                order: -1;
                margin-bottom: 15px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(5, 1fr);
                gap: 6px;
            }
            
            .stat-card {
                padding: 8px;
            }
            
            .stat-value {
                font-size: 1.1em;
            }
            
            .stat-label {
                font-size: 0.7em;
            }
            
            .mobile-filters {
                display: flex;
            }
            
            .filters-sidebar {
                display: none;
            }
            
            .filter-group {
                padding: 12px;
            }
            
            .filter-tags {
                max-height: 120px;
            }
            
            .tag {
                font-size: 11px;
                padding: 5px 10px;
            }
            
            .calendar-grid {
                gap: 2px;
            }
            
            .calendar-day {
                padding: 8px 4px;
                font-size: 0.9em;
                min-height: 50px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            header p {
                font-size: 0.9em;
            }
            
            .data-table th, .data-table td {
                display: block;
                width: 100%;
            }
            
            .data-table th {
                background: var(--secondary-color);
                color: white;
                margin-top: 10px;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .info-item {
                border-right: none;
                border-bottom: 1px solid #e9ecef;
                padding: 12px 15px;
                display: flex;
                flex-direction: column;
            }
            
            .hote-name {
                font-size: 1.8em;
            }
            
            .email-modal-content,
            .password-modal-content,
            .export-modal-content,
            .search-modal-content {
                padding: 20px;
                width: 95%;
            }
            
            .photos-preview {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
            
            .photo-preview img {
                height: 80px;
            }
            
            .export-format-options {
                flex-direction: column;
            }
            
            .options-bubble {
                min-width: 200px;
            }
            
            .option-item {
                padding: 10px;
                font-size: 0.9em;
            }
            
            .mobile-tag {
                background: var(--primary-color);
                color: white;
                padding: 6px 12px;
                border-radius: 20px;
                font-size: 11px;
                cursor: pointer;
                transition: all 0.3s ease;
                position: relative;
                display: inline-block;
                margin: 4px;
            }
            
            .mobile-tag.nom {
                background: #3498db;
            }
            
            .mobile-tag.pays {
                background: #27ae60;
            }
            
            .mobile-tag.lieu {
                background: #9b59b6;
            }
            
            .mobile-tag.heberge {
                background: #f39c12;
            }
            
            .mobile-tag.type {
                background: #2196F3;
            }
            
            .mobile-tag:hover {
                transform: translateY(-2px);
                box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            }
            
            .mobile-tags-container {
                display: flex;
                flex-wrap: wrap;
                gap: 5px;
                padding: 5px 0;
            }
            
            .tableau-export-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .tableau-export-button {
                min-width: 90%;
                padding: 10px 15px;
                margin: 5px 0;
            }
            
            .tableau-table {
                display: table;
                width: 100%;
                overflow-x: auto;
                font-size: 13px;
            }
            
            .tableau-table th,
            .tableau-table td {
                min-width: auto;
                max-width: none;
                padding: 8px 10px;
                font-size: 13px;
            }
            
            .tableau-table th {
                font-size: 14px;
                padding: 10px 12px;
                white-space: nowrap;
            }
            
            .tableau-table th:nth-child(1),
            .tableau-table td:nth-child(1) {
                width: 22%;
                max-width: 130px;
                min-width: 90px;
                font-size: 13px;
                white-space: normal;
                word-wrap: break-word;
                word-break: break-word;
            }
            
            .tableau-table th:nth-child(2),
            .tableau-table td:nth-child(2) {
                width: 15%;
                max-width: 80px;
                min-width: 70px;
                font-size: 13px;
            }
            
            .tableau-table th:nth-child(3),
            .tableau-table td:nth-child(3) {
                width: 15%;
                max-width: 90px;
                min-width: 80px;
                font-size: 13px;
            }
            
            .tableau-table th:nth-child(4),
            .tableau-table td:nth-child(4) {
                width: 28%;
                max-width: 140px;
                min-width: 110px;
                font-size: 12px;
                white-space: normal;
                line-height: 1.3;
            }
            
            .tableau-table th:nth-child(5),
            .tableau-table td:nth-child(5) {
                width: 10%;
                max-width: 70px;
                min-width: 60px;
                font-size: 13px;
                text-align: center;
            }
            
            .tableau-table th:nth-child(6),
            .tableau-table td:nth-child(6) {
                width: 10%;
                max-width: 130px;
                min-width: 100px;
                font-size: 12px;
            }
            
            .tableau-personne-table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 10px;
                table-layout: fixed;
            }
            
            .tableau-personne-table th {
                background-color: var(--primary-color);
                color: white;
                padding: 10px 12px;
                text-align: left;
                font-weight: 600;
                position: sticky;
                top: 0;
                z-index: 10;
                white-space: normal;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            .tableau-personne-table td {
                padding: 10px 12px;
                border-bottom: 1px solid #e9ecef;
                vertical-align: top;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }
            
            .tableau-personne-table th:nth-child(1),
            .tableau-personne-table td:nth-child(1) {
                width: 20%;
                max-width: 120px;
                min-width: 80px;
                font-size: 13px;
            }
            
            .tableau-personne-table th:nth-child(2),
            .tableau-personne-table td:nth-child(2) {
                width: 15%;
                max-width: 80px;
                min-width: 70px;
                font-size: 13px;
            }
            
            .tableau-personne-table th:nth-child(3),
            .tableau-personne-table td:nth-child(3) {
                width: 15%;
                max-width: 90px;
                min-width: 80px;
                font-size: 13px;
            }
            
            .tableau-personne-table th:nth-child(4),
            .tableau-personne-table td:nth-child(4) {
                width: 35%;
                max-width: 160px;
                min-width: 130px;
                font-size: 12px;
                white-space: normal;
                line-height: 1.3;
            }
            
            .tableau-personne-table th:nth-child(5),
            .tableau-personne-table td:nth-child(5) {
                width: 15%;
                max-width: 80px;
                min-width: 70px;
                font-size: 13px;
                text-align: center;
            }
            
            .heberge-list-cell {
                max-width: 150px;
            }
            
            .heberge-item {
                font-size: 10px;
                padding: 3px 6px;
                margin: 2px;
                max-width: 100%;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                display: inline-block;
            }
            
            .hote-cell {
                font-size: 12px;
                max-width: 150px;
                overflow-wrap: break-word;
                word-wrap: break-word;
                white-space: normal;
                line-height: 1.3;
                word-break: break-word;
            }
            
            .clickable-date {
                font-size: 12px;
                white-space: normal;
                line-height: 1.3;
            }
            
            .duration-cell {
                font-size: 12px;
                text-align: center;
            }
            
            .heberge-list-cell > div {
                max-height: 80px;
                overflow-y: auto;
                padding-right: 5px;
            }
            
            .suggestion-item {
                padding: 10px;
                flex-direction: column;
                align-items: flex-start;
            }
            
            .suggestion-context {
                margin-left: 0;
                margin-top: 5px;
                text-align: left;
                width: 100%;
            }

            /* Ajustements pour les aper√ßus photos sur mobile */
.photo-preview-container {
        width: 400px; /* 10cm x 10cm sur mobile aussi */
        margin: 8px;
    }
    
    .photo-link-with-preview {
        width: 400px;
        height: 400px; /* 10cm x 10cm sur mobile aussi */
    }
    
    .photos-preview-grid {
        display: flex;
        flex-wrap: nowrap; /* IMPORTANT : photos sur une ligne */
        overflow-x: auto; /* D√©filement horizontal */
        justify-content: flex-start;
        gap: 10px;
        padding: 10px;
        -webkit-overflow-scrolling: touch;
    }
    
    .photo-preview-container {
        flex: 0 0 auto; /* Emp√™che le redimensionnement */
    }            
            /* Ajustements pour les titres de fiche sur mobile */
            .fiche-pays {
                position: relative;
                top: auto;
                right: auto;
                display: inline-block;
                margin-top: 5px;
                font-size: 0.8em;
            }
            
            .localisation-content {
                font-size: 1.1em;
            }
            
            @media (max-width: 480px) {
                .stats-grid {
                    grid-template-columns: repeat(3, 1fr);
                }
                
                .tableau-table {
                    font-size: 12px;
                }
                
                .tableau-table th,
                .tableau-table td {
                    padding: 7px 8px;
                }
                
                .tableau-table th {
                    font-size: 12px;
                }
                
                .tableau-table th:nth-child(1),
                .tableau-table td:nth-child(1) {
                    width: 25%;
                    font-size: 12px;
                }
                
                .tableau-table th:nth-child(2),
                .tableau-table td:nth-child(2) {
                    width: 12%;
                    font-size: 11px;
                }
                
                .tableau-table th:nth-child(3),
                .tableau-table td:nth-child(3) {
                    width: 15%;
                    font-size: 11px;
                }
                
                .tableau-table th:nth-child(4),
                .tableau-table td:nth-child(4) {
                    width: 20%;
                    font-size: 11px;
                }
                
                .tableau-table th:nth-child(5),
                .tableau-table td:nth-child(5) {
                    width: 10%;
                    font-size: 11px;
                }
                
                .tableau-table th:nth-child(6),
                .tableau-table td:nth-child(6) {
                    width: 18%;
                    font-size: 11px;
                }
                
                .tableau-personne-table th:nth-child(1),
                .tableau-personne-table td:nth-child(1) {
                    width: 22%;
                    font-size: 12px;
                }
                
                .tableau-personne-table th:nth-child(2),
                .tableau-personne-table td:nth-child(2) {
                    width: 13%;
                    font-size: 11px;
                }
                
                .tableau-personne-table th:nth-child(3),
                .tableau-personne-table td:nth-child(3) {
                    width: 15%;
                    font-size: 11px;
                }
                
                .tableau-personne-table th:nth-child(4),
                .tableau-personne-table td:nth-child(4) {
                    width: 35%;
                    font-size: 11px;
                }
                
                .tableau-personne-table th:nth-child(5),
                .tableau-personne-table td:nth-child(5) {
                    width: 15%;
                    font-size: 11px;
                }
                
                .heberge-item {
                    font-size: 9px;
                    padding: 2px 4px;
                }
                
                 .photo-preview-container {
        width: 320px; /* L√©g√®rement r√©duit pour tr√®s petit √©cran, mais garde une bonne taille */
    }
    
    .photo-link-with-preview {
        width: 320px;
        height: 320px;
    }
    
    .photos-preview-grid {
        display: flex;
        flex-wrap: nowrap; /* Photos sur une ligne */
        overflow-x: auto;
        justify-content: flex-start;
        gap: 10px;
        padding: 10px;
        -webkit-overflow-scrolling: touch;
    }
    
    .photo-preview-container {
        flex: 0 0 auto;
    }
        }

        /* Styles sp√©cifiques pour les aper√ßus photos sur ordinateur */
        @media (min-width: 769px) {
            .photos-preview-grid {
    display: flex;
    flex-wrap: wrap;
    justify-content: center; /* Centrer sur tous les √©crans */
    align-items: flex-start;
    gap: 15px;
}

.photo-preview-container {
    flex: 0 0 auto;
}

/* Ajustement pour que les photos ne soient pas trop grandes sur tr√®s petits √©crans */
@media (max-width: 380px) {
    .photo-preview-container {
        width: 250px; /* L√©g√®rement r√©duit pour tr√®s petits √©crans */
    }
    
    .photo-link-with-preview {
        width: 250px;
        height: 250px;
    }
    
    .photos-preview-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    }
}
        }
    </style>
</head>
<body>
    <div class="fixed-nav-buttons">
        <button class="icon-button home" id="homeButton" title="Accueil">
            üè†
        </button>
        <button class="icon-button list" id="showAllDataButton" title="Toutes les donn√©es">
            üìã
        </button>
        <button class="icon-button calendar-btn" id="scrollToCalendarButton" title="Aller au calendrier">
            üìÖ
        </button>
        <button class="icon-button search-btn" id="openSearchModalButton" title="Rechercher dans toutes les donn√©es">
            üîç
        </button>
        <button class="icon-button email-btn disabled" id="sendEmailsButton" title="Envoyer un email de remerciements (verrouill√©)">
            üìß
        </button>
        <button class="icon-button export locked" id="exportDataButton" title="Exporter les donn√©es (verrouill√©)">
            üì§
        </button>
    </div>

    <div class="container">
        <header>
            <div class="decoration-images-left">
                <span>üèòÔ∏è</span>
                <span>üè†</span>
                <span>üè®</span>
            </div>
            <div class="decoration-images">
                <span>üõå</span>
                <span>üè°</span>
                <span>üö™</span>
            </div>
            <div class="header-overlay">
                <div class="header-left">
                    <h1>H√©bergements Tourn√©e 2026</h1>
                    <p>Consultation des h√©bergements par date et par h√¥te</p>
                </div>
            </div>
        </header>
        
        <!-- Barre de recherche globale -->
        <div class="global-search-container">
            <input type="text" id="globalSearchInput" class="global-search-input" placeholder="üîç Rechercher dans toutes les donn√©es (nom, lieu, pays, type, personnes, etc.)">
            <div class="search-icon">üîç</div>
            <div class="suggestions-container" id="suggestionsContainer"></div>
            <button class="global-search-button" id="globalSearchButton">
                üîç Rechercher dans toutes les donn√©es
            </button>
        </div>
        
        <div class="sidebar">
            <div class="stats-section">
                <h3 style="margin-bottom: 15px; color: var(--secondary-color); text-align: center;">üìä Statistiques</h3>
                <div class="stats-grid">
                    <div class="stat-card" onclick="showAllData()">
                        <div class="stat-value" id="totalHebergements">0</div>
                        <div class="stat-label">H√©bergements total</div>
                    </div>
                    <div class="stat-card" onclick="showAllData()">
                        <div class="stat-value" id="totalHotes">0</div>
                        <div class="stat-label">H√¥tes diff√©rents</div>
                    </div>
                    <div class="stat-card" onclick="showAllData()">
                        <div class="stat-value" id="totalPays">0</div>
                        <div class="stat-label">Pays diff√©rents</div>
                    </div>
                    <div class="stat-card" onclick="showAllData()">
                        <div class="stat-value" id="totalLieux">0</div>
                        <div class="stat-label">Lieux diff√©rents</div>
                    </div>
                    <div class="stat-card" onclick="showAllData()">
                        <div class="stat-value" id="totalHeberges">0</div>
                        <div class="stat-label">Personnes h√©berg√©es</div>
                    </div>
                    <div class="stat-card" onclick="filterByType('Famille')">
                        <div class="stat-value" id="totalFamille">0</div>
                        <div class="stat-label">H√©bergements en Famille</div>
                    </div>
                    <div class="stat-card" onclick="filterByType('H√¥tel')">
                        <div class="stat-value" id="totalHotel">0</div>
                        <div class="stat-label">H√©bergements en H√¥tel</div>
                    </div>
                    <div class="stat-card" onclick="filterByType('Centre')">
                        <div class="stat-value" id="totalCentre">0</div>
                        <div class="stat-label">H√©bergements en Centre</div>
                    </div>
                    <div class="stat-card" onclick="filterByType('Autre')">
                        <div class="stat-value" id="totalAutre">0</div>
                        <div class="stat-label">Autres h√©bergements</div>
                    </div>
                    <!-- Les statistiques pour les types suppl√©mentaires seront ajout√©es dynamiquement -->
                    <div id="additionalTypeStats"></div>
                </div>
            </div>
            
            <div class="action-buttons-sidebar">
                <button id="showAllButton" class="action-button">
                    üìã Afficher tous les h√©bergements
                </button>
                
                <button id="showTableauButton" class="action-button" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">
                    üìä Liste de r√©partition par h√©bergeur
                </button>
                
                <button id="showPrieresButton" class="action-button priere">
                    üôè Afficher les sujets de pri√®re
                </button>
            </div>
            
            <div class="filters-sidebar">
                <div class="filter-group">
                    <h3 class="toggle-title" data-filter="hotes">
                        <span style="color: #3498db;">üë§ H√¥tes</span>
                        <span class="toggle-indicator">‚ñ∂ Cliquer pour afficher</span>
                    </h3>
                    <div class="filter-tags" id="hotesTags" style="display: none;">
                    </div>
                </div>
                
                <div class="filter-group">
                    <h3 class="toggle-title" data-filter="pays">
                        <span style="color: #27ae60;">üåç Pays</span>
                        <span class="toggle-indicator">‚ñ∂ Cliquer pour afficher</span>
                    </h3>
                    <div class="filter-tags" id="paysTags" style="display: none;">
                    </div>
                </div>
                
                <div class="filter-group">
                    <h3 class="toggle-title" data-filter="lieux">
                        <span style="color: #9b59b6;">üìç Lieux</span>
                        <span class="toggle-indicator">‚ñ∂ Cliquer pour afficher</span>
                    </h3>
                    <div class="filter-tags" id="lieuxTags" style="display: none;">
                    </div>
                </div>
                
                <div class="filter-group">
                    <h3 class="toggle-title" data-filter="heberges">
                        <span style="color: #f39c12;">üë• Personnes h√©berg√©es</span>
                        <span class="toggle-indicator">‚ñ∂ Cliquer pour afficher</span>
                    </h3>
                    <div class="filter-tags" id="hebergesTags" style="display: none;">
                    </div>
                </div>
                
                <div class="filter-group">
                    <h3 class="toggle-title" data-filter="types">
                        <span style="color: #2196F3;">üè† Types d'h√©bergement</span>
                        <span class="toggle-indicator">‚ñ∂ Cliquer pour afficher</span>
                    </h3>
                    <div class="filter-tags" id="typesTags" style="display: none;">
                    </div>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="stats-section mobile-stats">
                <h3 style="margin-bottom: 15px; color: var(--secondary-color); text-align: center;">üìä Statistiques</h3>
                <div class="stats-grid">
                    <div class="stat-card" onclick="showAllData()">
                        <div class="stat-value" id="totalHebergementsMobile">0</div>
                        <div class="stat-label">H√©bergements total</div>
                    </div>
                    <div class="stat-card" onclick="showAllData()">
                        <div class="stat-value" id="totalHotesMobile">0</div>
                        <div class="stat-label">H√¥tes diff√©rents</div>
                    </div>
                    <div class="stat-card" onclick="showAllData()">
                        <div class="stat-value" id="totalPaysMobile">0</div>
                        <div class="stat-label">Pays diff√©rents</div>
                    </div>
                    <div class="stat-card" onclick="showAllData()">
                        <div class="stat-value" id="totalLieuxMobile">0</div>
                        <div class="stat-label">Lieux diff√©rents</div>
                    </div>
                    <div class="stat-card" onclick="showAllData()">
                        <div class="stat-value" id="totalHebergesMobile">0</div>
                        <div class="stat-label">Personnes h√©berg√©es</div>
                    </div>
                    <div class="stat-card" onclick="filterByType('Famille')">
                        <div class="stat-value" id="totalFamilleMobile">0</div>
                        <div class="stat-label">Famille</div>
                    </div>
                    <div class="stat-card" onclick="filterByType('H√¥tel')">
                        <div class="stat-value" id="totalHotelMobile">0</div>
                        <div class="stat-label">H√¥tel</div>
                    </div>
                    <div class="stat-card" onclick="filterByType('Centre')">
                        <div class="stat-value" id="totalCentreMobile">0</div>
                        <div class="stat-label">Centre</div>
                    </div>
                    <div class="stat-card" onclick="filterByType('Autre')">
                        <div class="stat-value" id="totalAutreMobile">0</div>
                        <div class="stat-label">Autres</div>
                    </div>
                    <!-- Les statistiques mobiles pour les types suppl√©mentaires seront ajout√©es dynamiquement -->
                    <div id="additionalTypeStatsMobile"></div>
                </div>
            </div>
            
            <div class="action-buttons-mobile">
                <button id="showAllButtonMobile" class="action-button-mobile">
                    üìã Tous
                </button>
                
                <button id="showTableauButtonMobile" class="action-button-mobile tableau">
                    üìä R√©partition
                </button>
                
                <button id="showPrieresButtonMobile" class="action-button-mobile priere">
                    üôè Pri√®res
                </button>
            </div>
            
            <div class="mobile-filters">
                <div class="mobile-filter-group">
                    <div class="mobile-filter-header" data-filter="hotes">
                        <div class="mobile-filter-title hotes">
                            <span>üë§</span>
                            <span>H√¥tes</span>
                        </div>
                        <div class="mobile-filter-toggle collapsed"></div>
                    </div>
                    <div class="mobile-filter-content" id="mobileHotesContent">
                        <div class="mobile-tags-container" id="mobileHotesTags">
                        </div>
                    </div>
                </div>
                
                <div class="mobile-filter-group">
                    <div class="mobile-filter-header" data-filter="pays">
                        <div class="mobile-filter-title pays">
                            <span>üåç</span>
                            <span>Pays</span>
                        </div>
                        <div class="mobile-filter-toggle collapsed"></div>
                    </div>
                    <div class="mobile-filter-content" id="mobilePaysContent">
                        <div class="mobile-tags-container" id="mobilePaysTags">
                        </div>
                    </div>
                </div>
                
                <div class="mobile-filter-group">
                    <div class="mobile-filter-header" data-filter="lieux">
                        <div class="mobile-filter-title lieux">
                            <span>üìç</span>
                            <span>Lieux</span>
                        </div>
                        <div class="mobile-filter-toggle collapsed"></div>
                    </div>
                    <div class="mobile-filter-content" id="mobileLieuxContent">
                        <div class="mobile-tags-container" id="mobileLieuxTags">
                        </div>
                    </div>
                </div>
                
                <div class="mobile-filter-group">
                    <div class="mobile-filter-header" data-filter="heberges">
                        <div class="mobile-filter-title heberges">
                            <span>üë•</span>
                            <span>Personnes h√©berg√©es</span>
                        </div>
                        <div class="mobile-filter-toggle collapsed"></div>
                    </div>
                    <div class="mobile-filter-content" id="mobileHebergesContent">
                        <div class="mobile-tags-container" id="mobileHebergesTags">
                        </div>
                    </div>
                </div>
                
                <div class="mobile-filter-group">
                    <div class="mobile-filter-header" data-filter="types">
                        <div class="mobile-filter-title types">
                            <span>üè†</span>
                            <span>Types d'h√©bergement</span>
                        </div>
                        <div class="mobile-filter-toggle collapsed"></div>
                    </div>
                    <div class="mobile-filter-content" id="mobileTypesContent">
                        <div class="mobile-tags-container" id="mobileTypesTags">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="calendar-section">
                <div class="calendar-header">
                    <h3>üìÖ Calendrier des h√©bergements</h3>
                    <div class="calendar-nav">
                        <button id="prevMonth">‚óÄ</button>
                        <span id="currentMonth">Mois en cours</span>
                        <button id="nextMonth">‚ñ∂</button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                </div>
            </div>
            
            <div class="loading" id="loadingIndicator">
                <div class="spinner"></div>
                <p>Chargement des donn√©es depuis Google Sheets...</p>
            </div>

            <div id="dataInfo" class="data-info"></div>
            
            <section class="results-section" id="resultsSection" style="display: none;">
                <div class="result-header">
                    <h2 id="resultTitle">R√©sultats de la recherche</h2>
                    <button id="closeResults" style="background: none; border: none; color: white; font-size: 1.2em; cursor: pointer;">‚úï Fermer</button>
                </div>
                <div class="result-content" id="resultContent">
                </div>
            </section>
            
            <div class="tableau-container" id="tableauSection" style="display: none;">
                <div class="tableau-header">
                    <h2 id="tableauTitle">üìä Liste de r√©partition par h√©bergeur</h2>
                </div>
                <div class="tableau-content">
                    <div id="tableauContent">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de recherche -->
    <div id="searchModal" class="search-modal">
        <div class="search-modal-content">
            <h3 style="margin-bottom: 20px; color: var(--secondary-color);">üîç Recherche globale</h3>
            
            <div class="search-bar-container" style="margin-bottom: 20px;">
                <input type="text" id="modalSearchInput" class="global-search-input" placeholder="Rechercher dans toutes les donn√©es...">
                <div class="search-icon">üîç</div>
                <div class="suggestions-container" id="modalSuggestionsContainer"></div>
            </div>
            
            <div id="searchResultsSummary" class="search-results-summary" style="display: none;">
                <strong id="searchResultsCount">0</strong> r√©sultat(s) trouv√©(s)
            </div>
            
            <div id="modalSearchResults" style="max-height: 400px; overflow-y: auto;">
                <!-- Les r√©sultats de recherche seront affich√©s ici -->
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button id="closeSearchModal" style="padding: 10px 20px; background: #95a5a6; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Fermer
                </button>
            </div>
        </div>
    </div>

    <!-- Popup pour les aper√ßus photos -->
    <div id="photoLinkPopup" class="photo-link-popup">
        <div class="photo-link-popup-content">
            <button class="photo-link-popup-close" onclick="closePhotoPopup()">‚úï</button>
            <img id="popupPhoto" src="" alt="Aper√ßu photo">
        </div>
    </div>

    <div id="personOptionsBubble" class="options-bubble person-bubble">
        <div class="option-item" id="showPersonFiches">
            <span class="option-icon">üìÑ</span>
            <span class="option-label">Voir toutes les fiches</span>
        </div>
        <div class="option-item" id="showPersonHotes">
            <span class="option-icon">üìä</span>
            <span class="option-label">Tableau de liste de ses h√©bergeurs</span>
        </div>
        <div class="option-item requires-password" id="exportPersonPDF">
            <span class="option-icon">üìÑ</span>
            <span class="option-label">Exporter en PDF (admin)</span>
        </div>
        <div class="option-item requires-password" id="exportPersonExcel">
            <span class="option-icon">üìä</span>
            <span class="option-label">Exporter en Excel (admin)</span>
        </div>
    </div>

    <div id="exportModal" class="export-modal">
        <div class="export-modal-content">
            <h3 style="margin-bottom: 20px; color: var(--secondary-color);">üì§ Exporter les donn√©es</h3>
            
            <div class="export-options">
                <div class="export-type" id="exportType1">
                    <div class="export-type-title">
                        <span>üìã</span>
                        <span>Liste avec coordonn√©es des h√©bergeurs</span>
                    </div>
                    <div class="export-type-description">
                        Exporte tous les h√©bergeurs avec leurs informations compl√®tes
                    </div>
                </div>
                
                <div class="export-type" id="exportType2">
                    <div class="export-type-title">
                        <span>üåç</span>
                        <span>Liste par pays des h√©bergeurs</span>
                    </div>
                    <div class="export-type-description">
                        Exporte les h√©bergeurs organis√©s par pays avec leurs informations
                    </div>
                </div>
                
                <div class="export-type" id="exportType3">
                    <div class="export-type-title">
                        <span>üìÑ</span>
                        <span>Fiches d√©taill√©es par h√©bergement</span>
                    </div>
                    <div class="export-type-description">
                        Exporte toutes les fiches d√©taill√©es de chaque h√©bergement (PDF)
                    </div>
                </div>
                
                <div class="export-type" id="exportType4">
                    <div class="export-type-title">
                        <span>üìä</span>
                        <span>Liste de r√©partition par h√©bergeur</span>
                    </div>
                    <div class="export-type-description">
                        Exporte la liste compl√®te des h√©bergeurs avec h√¥te, pays, lieu, dates, dur√©e
                    </div>
                </div>
            </div>
            
            <div class="export-format-options" id="formatOptions" style="display: none;">
                <div class="format-option" data-format="csv">CSV</div>
                <div class="format-option" data-format="excel">Excel</div>
                <div class="format-option" data-format="pdf">PDF</div>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button id="cancelExport" style="padding: 10px 20px; background: #95a5a6; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Annuler
                </button>
                <button id="confirmExport" style="padding: 10px 20px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer; display: none;">
                    üì§ Exporter
                </button>
            </div>
        </div>
    </div>

    <div id="passwordModal" class="password-modal">
        <div class="password-modal-content">
            <h3 style="margin-bottom: 20px; color: var(--secondary-color);">üîê Acc√®s administrateur requis</h3>
            
            <p style="margin-bottom: 15px;">Veuillez entrer le mot de passe pour acc√©der aux fonctions admin :</p>
            
            <input type="password" id="adminPassword" class="password-input" placeholder="Mot de passe" autocomplete="off">
            
            <div id="passwordError" style="color: #e74c3c; margin-bottom: 15px; display: none;">
                ‚ùå Mot de passe incorrect
            </div>
            
            <div class="password-buttons">
                <button id="cancelPassword" style="padding: 10px 20px; background: #95a5a6; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Annuler
                </button>
                <button id="submitPassword" style="padding: 10px 20px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Valider
                </button>
            </div>
        </div>
    </div>

    <div id="emailModal" class="email-modal">
        <div class="email-modal-content">
            <h3 style="margin-bottom: 20px; color: var(--secondary-color);">üìß Envoi d'email de remerciements</h3>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: bold;">Destinataires avec email:</label>
                <div id="emailRecipients" class="email-recipients">
                </div>
                <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
                    <span id="recipientCount">0</span> destinataire(s) s√©lectionn√©(s)
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: bold;">Sujet:</label>
                <input type="text" id="emailSubject" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" 
                       value="Remerciements pour votre hospitalit√© - Tourn√©e 2026">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: bold;">Message:</label>
                <textarea id="emailMessage" style="width: 100%; height: 200px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-family: inherit;">Cher/ch√®re [Nom],

Nous tenons √† vous remercier chaleureusement pour votre g√©n√©reux accueil et votre hospitalit√© durant notre tourn√©e 2026. Votre soutien a √©t√© pr√©cieux pour nous.

Nous gardons un excellent souvenir de notre s√©jour chez vous et esp√©rons avoir l'occasion de vous revoir bient√¥t.

Avec toute notre gratitude,

L'√©quipe de la Tourn√©e 2026</textarea>
            </div>

            <div class="upload-section">
                <h4 style="margin-bottom: 15px; color: #3498db;">üì∏ Ajouter des photos √† l'email</h4>
                
                <div class="upload-area">
                    <input type="file" id="photoUpload" multiple accept="image/*" style="display: none;">
                    <button type="button" id="uploadButton" class="upload-button">
                        üìÅ Choisir des photos
                    </button>
                    <div class="upload-instructions">
                        Formats accept√©s: JPG, PNG, GIF (max 5MB par photo)
                    </div>
                </div>
                
                <div id="photosPreview" class="photos-preview">
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; flex-wrap: wrap;">
                <button id="cancelEmail" style="padding: 10px 20px; background: #95a5a6; color: white; border: none; border-radius: 5px; cursor: pointer;">Annuler</button>
                <button id="copyEmails" style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">üìã Copier les adresses</button>
                <button id="sendEmails" style="padding: 10px 20px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer;">üìß Envoyer les emails</button>
            </div>
        </div>
    </div>

    <script>
        const GOOGLE_SHEETS_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSXIJyclDLf2asT-FMnmaeWMSPtQHxpAC1wiGJ_xzXbl2StziwiUw9ElW9XyK5yemQ-PHaWlRQbtdHb/pub?gid=1650312054&single=true&output=csv';
        const ADMIN_PASSWORD = "admin";
        
        let sheetData = [];
        let headers = [];
        let currentDate = new Date();
        let selectedDate = null;
        let allHotes = [];
        let allPays = [];
        let allLieux = [];
        let allHeberges = new Set();
        let allPrieres = [];
        let bookingPeriods = [];
        let uploadedPhotos = [];
        let isAdmin = false;
        let selectedExportType = null;
        let selectedExportFormat = null;
        let passwordModalAction = null;
        let currentSelectedPerson = null;
        let currentClickedPersonElement = null;
        let tableauData = [];
        let currentPersonTableauData = [];
        let searchData = [];
        let searchTimeout = null;
        let currentSearchTerm = '';
        let allTypes = new Map(); // Map pour stocker les types et leurs compteurs

        let colDateDebut = -1;
        let colDateFin = -1;
        let colNom = -1;
        let colPays = -1;
        let colLieu = -1;
        let colAdresse = -1;
        let colEmail = -1;
        let colFacebook = -1;
        let colTelephone = -1;
        let colMpihiraLehilahy = -1;
        let colMpitendry = -1;
        let colFeo1 = -1;
        let colFeo2 = -1;
        let colPriere = -1;
        let colMarquants = -1;
        let colPhotosHotes = -1;
        let colPhotosLieux = -1;
        let colFormulaire = -1;
        let colRepartition = -1;
        let colHebergeEn = -1;
        let colAdresseHebergeur = -1;
        let colLieuHebergeur = -1;
        let colPaysHebergeur = -1;
        let colNumeroHebergeur = -1;
        let colASavoirHote = -1;
        let colObservations = -1;

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('tableauSection').style.display = 'none';
            
            document.getElementById('homeButton').addEventListener('click', function() {
                window.scrollTo({ top: 0, behavior: 'smooth' });
                document.getElementById('resultsSection').style.display = 'none';
                document.getElementById('tableauSection').style.display = 'none';
                hidePersonBubble();
            });
            
            document.getElementById('scrollToCalendarButton').addEventListener('click', function() {
                document.querySelector('.calendar-section').scrollIntoView({ behavior: 'smooth' });
                hidePersonBubble();
            });
            
            document.getElementById('showAllDataButton').addEventListener('click', showAllData);
            
            document.getElementById('openSearchModalButton').addEventListener('click', function() {
                openSearchModal();
            });
            
            document.getElementById('sendEmailsButton').addEventListener('click', function() {
                if (this.classList.contains('disabled')) {
                    passwordModalAction = 'email';
                    showPasswordModal();
                } else {
                    showEmailModal();
                }
            });
            
            document.getElementById('exportDataButton').addEventListener('click', function() {
                if (this.classList.contains('locked')) {
                    passwordModalAction = 'export';
                    showPasswordModal();
                } else {
                    showExportModal();
                }
            });
            
            document.getElementById('searchButton')?.addEventListener('click', handleSearch);
            document.getElementById('dateInput')?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleSearch();
                }
            });
            
            document.getElementById('showAllButton').addEventListener('click', showAllData);
            document.getElementById('showTableauButton').addEventListener('click', showTableauHebergeurs);
            document.getElementById('showPrieresButton').addEventListener('click', showPrieres);
            
            document.getElementById('showAllButtonMobile').addEventListener('click', showAllData);
            document.getElementById('showTableauButtonMobile').addEventListener('click', showTableauHebergeurs);
            document.getElementById('showPrieresButtonMobile').addEventListener('click', showPrieres);
            
            document.getElementById('closeResults').addEventListener('click', closeResults);
            
            document.getElementById('prevMonth').addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
                hidePersonBubble();
            });
            
            document.getElementById('nextMonth').addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
                hidePersonBubble();
            });
            
            document.getElementById('cancelExport').addEventListener('click', function() {
                document.getElementById('exportModal').style.display = 'none';
                resetExportModal();
            });
            
            document.getElementById('confirmExport').addEventListener('click', exportData);
            
            document.getElementById('exportType1').addEventListener('click', function() {
                selectExportType(1);
            });
            
            document.getElementById('exportType2').addEventListener('click', function() {
                selectExportType(2);
            });
            
            document.getElementById('exportType3').addEventListener('click', function() {
                selectExportType(3);
            });
            
            document.getElementById('exportType4').addEventListener('click', function() {
                selectExportType(4);
            });
            
            document.querySelectorAll('.format-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.format-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    selectedExportFormat = this.getAttribute('data-format');
                    document.getElementById('confirmExport').style.display = 'block';
                });
            });
            
            document.getElementById('cancelPassword').addEventListener('click', function() {
                document.getElementById('passwordModal').style.display = 'none';
                document.getElementById('adminPassword').value = '';
                document.getElementById('passwordError').style.display = 'none';
                passwordModalAction = null;
            });
            
            document.getElementById('submitPassword').addEventListener('click', function() {
                const password = document.getElementById('adminPassword').value;
                if (password === ADMIN_PASSWORD) {
                    isAdmin = true;
                    document.getElementById('exportDataButton').classList.remove('locked');
                    document.getElementById('exportDataButton').title = "Exporter les donn√©es";
                    document.getElementById('sendEmailsButton').classList.remove('disabled');
                    document.getElementById('sendEmailsButton').title = "Envoyer un email de remerciements";
                    
                    document.getElementById('exportPersonPDF').classList.remove('requires-password');
                    document.getElementById('exportPersonPDF').classList.add('export-active');
                    document.getElementById('exportPersonExcel').classList.remove('requires-password');
                    document.getElementById('exportPersonExcel').classList.add('export-active');
                    
                    document.getElementById('passwordModal').style.display = 'none';
                    document.getElementById('adminPassword').value = '';
                    document.getElementById('passwordError').style.display = 'none';
                    
                    if (passwordModalAction === 'export') {
                        showExportModal();
                    } else if (passwordModalAction === 'email') {
                        showEmailModal();
                    }
                    
                    passwordModalAction = null;
                } else {
                    document.getElementById('passwordError').style.display = 'block';
                    document.getElementById('adminPassword').value = '';
                }
            });
            
            document.getElementById('adminPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('submitPassword').click();
                }
            });
            
            document.getElementById('cancelEmail').addEventListener('click', function() {
                document.getElementById('emailModal').style.display = 'none';
                clearUploadedPhotos();
            });
            
            document.getElementById('sendEmails').addEventListener('click', sendEmails);
            document.getElementById('copyEmails').addEventListener('click', copyEmailAddresses);
            
            document.getElementById('uploadButton').addEventListener('click', function() {
                document.getElementById('photoUpload').click();
            });
            
            document.getElementById('photoUpload').addEventListener('change', handlePhotoUpload);
            
            document.getElementById('showPersonFiches').addEventListener('click', function() {
                if (currentSelectedPerson) {
                    const results = filterByHeberge(currentSelectedPerson);
                    displayResults(results, `Fiches pour: ${currentSelectedPerson}`);
                    hidePersonBubble();
                }
            });
            
            document.getElementById('showPersonHotes').addEventListener('click', function() {
                if (currentSelectedPerson) {
                    showHotesTableForPerson(currentSelectedPerson);
                    hidePersonBubble();
                }
            });
            
            document.getElementById('exportPersonPDF').addEventListener('click', function() {
                if (this.classList.contains('requires-password')) {
                    passwordModalAction = 'export-person-pdf';
                    showPasswordModal();
                    return;
                }
                
                if (currentSelectedPerson && currentPersonTableauData.length > 0 && isAdmin) {
                    exportPersonTableau('pdf', currentSelectedPerson, currentPersonTableauData);
                    hidePersonBubble();
                }
            });
            
            document.getElementById('exportPersonExcel').addEventListener('click', function() {
                if (this.classList.contains('requires-password')) {
                    passwordModalAction = 'export-person-excel';
                    showPasswordModal();
                    return;
                }
                
                if (currentSelectedPerson && currentPersonTableauData.length > 0 && isAdmin) {
                    exportPersonTableau('excel', currentSelectedPerson, currentPersonTableauData);
                    hidePersonBubble();
                }
            });
            
            document.querySelectorAll('.mobile-filter-header').forEach(header => {
                header.addEventListener('click', function() {
                    const filterType = this.getAttribute('data-filter');
                    const content = document.getElementById(`mobile${filterType.charAt(0).toUpperCase() + filterType.slice(1)}Content`);
                    const toggle = this.querySelector('.mobile-filter-toggle');
                    
                    if (content.classList.contains('open')) {
                        content.classList.remove('open');
                        toggle.classList.remove('expanded');
                        toggle.classList.add('collapsed');
                    } else {
                        content.classList.add('open');
                        toggle.classList.remove('collapsed');
                        toggle.classList.add('expanded');
                    }
                });
            });
            
            document.querySelectorAll('.toggle-title').forEach(title => {
                title.addEventListener('click', function() {
                    const filterType = this.getAttribute('data-filter');
                    const container = document.getElementById(`${filterType}Tags`);
                    const indicator = this.querySelector('.toggle-indicator');
                    
                    if (container.style.display === 'none' || container.style.display === '') {
                        container.style.display = 'flex';
                        indicator.textContent = '‚ñº R√©duire';
                    } else {
                        container.style.display = 'none';
                        indicator.textContent = '‚ñ∂ Cliquer pour afficher';
                    }
                });
            });
            
            document.addEventListener('click', function(event) {
                const personBubble = document.getElementById('personOptionsBubble');
                const suggestionsContainer = document.getElementById('suggestionsContainer');
                const modalSuggestionsContainer = document.getElementById('modalSuggestionsContainer');
                const photoPopup = document.getElementById('photoLinkPopup');
                
                if (!event.target.closest('.heberge-tag') && !event.target.closest('#personOptionsBubble') && 
                    !event.target.closest('.tag.heberge') && !event.target.closest('#personOptionsBubble') &&
                    !event.target.closest('.mobile-tag.heberge')) {
                    if (personBubble.style.display === 'flex') {
                        hidePersonBubble();
                    }
                }
                
                if (!event.target.closest('.global-search-container')) {
                    suggestionsContainer.style.display = 'none';
                }
                
                if (!event.target.closest('#searchModal .search-bar-container')) {
                    modalSuggestionsContainer.style.display = 'none';
                }
                
                if (!event.target.closest('.photo-link-preview') && !event.target.closest('#photoLinkPopup')) {
                    if (photoPopup.style.display === 'flex') {
                        closePhotoPopup();
                    }
                }
            });
            
            const globalSearchInput = document.getElementById('globalSearchInput');
            const globalSearchButton = document.getElementById('globalSearchButton');
            const modalSearchInput = document.getElementById('modalSearchInput');
            const suggestionsContainer = document.getElementById('suggestionsContainer');
            const modalSuggestionsContainer = document.getElementById('modalSuggestionsContainer');
            
            globalSearchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                const searchTerm = this.value.trim();
                
                if (searchTerm.length < 2) {
                    suggestionsContainer.style.display = 'none';
                    return;
                }
                
                searchTimeout = setTimeout(() => {
                    showSuggestions(searchTerm, suggestionsContainer, false);
                }, 300);
            });
            
            globalSearchInput.addEventListener('focus', function() {
                const searchTerm = this.value.trim();
                if (searchTerm.length >= 2) {
                    showSuggestions(searchTerm, suggestionsContainer, false);
                }
            });
            
            globalSearchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    const searchTerm = this.value.trim();
                    if (searchTerm) {
                        performGlobalSearch(searchTerm, false);
                        suggestionsContainer.style.display = 'none';
                    }
                }
            });
            
            globalSearchButton.addEventListener('click', function() {
                const searchTerm = globalSearchInput.value.trim();
                if (searchTerm) {
                    performGlobalSearch(searchTerm, false);
                    suggestionsContainer.style.display = 'none';
                } else {
                    alert('Veuillez entrer un terme de recherche');
                }
            });
            
            modalSearchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                const searchTerm = this.value.trim();
                
                if (searchTerm.length < 2) {
                    modalSuggestionsContainer.style.display = 'none';
                    return;
                }
                
                searchTimeout = setTimeout(() => {
                    showSuggestions(searchTerm, modalSuggestionsContainer, true);
                }, 300);
            });
            
            modalSearchInput.addEventListener('focus', function() {
                const searchTerm = this.value.trim();
                if (searchTerm.length >= 2) {
                    showSuggestions(searchTerm, modalSuggestionsContainer, true);
                }
            });
            
            modalSearchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    const searchTerm = this.value.trim();
                    if (searchTerm) {
                        performGlobalSearch(searchTerm, true);
                        modalSuggestionsContainer.style.display = 'none';
                    }
                }
            });
            
            document.getElementById('openSearchModalButton').addEventListener('click', openSearchModal);
            document.getElementById('closeSearchModal').addEventListener('click', closeSearchModal);
            
            loadDataFromGoogleSheets();
        });

        function openPhotoPopup(photoUrl, photoTitle) {
            const popup = document.getElementById('photoLinkPopup');
            const popupImg = document.getElementById('popupPhoto');
            
            popupImg.src = photoUrl;
            popupImg.alt = photoTitle || 'Aper√ßu photo';
            popup.style.display = 'flex';
        }

        function closePhotoPopup() {
            document.getElementById('photoLinkPopup').style.display = 'none';
        }

        function openSearchModal() {
            document.getElementById('searchModal').style.display = 'flex';
            document.getElementById('modalSearchInput').focus();
            hidePersonBubble();
        }

        function closeSearchModal() {
            document.getElementById('searchModal').style.display = 'none';
            document.getElementById('modalSearchInput').value = '';
            document.getElementById('modalSearchResults').innerHTML = '';
            document.getElementById('searchResultsSummary').style.display = 'none';
        }

        function prepareSearchData() {
            searchData = [];
            
            sheetData.forEach((row, index) => {
                const nom = colNom !== -1 ? row[colNom] : '';
                const pays = colPays !== -1 ? row[colPays] : '';
                const lieu = colLieu !== -1 ? row[colLieu] : '';
                const type = colHebergeEn !== -1 ? row[colHebergeEn] : '';
                const dateDebut = colDateDebut !== -1 ? row[colDateDebut] : '';
                const dateFin = colDateFin !== -1 ? row[colDateFin] : '';
                const adresse = colAdresse !== -1 ? row[colAdresse] : '';
                const email = colEmail !== -1 ? row[colEmail] : '';
                const facebook = colFacebook !== -1 ? row[colFacebook] : '';
                const telephone = colTelephone !== -1 ? row[colTelephone] : '';
                const observations = colObservations !== -1 ? row[colObservations] : '';
                
                let personnes = [];
                const colonnesPersonnes = [colMpihiraLehilahy, colMpitendry, colFeo1, colFeo2];
                colonnesPersonnes.forEach(colIndex => {
                    if (colIndex !== -1) {
                        const personnesCell = row[colIndex] || '';
                        if (personnesCell.trim()) {
                            personnesCell.split(',').forEach(p => {
                                const trimmed = p.trim();
                                if (trimmed) personnes.push(trimmed);
                            });
                        }
                    }
                });
                
                const priere = colPriere !== -1 ? row[colPriere] : '';
                const marquants = colMarquants !== -1 ? row[colMarquants] : '';
                const aSavoir = colASavoirHote !== -1 ? row[colASavoirHote] : '';
                const repartition = colRepartition !== -1 ? row[colRepartition] : '';
                
                const searchText = `
                    ${nom}
                    ${pays}
                    ${lieu}
                    ${type}
                    ${dateDebut}
                    ${dateFin}
                    ${adresse}
                    ${email}
                    ${facebook}
                    ${telephone}
                    ${observations}
                    ${personnes.join(' ')}
                    ${priere}
                    ${marquants}
                    ${aSavoir}
                    ${repartition}
                `.toLowerCase();
                
                searchData.push({
                    rowIndex: index,
                    nom: nom,
                    pays: pays,
                    lieu: lieu,
                    type: type,
                    dateDebut: dateDebut,
                    dateFin: dateFin,
                    personnes: personnes,
                    observations: observations,
                    searchText: searchText,
                    row: row,
                    allData: {
                        nom: nom,
                        pays: pays,
                        lieu: lieu,
                        type: type,
                        dateDebut: dateDebut,
                        dateFin: dateFin,
                        adresse: adresse,
                        email: email,
                        facebook: facebook,
                        telephone: telephone,
                        observations: observations,
                        personnes: personnes,
                        priere: priere,
                        marquants: marquants,
                        aSavoir: aSavoir,
                        repartition: repartition
                    }
                });
            });
        }

        function generatePhotoThumbnail(url) {
            if (!url) return '';
            
            if (url.includes('drive.google.com')) {
                if (url.includes('/file/d/')) {
                    const fileId = url.split('/file/d/')[1].split('/')[0];
                    return `https://drive.google.com/thumbnail?sz=w400&id=${fileId}`;
                } else if (url.includes('id=')) {
                    const fileId = url.split('id=')[1].split('&')[0];
                    return `https://drive.google.com/thumbnail?sz=w400&id=${fileId}`;
                }
            }
            
            return url;
        }

        function showSuggestions(searchTerm, container, isModal) {
            if (!searchTerm || searchTerm.length < 2) {
                container.style.display = 'none';
                return;
            }
            
            const term = searchTerm.toLowerCase();
            const suggestions = [];
            
            const allWords = new Set();
            const wordContexts = new Map();
            
            searchData.forEach(item => {
                const words = item.searchText.split(/\s+/).filter(word => word.length >= 3);
                words.forEach(word => {
                    if (word.includes(term)) {
                        if (!wordContexts.has(word)) {
                            wordContexts.set(word, []);
                        }
                        wordContexts.get(word).push({
                            nom: item.nom,
                            pays: item.pays,
                            lieu: item.lieu,
                            dateDebut: item.dateDebut
                        });
                        allWords.add(word);
                    }
                });
            });
            
            const sortedWords = Array.from(allWords)
                .sort((a, b) => {
                    const aStartsWith = a.startsWith(term);
                    const bStartsWith = b.startsWith(term);
                    if (aStartsWith && !bStartsWith) return -1;
                    if (!aStartsWith && bStartsWith) return 1;
                    return a.localeCompare(b);
                })
                .slice(0, 20);
            
            sortedWords.forEach(word => {
                const contexts = wordContexts.get(word);
                const sampleContext = contexts && contexts.length > 0 ? contexts[0] : null;
                
                suggestions.push({
                    text: word,
                    type: 'mot',
                    context: sampleContext ? `${sampleContext.nom || ''} - ${sampleContext.pays || ''} - ${sampleContext.dateDebut || ''}` : '',
                    action: () => {
                        const results = searchData
                            .filter(item => item.searchText.includes(word))
                            .map(item => item.row);
                        
                        if (isModal) {
                            displaySearchResults(results, `Mot: "${word}"`);
                        } else {
                            displayResults(results, `Mot: "${word}"`);
                        }
                    }
                });
            });
            
            if (suggestions.length < 15) {
                allHotes.forEach(nom => {
                    const nomLower = nom.toLowerCase();
                    if (nomLower.includes(term)) {
                        suggestions.push({
                            text: nom,
                            type: 'h√¥te',
                            action: () => {
                                const results = filterDataByType(nom, 'nom');
                                if (isModal) {
                                    displaySearchResults(results, `H√¥te: ${nom}`);
                                } else {
                                    displayResults(results, `H√¥te: ${nom}`);
                                }
                            }
                        });
                    }
                });
                
                allPays.forEach(pays => {
                    const paysLower = pays.toLowerCase();
                    if (paysLower.includes(term)) {
                        suggestions.push({
                            text: pays,
                            type: 'pays',
                            action: () => {
                                const results = filterDataByType(pays, 'pays');
                                if (isModal) {
                                    displaySearchResults(results, `Pays: ${pays}`);
                                } else {
                                    displayResults(results, `Pays: ${pays}`);
                                }
                            }
                        });
                    }
                });
                
                allLieux.forEach(lieu => {
                    const lieuLower = lieu.toLowerCase();
                    if (lieuLower.includes(term)) {
                        suggestions.push({
                            text: lieu,
                            type: 'lieu',
                            action: () => {
                                const results = filterDataByType(lieu, 'lieu');
                                if (isModal) {
                                    displaySearchResults(results, `Lieu: ${lieu}`);
                                } else {
                                    displayResults(results, `Lieu: ${lieu}`);
                                }
                            }
                        });
                    }
                });
                
                allHeberges.forEach(personne => {
                    const personneLower = personne.toLowerCase();
                    if (personneLower.includes(term)) {
                        suggestions.push({
                            text: personne,
                            type: 'personne',
                            action: () => {
                                const results = filterByHeberge(personne);
                                if (isModal) {
                                    displaySearchResults(results, `Personne: ${personne}`);
                                } else {
                                    displayResults(results, `Personne: ${personne}`);
                                }
                            }
                        });
                    }
                });
            }
            
            const uniqueSuggestions = Array.from(new Map(suggestions.map(s => [s.text, s])).values()).slice(0, 15);
            
            if (uniqueSuggestions.length === 0) {
                container.innerHTML = '<div class="no-suggestions">Aucune suggestion trouv√©e</div>';
            } else {
                container.innerHTML = uniqueSuggestions.map(suggestion => `
                    <div class="suggestion-item" onclick="${isModal ? 'modalSuggestionClick' : 'suggestionClick'}(event, '${suggestion.text.replace(/'/g, "\\'")}', '${suggestion.type}')">
                        <div class="suggestion-text">
                            <strong>${suggestion.text}</strong>
                            <div style="font-size: 12px; color: #7f8c8d; margin-top: 2px;">
                                ${suggestion.type.charAt(0).toUpperCase() + suggestion.type.slice(1)}
                            </div>
                        </div>
                        ${suggestion.context ? `
                        <div class="suggestion-context">
                            ${suggestion.context}
                        </div>
                        ` : ''}
                    </div>
                `).join('');
            }
            
            container.style.display = 'block';
        }

        function suggestionClick(event, text, type) {
            event.stopPropagation();
            
            if (type === 'mot') {
                const results = searchData
                    .filter(item => item.searchText.includes(text.toLowerCase()))
                    .map(item => item.row);
                displayResults(results, `Recherche: "${text}"`);
            } else {
                switch(type) {
                    case 'h√¥te':
                        const resultsNom = filterDataByType(text, 'nom');
                        displayResults(resultsNom, `H√¥te: ${text}`);
                        break;
                    case 'pays':
                        const resultsPays = filterDataByType(text, 'pays');
                        displayResults(resultsPays, `Pays: ${text}`);
                        break;
                    case 'lieu':
                        const resultsLieu = filterDataByType(text, 'lieu');
                        displayResults(resultsLieu, `Lieu: ${text}`);
                        break;
                    case 'personne':
                        const resultsPersonne = filterByHeberge(text);
                        displayResults(resultsPersonne, `Personne: ${text}`);
                        break;
                    case 'type':
                        filterByType(text);
                        break;
                    case 'date':
                        const dateObj = parseDate(text);
                        if (dateObj) {
                            searchByDate(dateObj);
                        }
                        break;
                }
            }
            
            document.getElementById('globalSearchInput').value = text;
            document.getElementById('suggestionsContainer').style.display = 'none';
        }

        function modalSuggestionClick(event, text, type) {
            event.stopPropagation();
            
            if (type === 'mot') {
                const results = searchData
                    .filter(item => item.searchText.includes(text.toLowerCase()))
                    .map(item => item.row);
                displaySearchResults(results, `Recherche: "${text}"`);
            } else {
                switch(type) {
                    case 'h√¥te':
                        const resultsNom = filterDataByType(text, 'nom');
                        displaySearchResults(resultsNom, `H√¥te: ${text}`);
                        break;
                    case 'pays':
                        const resultsPays = filterDataByType(text, 'pays');
                        displaySearchResults(resultsPays, `Pays: ${text}`);
                        break;
                    case 'lieu':
                        const resultsLieu = filterDataByType(text, 'lieu');
                        displaySearchResults(resultsLieu, `Lieu: ${text}`);
                        break;
                    case 'personne':
                        const resultsPersonne = filterByHeberge(text);
                        displaySearchResults(resultsPersonne, `Personne: ${text}`);
                        break;
                    case 'type':
                        filterByType(text);
                        closeSearchModal();
                        break;
                    case 'date':
                        const dateObj = parseDate(text);
                        if (dateObj) {
                            searchByDate(dateObj);
                            closeSearchModal();
                        }
                        break;
                }
            }
            
            document.getElementById('modalSearchInput').value = text;
            document.getElementById('modalSuggestionsContainer').style.display = 'none';
        }

        function performGlobalSearch(searchTerm, isModal) {
            if (searchData.length === 0) {
                prepareSearchData();
            }
            
            currentSearchTerm = searchTerm;
            const terms = searchTerm.toLowerCase().split(/\s+/).filter(term => term.length > 0);
            
            if (terms.length === 0) {
                if (isModal) {
                    displaySearchResults([], `Recherche: "${searchTerm}"`);
                } else {
                    displayResults([], `Recherche: "${searchTerm}"`);
                }
                return;
            }
            
            const results = [];
            const searchDataWithMatchInfo = [];
            
            searchData.forEach(item => {
                let matchesAllTerms = true;
                let matchScore = 0;
                
                for (const term of terms) {
                    if (item.searchText.includes(term)) {
                        matchScore += (item.searchText.split(term).length - 1);
                    } else {
                        matchesAllTerms = false;
                        break;
                    }
                }
                
                if (matchesAllTerms) {
                    searchDataWithMatchInfo.push({
                        row: item.row,
                        score: matchScore,
                        allData: item.allData
                    });
                }
            });
            
            searchDataWithMatchInfo.sort((a, b) => b.score - a.score);
            
            const sortedResults = searchDataWithMatchInfo.map(item => item.row);
            const allDataForHighlighting = searchDataWithMatchInfo.map(item => item.allData);
            
            if (isModal) {
                displaySearchResults(sortedResults, `Recherche: "${searchTerm}"`);
            } else {
                displayResults(sortedResults, `Recherche: "${searchTerm}"`, allDataForHighlighting);
            }
        }

        function displaySearchResults(results, title) {
            const resultsContainer = document.getElementById('modalSearchResults');
            const summary = document.getElementById('searchResultsSummary');
            const countElement = document.getElementById('searchResultsCount');
            
            if (results.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="empty-state">
                        <h3>‚ùå Aucun r√©sultat trouv√©</h3>
                        <p>Aucun h√©bergement ne correspond √† votre recherche</p>
                    </div>
                `;
                summary.style.display = 'none';
                return;
            }
            
            const searchTerms = currentSearchTerm ? currentSearchTerm.toLowerCase().split(/\s+/).filter(term => term.length > 0) : [];
            
            let html = '';
            
            results.forEach((row, index) => {
                const dateDebut = colDateDebut !== -1 ? row[colDateDebut] : '';
                const dateFin = colDateFin !== -1 ? row[colDateFin] : '';
                const nom = colNom !== -1 ? row[colNom] : '';
                const pays = colPays !== -1 ? row[colPays] : '';
                const lieu = colLieu !== -1 ? row[colLieu] : '';
                const type = colHebergeEn !== -1 ? row[colHebergeEn] : '';
                
                let personnes = [];
                const colonnesPersonnes = [colMpihiraLehilahy, colMpitendry, colFeo1, colFeo2];
                colonnesPersonnes.forEach(colIndex => {
                    if (colIndex !== -1) {
                        const personnesCell = row[colIndex] || '';
                        if (personnesCell.trim()) {
                            personnesCell.split(',').forEach(p => {
                                const trimmed = p.trim();
                                if (trimmed) personnes.push(trimmed);
                            });
                        }
                    }
                });
                
                const highlightedNom = highlightText(nom, searchTerms);
                const highlightedPays = highlightText(pays, searchTerms);
                const highlightedLieu = highlightText(lieu, searchTerms);
                const highlightedType = highlightText(type, searchTerms);
                const highlightedPersonnes = personnes.map(p => highlightText(p, searchTerms)).join(', ');
                
                html += `
                    <div class="fiche-item" style="margin-bottom: 20px; cursor: pointer;" onclick="showFicheFromSearch(${sheetData.findIndex(r => r === row)})">
                        <div class="fiche-header" style="padding: 15px; position: relative;">
                            <h3 class="fiche-title" style="font-size: 1.2em;">${highlightedNom || 'H√¥te non sp√©cifi√©'}</h3>
                            <div class="fiche-pays">${highlightedPays || ''}</div>
                        </div>
                        <div style="padding: 15px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                                <div>
                                    <span style="font-weight: bold; color: var(--primary-color); font-size: 0.9em;">üìÖ Dates:</span>
                                    <div>${highlightText(dateDebut, searchTerms) || '?'} - ${highlightText(dateFin, searchTerms) || '?'}</div>
                                </div>
                                <div>
                                    <span style="font-weight: bold; color: var(--primary-color); font-size: 0.9em;">üìç Localisation:</span>
                                    <div>${highlightedLieu || '?'}, ${highlightedPays || '?'}</div>
                                </div>
                            </div>
                            ${type ? `<div style="margin-bottom: 5px;"><span style="font-weight: bold;">üè† Type:</span> ${highlightedType}</div>` : ''}
                            ${personnes.length > 0 ? `<div><span style="font-weight: bold;">üë• Personnes:</span> ${highlightedPersonnes}</div>` : ''}
                        </div>
                    </div>
                `;
            });
            
            resultsContainer.innerHTML = html;
            countElement.textContent = results.length;
            summary.style.display = 'block';
        }

        function showFicheFromSearch(rowIndex) {
            if (rowIndex >= 0 && rowIndex < sheetData.length) {
                const row = sheetData[rowIndex];
                const results = [row];
                displayResults(results, `Fiche d√©taill√©e`);
                closeSearchModal();
            }
        }

        function highlightText(text, searchTerms) {
            if (!text || !searchTerms || searchTerms.length === 0) return text;
            
            let highlightedText = text;
            searchTerms.forEach(term => {
                if (term.length < 2) return;
                
                const escapedTerm = term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                const regex = new RegExp(`(${escapedTerm})`, 'gi');
                highlightedText = highlightedText.replace(regex, '<span class="highlight">$1</span>');
            });
            
            return highlightedText;
        }

        function createHighlightedField(label, content, searchTerms) {
            if (!content || content.trim() === '') return '';
            
            const highlightedContent = highlightText(content, searchTerms);
            return `
                <div class="highlighted-field">
                    <div class="highlighted-field-label">${label}</div>
                    <div class="highlighted-field-content">${highlightedContent}</div>
                </div>
            `;
        }

        function filterByType(type) {
            if (sheetData.length === 0) {
                alert('Aucune donn√©e charg√©e');
                return;
            }
            
            let results = [];
            
            if (type === 'Famille' || type === 'H√¥tel' || type === 'Centre') {
                results = sheetData.filter(row => {
                    if (colHebergeEn !== -1) {
                        const typeValue = (row[colHebergeEn] || '').trim().toLowerCase();
                        const searchType = type.toLowerCase();
                        
                        if (searchType === 'famille' && typeValue.includes('famille')) {
                            return true;
                        } else if (searchType === 'h√¥tel' && (typeValue.includes('hotel') || typeValue.includes('h√¥tel'))) {
                            return true;
                        } else if (searchType === 'centre' && typeValue.includes('centre')) {
                            return true;
                        }
                    }
                    return false;
                });
            } else if (type === 'Autre') {
                results = sheetData.filter(row => {
                    if (colHebergeEn !== -1) {
                        const typeValue = (row[colHebergeEn] || '').trim().toLowerCase();
                        return typeValue !== '' && 
                               !typeValue.includes('famille') && 
                               !typeValue.includes('hotel') && 
                               !typeValue.includes('h√¥tel') && 
                               !typeValue.includes('centre');
                    }
                    return false;
                });
            } else {
                // Recherche pour un type sp√©cifique
                results = sheetData.filter(row => {
                    if (colHebergeEn !== -1) {
                        const typeValue = (row[colHebergeEn] || '').trim();
                        return typeValue === type;
                    }
                    return false;
                });
            }
            
            if (results.length > 0) {
                displayResults(results, `H√©bergements en ${type} (${results.length})`);
            } else {
                alert(`Aucun h√©bergement trouv√© pour le type: ${type}`);
            }
        }

        function showTableauHebergeurs() {
            if (sheetData.length === 0) {
                alert('Aucune donn√©e charg√©e');
                return;
            }
            
            document.getElementById('resultsSection').style.display = 'none';
            
            const tableauSection = document.getElementById('tableauSection');
            const tableauContent = document.getElementById('tableauContent');
            
            document.getElementById('tableauTitle').textContent = 'üìä Liste de r√©partition par h√©bergeur';
            
            generateTableauData();
            
            let html = `
                <div style="margin-bottom: 20px; padding: 15px; background: #ecf0f1; border-radius: 5px;">
                    <strong>${tableauData.length} h√©bergeur(s) trouv√©(s)</strong>
                    <div style="margin-top: 5px; font-size: 0.9em; color: #666;">
                        Total des s√©jours: ${tableauData.reduce((sum, hote) => sum + hote.sejours, 0)} |
                        Total des jours: ${tableauData.reduce((sum, hote) => sum + hote.jours, 0)} |
                        Total des nuit√©es: ${tableauData.reduce((sum, hote) => sum + hote.nuits, 0)}
                    </div>
                </div>
                
                <div class="tableau-export-buttons">
                    <button class="tableau-export-button pdf" onclick="exportTableau('pdf')">
                        üìÑ Exporter en PDF
                    </button>
                    <button class="tableau-export-button excel" onclick="exportTableau('excel')">
                        üìä Exporter en Excel
                    </button>
                </div>
                
                <table class="tableau-table">
                    <thead>
                        <tr>
                            <th class="hote-cell">H√¥te</th>
                            <th class="pays-cell">Pays</th>
                            <th class="lieu-cell">Lieu</th>
                            <th class="date-cell">Dates</th>
                            <th class="duration-cell">Dur√©e</th>
                            <th class="heberge-list-cell">Personnes h√©berg√©es</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            tableauData.forEach(hote => {
                const datesHtml = hote.dates.map(date => {
                    const dateMatch = date.match(/(\d{1,2}\/\d{1,2}\/\d{4})/);
                    if (dateMatch) {
                        const dateStr = dateMatch[1];
                        return `<div class="clickable-date" onclick="searchByDateString('${dateStr}')">${date}</div>`;
                    }
                    return `<div>${date}</div>`;
                }).join('');
                
                html += `
                    <tr>
                        <td class="hote-cell">
                            <span class="clickable-hote" onclick="showFichesForHote('${hote.nom.replace(/'/g, "\\'")}')">
                                ${hote.nom}
                            </span>
                        </td>
                        <td class="pays-cell">
                            <span class="clickable-pays" onclick="filterByLocation('${hote.pays.replace(/'/g, "\\'")}', 'pays')">
                                ${hote.pays}
                            </span>
                        </td>
                        <td class="lieu-cell">
                            <span class="clickable-lieu" onclick="filterByLocation('${hote.lieu.replace(/'/g, "\\'")}', 'lieu')">
                                ${hote.lieu}
                            </span>
                        </td>
                        <td class="date-cell">
                            <div style="display: flex; flex-direction: column; gap: 2px; font-size: 0.9em;">
                                ${datesHtml}
                            </div>
                        </td>
                        <td class="duration-cell">
                            <div style="display: flex; flex-direction: column; gap: 4px;">
                                <div style="display: flex; flex-direction: column; align-items: center;">
                                    <span style="display: inline-block; padding: 3px 6px; background: #ffc107; color: #856404; border-radius: 8px; font-weight: bold; font-size: 0.9em;">
                                        ${hote.jours} j
                                    </span>
                                    <span style="display: inline-block; padding: 3px 6px; background: #17a2b8; color: white; border-radius: 8px; font-weight: bold; font-size: 0.9em; margin-top: 3px;">
                                        ${hote.nuits} n
                                    </span>
                                </div>
                                <div style="font-size: 0.8em; color: #6c757d; margin-top: 3px;">
                                    (${hote.sejours})
                                </div>
                            </div>
                        </td>
                        <td class="heberge-list-cell">
                            <div style="display: flex; flex-wrap: wrap; gap: 2px; max-height: 80px; overflow-y: auto; padding: 3px;">
                                ${hote.personnes.map(p => `<span class="heberge-item" onclick="showPersonOptions(event, '${p.replace(/'/g, "\\'")}')">${p}</span>`).join('')}
                            </div>
                            <div style="font-size: 0.8em; color: #666; margin-top: 3px;">
                                ${hote.personnes.length} p
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
            `;
            
            tableauContent.innerHTML = html;
            tableauSection.style.display = 'block';
            
            tableauSection.scrollIntoView({ behavior: 'smooth' });
            
            hidePersonBubble();
        }
        
        function searchByDateString(dateStr) {
            const date = parseDate(dateStr);
            if (date) {
                searchByDate(date);
            } else {
                alert('Date non valide: ' + dateStr);
            }
        }
        
        function filterByLocation(value, type) {
            const results = filterDataByType(value, type);
            displayResults(results, `${type === 'pays' ? 'Pays' : 'Lieu'}: ${value}`);
        }
        
        function showFichesForHote(hoteNom) {
            const results = filterDataByType(hoteNom, 'nom');
            displayResults(results, `Fiches pour l'h√¥te: ${hoteNom}`);
        }
        
        function generateTableauData() {
            const hotesMap = new Map();
            
            sheetData.forEach((row, index) => {
                const dateDebut = colDateDebut !== -1 ? row[colDateDebut] : '';
                const dateFin = colDateFin !== -1 ? row[colDateFin] : '';
                const nom = colNom !== -1 ? row[colNom] : '';
                const pays = colPays !== -1 ? row[colPays] : '';
                const lieu = colLieu !== -1 ? row[colLieu] : '';
                
                if (nom && nom.trim()) {
                    const key = nom.trim().toLowerCase();
                    const paysValue = pays ? pays.trim() : 'Non sp√©cifi√©';
                    const lieuValue = lieu ? lieu.trim() : 'Non sp√©cifi√©';
                    const dateDebutObj = parseDate(dateDebut);
                    const dateFinObj = parseDate(dateFin);
                    
                    let dateString = '';
                    if (dateDebut && dateFin) {
                        dateString = `${dateDebut} au ${dateFin}`;
                    }
                    
                    let jours = 0;
                    let nuits = 0;
                    if (dateDebutObj && dateFinObj) {
                        const diffTime = Math.abs(dateFinObj.getTime() - dateDebutObj.getTime());
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        nuits = diffDays;
                        jours = diffDays + 1;
                    }
                    
                    let personnesLigne = [];
                    const colonnesPersonnes = [colMpihiraLehilahy, colMpitendry, colFeo1, colFeo2];
                    colonnesPersonnes.forEach(colIndex => {
                        if (colIndex !== -1) {
                            const personnes = row[colIndex] || '';
                            if (personnes.trim()) {
                                personnes.split(',').forEach(p => {
                                    const trimmed = p.trim();
                                    if (trimmed) personnesLigne.push(trimmed);
                                });
                            }
                        }
                    });
                    
                    const repartition = colRepartition !== -1 ? row[colRepartition] : '';
                    if (repartition && repartition.toLowerCase().includes('tout le monde')) {
                        personnesLigne = Array.from(allHeberges);
                    }
                    
                    if (!hotesMap.has(key)) {
                        hotesMap.set(key, {
                            nom: nom.trim(),
                            pays: paysValue,
                            lieu: lieuValue,
                            dates: [],
                            jours: 0,
                            nuits: 0,
                            sejours: 0,
                            personnes: new Set()
                        });
                    }
                    
                    const hote = hotesMap.get(key);
                    
                    if (dateString) {
                        hote.dates.push(dateString);
                    }
                    
                    hote.jours += jours;
                    hote.nuits += nuits;
                    hote.sejours++;
                    
                    personnesLigne.forEach(p => hote.personnes.add(p));
                }
            });
            
            tableauData = Array.from(hotesMap.values()).map(hote => ({
                ...hote,
                personnes: Array.from(hote.personnes).sort()
            })).sort((a, b) => a.nom.localeCompare(b.nom));
        }
        
        function exportTableau(format) {
            if (tableauData.length === 0) {
                alert('Aucune donn√©e √† exporter');
                return;
            }
            
            if (format === 'pdf') {
                exportTableauPDF();
            } else if (format === 'excel') {
                exportTableauExcel();
            }
        }
        
        function exportTableauPDF() {
            const printWindow = window.open('', '_blank');
            let pdfContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Liste de r√©partition par h√©bergeur - Tourn√©e 2026</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #8b0000; text-align: center; margin-bottom: 30px; padding-bottom: 10px; border-bottom: 2px solid #8b0000; }
                        .info { text-align: center; margin-bottom: 30px; color: #666; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th { background-color: #8b0000; color: white; padding: 12px; text-align: left; }
                        td { padding: 10px; border: 1px solid #ddd; vertical-align: top; }
                        tr:nth-child(even) { background-color: #f9f9f9; }
                        .personne-tag { background: #ffc107; color: #856404; padding: 2px 6px; border-radius: 10px; font-size: 10px; margin: 1px; display: inline-block; }
                        .duration { font-size: 0.9em; }
                        .jours { background: #ffc107; color: #856404; padding: 2px 6px; border-radius: 5px; }
                        .nuits { background: #17a2b8; color: white; padding: 2px 6px; border-radius: 5px; }
                        .sejours { font-size: 0.8em; color: #666; }
                        @media print {
                            body { margin: 10px; }
                            table { font-size: 11px; }
                        }
                    </style>
                </head>
                <body>
                    <h1>üìä Liste de r√©partition par h√©bergeur - Tourn√©e 2026</h1>
                    <div class="info">
                        <p>Export g√©n√©r√© le ${new Date().toLocaleDateString('fr-FR')}</p>
                        <p>${tableauData.length} h√©bergeur(s) | 
                           ${tableauData.reduce((sum, hote) => sum + hote.sejours, 0)} s√©jour(s) | 
                           ${tableauData.reduce((sum, hote) => sum + hote.jours, 0)} jour(s) | 
                           ${tableauData.reduce((sum, hote) => sum + hote.nuits, 0)} nuit√©e(s)</p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>H√¥te</th>
                                <th>Pays</th>
                                <th>Lieu</th>
                                <th>Dates</th>
                                <th>Dur√©e</th>
                                <th>Personnes h√©berg√©es</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            tableauData.forEach(hote => {
                pdfContent += `
                    <tr>
                        <td><strong>${hote.nom}</strong></td>
                        <td>${hote.pays}</td>
                        <td>${hote.lieu}</td>
                        <td>
                            ${hote.dates.map(date => `<div>${date}</div>`).join('')}
                        </td>
                        <td class="duration">
                            <div><span class="jours">${hote.jours} jour${hote.jours > 1 ? 's' : ''}</span></div>
                            <div style="margin-top: 3px;"><span class="nuits">${hote.nuits} nuit√©e${hote.nuits > 1 ? 's' : ''}</span></div>
                            <div class="sejours">(${hote.sejours} s√©jour${hote.sejours > 1 ? 's' : ''})</div>
                        </td>
                        <td>
                            <div style="display: flex; flex-wrap: wrap; gap: 2px;">
                                ${hote.personnes.map(p => `<span class="personne-tag">${p}</span>`).join('')}
                            </div>
                            <div style="margin-top: 5px; font-size: 0.8em; color: #666;">
                                Total: ${hote.personnes.length} personne${hote.personnes.length > 1 ? 's' : ''}
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            pdfContent += `
                        </tbody>
                    </table>
                </body>
                </html>
            `;
            
            printWindow.document.write(pdfContent);
            printWindow.document.close();
            printWindow.print();
        }
        
        function exportTableauExcel() {
            let csvContent = 'H√¥te,Pays,Lieu,Dates,Jours,Nuit√©es,S√©jours,Personnes h√©berg√©es\n';
            
            tableauData.forEach(hote => {
                const personnesStr = hote.personnes.map(p => p.replace(/,/g, ';')).join(', ');
                const datesStr = hote.dates.join(' | ');
                
                const row = [
                    `"${hote.nom}"`,
                    `"${hote.pays}"`,
                    `"${hote.lieu}"`,
                    `"${datesStr}"`,
                    hote.jours,
                    hote.nuits,
                    hote.sejours,
                    `"${personnesStr}"`
                ];
                
                csvContent += row.join(',') + '\n';
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.setAttribute('download', `liste_repartition_hebergeurs_${new Date().toISOString().slice(0,10)}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert(`Liste de r√©partition export√©e avec succ√®s! ${tableauData.length} h√©bergeur(s)`);
        }

        function exportPersonTableau(format, personName, hotesList) {
            if (hotesList.length === 0) {
                alert('Aucune donn√©e √† exporter');
                return;
            }
            
            if (format === 'pdf') {
                exportPersonTableauPDF(personName, hotesList);
            } else if (format === 'excel') {
                exportPersonTableauExcel(personName, hotesList);
            }
        }
        
        function exportPersonTableauPDF(personName, hotesList) {
            const totalJours = hotesList.reduce((sum, hote) => sum + hote.jours, 0);
            const totalNuits = hotesList.reduce((sum, hote) => sum + hote.nuits, 0);
            const totalS√©jours = hotesList.reduce((sum, hote) => sum + hote.sejours, 0);
            
            const printWindow = window.open('', '_blank');
            let pdfContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Liste des h√©bergeurs pour ${personName} - Tourn√©e 2026</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #8b0000; text-align: center; margin-bottom: 20px; }
                        .info { text-align: center; margin-bottom: 30px; color: #666; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th { background-color: #8b0000; color: white; padding: 12px; text-align: left; }
                        td { padding: 10px; border: 1px solid #ddd; vertical-align: top; }
                        tr:nth-child(even) { background-color: #f9f9f9; }
                        .duration { font-size: 0.9em; }
                        .jours { background: #ffc107; color: #856404; padding: 2px 6px; border-radius: 5px; }
                        .nuits { background: #17a2b8; color: white; padding: 2px 6px; border-radius: 5px; }
                        .sejours { font-size: 0.8em; color: #666; }
                        .summary { background: #fff3cd; padding: 15px; border-radius: 5px; margin-top: 20px; border-left: 4px solid #ffc107; }
                        @media print {
                            body { margin: 10px; }
                            table { font-size: 11px; }
                        }
                    </style>
                </head>
                <body>
                    <h1>üìä Liste des h√©bergeurs pour ${personName} - Tourn√©e 2026</h1>
                    <div class="info">
                        <p>Export g√©n√©r√© le ${new Date().toLocaleDateString('fr-FR')}</p>
                        <p>${hotesList.length} h√©bergeur(s) trouv√©(s) pour ${personName}</p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>H√¥te</th>
                                <th>Pays</th>
                                <th>Lieu</th>
                                <th>Dates</th>
                                <th>Dur√©e</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            hotesList.forEach(hote => {
                pdfContent += `
                    <tr>
                        <td><strong>${hote.nom}</strong></td>
                        <td>${hote.pays}</td>
                        <td>${hote.lieu}</td>
                        <td>
                            ${hote.dates.map(date => `<div>${date}</div>`).join('')}
                        </td>
                        <td class="duration">
                            <div><span class="jours">${hote.jours} jour${hote.jours > 1 ? 's' : ''}</span></div>
                            <div style="margin-top: 3px;"><span class="nuits">${hote.nuits} nuit√©e${hote.nuits > 1 ? 's' : ''}</span></div>
                            <div class="sejours">(${hote.sejours} s√©jour${hote.sejours > 1 ? 's' : ''})</div>
                        </td>
                    </tr>
                `;
            });
            
            pdfContent += `
                        </tbody>
                    </table>
                    <div class="summary">
                        <h3>R√©sum√© pour ${personName}:</h3>
                        <p><strong>${hotesList.length} h√©bergeur(s) diff√©rent(s)</strong></p>
                        <p><strong>${totalS√©jours} s√©jour(s)</strong></p>
                        <p><strong>${totalNuits} nuit√©e(s)</strong></p>
                        <p><strong>${totalJours} jour(s)</strong></p>
                    </div>
                </body>
                </html>
            `;
            
            printWindow.document.write(pdfContent);
            printWindow.document.close();
            printWindow.print();
        }
        
        function exportPersonTableauExcel(personName, hotesList) {
            let csvContent = 'H√¥te,Pays,Lieu,Dates,Jours,Nuit√©es,S√©jours\n';
            
            hotesList.forEach(hote => {
                const datesStr = hote.dates.join(' | ');
                
                const row = [
                    `"${hote.nom}"`,
                    `"${hote.pays}"`,
                    `"${hote.lieu}"`,
                    `"${datesStr}"`,
                    hote.jours,
                    hote.nuits,
                    hote.sejours
                ];
                
                csvContent += row.join(',') + '\n';
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            const safePersonName = personName.replace(/[^a-z0-9]/gi, '_').toLowerCase();
            link.href = url;
            link.setAttribute('download', `liste_hebergeurs_${safePersonName}_${new Date().toISOString().slice(0,10)}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert(`Liste des h√©bergeurs pour ${personName} export√©e avec succ√®s! ${hotesList.length} h√©bergeur(s)`);
        }

        function showPersonOptionsBubble(personElement, personName) {
            currentSelectedPerson = personName;
            currentClickedPersonElement = personElement;
            
            const results = filterByHeberge(personName);
            const uniqueHotes = new Map();
            
            results.forEach(row => {
                const nom = colNom !== -1 ? row[colNom] : '';
                const pays = colPays !== -1 ? row[colPays] : '';
                const lieu = colLieu !== -1 ? row[colLieu] : '';
                const dateDebut = colDateDebut !== -1 ? row[colDateDebut] : '';
                const dateFin = colDateFin !== -1 ? row[colDateFin] : '';
                
                if (nom && nom.trim()) {
                    const key = nom.trim().toLowerCase();
                    const paysValue = pays ? pays.trim() : 'Non sp√©cifi√©';
                    const lieuValue = lieu ? lieu.trim() : 'Non sp√©cifi√©';
                    
                    if (!uniqueHotes.has(key)) {
                        uniqueHotes.set(key, {
                            nom: nom.trim(),
                            pays: paysValue,
                            lieu: lieuValue,
                            dates: [],
                            jours: 0,
                            nuits: 0,
                            sejours: 0
                        });
                    }
                    
                    const hote = uniqueHotes.get(key);
                    
                    if (dateDebut && dateFin) {
                        hote.dates.push(`${dateDebut} au ${dateFin}`);
                    }
                    
                    const dateDebutObj = parseDate(dateDebut);
                    const dateFinObj = parseDate(dateFin);
                    
                    if (dateDebutObj && dateFinObj) {
                        const diffTime = Math.abs(dateFinObj.getTime() - dateDebutObj.getTime());
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        
                        hote.nuits += diffDays;
                        hote.jours += diffDays + 1;
                    }
                    
                    hote.sejours++;
                }
            });
            
            currentPersonTableauData = Array.from(uniqueHotes.values()).sort((a, b) => a.nom.localeCompare(b.nom));
            
            const bubble = document.getElementById('personOptionsBubble');
            const rect = personElement.getBoundingClientRect();
            
            if (personElement.classList.contains('tag') || personElement.classList.contains('mobile-tag')) {
                bubble.style.top = (rect.top + window.scrollY) + 'px';
                bubble.style.left = (rect.right + window.scrollX + 5) + 'px';
                bubble.style.transform = 'none';
            } else {
                bubble.style.top = (rect.bottom + window.scrollY + 5) + 'px';
                bubble.style.left = (rect.left + window.scrollX + rect.width / 2) + 'px';
                bubble.style.transform = 'translateX(-50%)';
            }
            
            bubble.style.display = 'flex';
            
            setTimeout(() => {
                const bubbleRect = bubble.getBoundingClientRect();
                
                if (bubbleRect.right > window.innerWidth) {
                    if (personElement.classList.contains('tag') || personElement.classList.contains('mobile-tag')) {
                        bubble.style.left = (rect.left + window.scrollX - bubbleRect.width - 5) + 'px';
                    } else {
                        bubble.style.left = (window.innerWidth - bubbleRect.width - 10) + 'px';
                        bubble.style.transform = 'none';
                    }
                }
                
                if (bubbleRect.left < 0) {
                    bubble.style.left = '10px';
                    bubble.style.transform = 'none';
                }
                
                if (bubbleRect.bottom > window.innerHeight) {
                    bubble.style.top = (rect.top + window.scrollY - bubbleRect.height - 5) + 'px';
                }
            }, 10);
        }
        
        function hidePersonBubble() {
            document.getElementById('personOptionsBubble').style.display = 'none';
            currentSelectedPerson = null;
            currentClickedPersonElement = null;
            currentPersonTableauData = [];
        }
        
        function showHotesTableForPerson(personName) {
            const results = filterByHeberge(personName);
            const uniqueHotes = new Map();
            
            results.forEach(row => {
                const nom = colNom !== -1 ? row[colNom] : '';
                const pays = colPays !== -1 ? row[colPays] : '';
                const lieu = colLieu !== -1 ? row[colLieu] : '';
                const dateDebut = colDateDebut !== -1 ? row[colDateDebut] : '';
                const dateFin = colDateFin !== -1 ? row[colDateFin] : '';
                
                if (nom && nom.trim()) {
                    const key = nom.trim().toLowerCase();
                    const paysValue = pays ? pays.trim() : 'Non sp√©cifi√©';
                    const lieuValue = lieu ? lieu.trim() : 'Non sp√©cifi√©';
                    
                    if (!uniqueHotes.has(key)) {
                        uniqueHotes.set(key, {
                            nom: nom.trim(),
                            pays: paysValue,
                            lieu: lieuValue,
                            dates: [],
                            jours: 0,
                            nuits: 0,
                            sejours: 0
                        });
                    }
                    
                    const hote = uniqueHotes.get(key);
                    
                    if (dateDebut && dateFin) {
                        hote.dates.push(`${dateDebut} au ${dateFin}`);
                    }
                    
                    const dateDebutObj = parseDate(dateDebut);
                    const dateFinObj = parseDate(dateFin);
                    
                    if (dateDebutObj && dateFinObj) {
                        const diffTime = Math.abs(dateFinObj.getTime() - dateDebutObj.getTime());
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        
                        hote.nuits += diffDays;
                        hote.jours += diffDays + 1;
                    }
                    
                    hote.sejours++;
                }
            });
            
            const hotesList = Array.from(uniqueHotes.values()).sort((a, b) => a.nom.localeCompare(b.nom));
            currentPersonTableauData = hotesList;
            
            const totalJours = hotesList.reduce((sum, hote) => sum + hote.jours, 0);
            const totalNuits = hotesList.reduce((sum, hote) => sum + hote.nuits, 0);
            const totalS√©jours = hotesList.reduce((sum, hote) => sum + hote.sejours, 0);
            
            const tableauSection = document.getElementById('tableauSection');
            const tableauContent = document.getElementById('tableauContent');
            
            document.getElementById('tableauTitle').textContent = `üìä Tableau de liste des h√©bergeurs pour: ${personName}`;
            
            let html = `
                <div style="margin-bottom: 20px; padding: 15px; background: #ecf0f1; border-radius: 5px;">
                    <strong>${hotesList.length} h√©bergeur(s) trouv√©(s) pour ${personName}</strong>
                    <div style="margin-top: 5px; font-size: 0.9em; color: #666;">
                        Total des s√©jours: ${totalS√©jours} |
                        Total des jours: ${totalJours} |
                        Total des nuit√©es: ${totalNuits}
                    </div>
                </div>
                
                <table class="tableau-personne-table">
                    <thead>
                        <tr>
                            <th class="hote-cell">H√¥te</th>
                            <th class="pays-cell">Pays</th>
                            <th class="lieu-cell">Lieu</th>
                            <th class="date-cell">Dates</th>
                            <th class="duration-cell">Dur√©e</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            hotesList.forEach(hote => {
                const datesHtml = hote.dates.map(date => {
                    const dateMatch = date.match(/(\d{1,2}\/\d{1,2}\/\d{4})/);
                    if (dateMatch) {
                        const dateStr = dateMatch[1];
                        return `<div class="clickable-date" onclick="searchByDateString('${dateStr}')">${date}</div>`;
                    }
                    return `<div>${date}</div>`;
                }).join('');
                
                html += `
                    <tr>
                        <td class="hote-cell">
                            <span class="clickable-hote" onclick="showFichesForHote('${hote.nom.replace(/'/g, "\\'")}')">
                                ${hote.nom}
                            </span>
                        </td>
                        <td class="pays-cell">
                            <span class="clickable-pays" onclick="filterByLocation('${hote.pays.replace(/'/g, "\\'")}', 'pays')">
                                ${hote.pays}
                            </span>
                        </td>
                        <td class="lieu-cell">
                            <span class="clickable-lieu" onclick="filterByLocation('${hote.lieu.replace(/'/g, "\\'")}', 'lieu')">
                                ${hote.lieu}
                            </span>
                        </td>
                        <td class="date-cell">
                            <div style="display: flex; flex-direction: column; gap: 2px; font-size: 0.9em;">
                                ${datesHtml}
                            </div>
                        </td>
                        <td class="duration-cell">
                            <div style="display: flex; flex-direction: column; gap: 4px;">
                                <div style="display: flex; flex-direction: column; align-items: center;">
                                    <span style="display: inline-block; padding: 3px 6px; background: #ffc107; color: #856404; border-radius: 8px; font-weight: bold; font-size: 0.9em;">
                                        ${hote.jours} j
                                    </span>
                                    <span style="display: inline-block; padding: 3px 6px; background: #17a2b8; color: white; border-radius: 8px; font-weight: bold; font-size: 0.9em; margin-top: 3px;">
                                        ${hote.nuits} n
                                    </span>
                                </div>
                                <div style="font-size: 0.8em; color: #6c757d; margin-top: 3px;">
                                    (${hote.sejours})
                                </div>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
                
                <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
                    <strong>üí° R√©sum√© pour ${personName}:</strong> ${personName} a √©t√© h√©berg√©(e) chez ${hotesList.length} h√¥te(s) diff√©rent(s) pour un total de ${totalS√©jours} s√©jour(s), soit ${totalNuits} nuit√©e(s) et ${totalJours} jour(s).
                </div>
            `;
            
            tableauContent.innerHTML = html;
            tableauSection.style.display = 'block';
            
            document.getElementById('resultsSection').style.display = 'none';
            
            tableauSection.scrollIntoView({ behavior: 'smooth' });
        }

        function showPersonOptions(event, personName) {
            event.stopPropagation();
            event.preventDefault();
            showPersonOptionsBubble(event.target, personName);
        }

        async function loadDataFromGoogleSheets() {
            console.log('üîç D√©but du chargement des donn√©es...');
            document.getElementById('loadingIndicator').style.display = 'block';
            
            try {
                console.log('üîÑ Essai 1: Acc√®s direct...');
                let response = await fetch(GOOGLE_SHEETS_URL);
                
                if (response.ok) {
                    const csvText = await response.text();
                    console.log('‚úÖ Succ√®s avec acc√®s direct');
                    processCSVData(csvText);
                    return;
                }
                throw new Error(`Direct failed: ${response.status}`);
                
            } catch (error1) {
                console.log('‚ùå √âchec acc√®s direct:', error1.message);
                
                try {
                    console.log('üîÑ Essai 2: AllOrigins...');
                    const proxyUrl = 'https://api.allorigins.win/raw?url=';
                    let response = await fetch(proxyUrl + encodeURIComponent(GOOGLE_SHEETS_URL));
                    
                    if (response.ok) {
                        const csvText = await response.text();
                        console.log('‚úÖ Succ√®s avec AllOrigins');
                        processCSVData(csvText);
                        return;
                    }
                    throw new Error(`AllOrigins failed: ${response.status}`);
                    
                } catch (error2) {
                    console.log('‚ùå √âchec AllOrigins:', error2.message);
                    showError('Impossible de charger les donn√©es. V√©rifiez votre connexion internet.');
                }
            }
        }

        function parseCSVWithNewlines(csvText) {
            console.log('üîÑ Parsing CSV avec gestion des retours √† la ligne...');
            
            const lines = [];
            let currentLine = [];
            let currentField = '';
            let inQuotes = false;
            let quoteChar = '"';
            
            for (let i = 0; i < csvText.length; i++) {
                const char = csvText[i];
                const nextChar = csvText[i + 1];
                
                if (char === quoteChar) {
                    if (inQuotes && nextChar === quoteChar) {
                        currentField += quoteChar;
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    currentLine.push(currentField);
                    currentField = '';
                } else if (char === '\n' && !inQuotes) {
                    currentLine.push(currentField);
                    lines.push(currentLine);
                    currentLine = [];
                    currentField = '';
                } else if (char === '\r') {
                    if (nextChar === '\n' && !inQuotes) {
                        currentLine.push(currentField);
                        lines.push(currentLine);
                        currentLine = [];
                        currentField = '';
                        i++;
                    }
                } else {
                    currentField += char;
                }
            }
            
            if (currentField !== '' || currentLine.length > 0) {
                currentLine.push(currentField);
                lines.push(currentLine);
            }
            
            console.log(`‚úÖ Parsing termin√©: ${lines.length} lignes d√©tect√©es`);
            return lines;
        }
        
        function processCSVData(csvText) {
            try {
                console.log('üìÑ Traitement des donn√©es CSV...');
                
                if (!csvText || csvText.trim().length === 0) {
                    throw new Error('Le fichier CSV est vide');
                }
                
                const lines = parseCSVWithNewlines(csvText);
                
                if (!lines || lines.length === 0) {
                    throw new Error('Aucune donn√©e pars√©e');
                }
                
                headers = lines[0] || [];
                console.log('üè∑Ô∏è En-t√™tes d√©tect√©s:', headers);
                
                detectColumns();
                
                sheetData = lines.slice(1).filter(row => 
                    row && row.some(cell => cell && cell.trim() !== '')
                );
                
                console.log('üìà Donn√©es extraites:', sheetData.length, 'h√©bergements');
                
                if (sheetData.length === 0) {
                    throw new Error('Aucun h√©bergement avec des donn√©es trouv√©');
                }
                
                normalizeData();
                extractAllData();
                prepareSearchData();
                updateStats();
                renderFilterTags();
                renderMobileFilterTags();
                renderCalendar();
                showDataInfo();
                
            } catch (error) {
                console.error('‚ùå Erreur de traitement:', error);
                showError(error.message);
            } finally {
                document.getElementById('loadingIndicator').style.display = 'none';
            }
        }
        
        function detectColumns() {
            headers.forEach((header, index) => {
                const lowerHeader = header.toLowerCase();
                
                if (lowerHeader.includes('date d√©but') || lowerHeader.includes('date debut')) {
                    colDateDebut = index;
                }
                else if (lowerHeader.includes('date fin')) {
                    colDateFin = index;
                }
                else if (lowerHeader.includes('nom') && !lowerHeader.includes('facebook') && !lowerHeader.includes('r√©seau')) {
                    colNom = index;
                }
                else if (lowerHeader.includes('pays')) {
                    colPays = index;
                }
                else if (lowerHeader.includes('lieu:')) {
                    colLieu = index;
                }
                else if (lowerHeader.includes('adresse') && !lowerHeader.includes('e-mail')) {
                    colAdresse = index;
                }
                else if (lowerHeader.includes('e-mail') || lowerHeader.includes('email')) {
                    colEmail = index;
                }
                else if (lowerHeader.includes('facebook') || lowerHeader.includes('r√©seau')) {
                    colFacebook = index;
                }
                else if (lowerHeader.includes('t√©l√©phone') || lowerHeader.includes('telephone') || lowerHeader.includes('whatsapp')) {
                    colTelephone = index;
                }
                else if (lowerHeader.includes('mpihira lehilahy')) {
                    colMpihiraLehilahy = index;
                }
                else if (lowerHeader.includes('mpitendry')) {
                    colMpitendry = index;
                }
                else if (lowerHeader.includes('feo 1')) {
                    colFeo1 = index;
                }
                else if (lowerHeader.includes('feo 2')) {
                    colFeo2 = index;
                }
                else if (lowerHeader.includes('sujet de pri√®re') || lowerHeader.includes('pri√®re')) {
                    colPriere = index;
                }
                else if (lowerHeader.includes('marquant')) {
                    colMarquants = index;
                }
                else if (lowerHeader.includes('photos avec les h√¥tes')) {
                    colPhotosHotes = index;
                }
                else if (lowerHeader.includes('photos des lieux')) {
                    colPhotosLieux = index;
                }
                else if (lowerHeader.includes('lien de ce formulaire')) {
                    colFormulaire = index;
                }
                else if (lowerHeader.includes('r√©partition')) {
                    colRepartition = index;
                }
                else if (lowerHeader.includes('heberg√© en') || lowerHeader.includes('h√©berg√© en')) {
                    colHebergeEn = index;
                }
                else if (lowerHeader.includes('adresse:') && !lowerHeader.includes('e-mail')) {
                    colAdresseHebergeur = index;
                }
                else if (lowerHeader.includes('lieu:') && lowerHeader !== 'lieu:') {
                    colLieuHebergeur = index;
                }
                else if (lowerHeader.includes('pays:') && lowerHeader !== 'pays') {
                    colPaysHebergeur = index;
                }
                else if (lowerHeader.includes('num√©ro:') || lowerHeader.includes('numero:')) {
                    colNumeroHebergeur = index;
                }
                else if (lowerHeader.includes('savoir sur le h√¥te') || lowerHeader.includes('savoir sur l\'h√©bergeur') || lowerHeader.includes('√† savoir')) {
                    colASavoirHote = index;
                }
                else if (lowerHeader.includes('observations') || lowerHeader.includes('commentaires') || lowerHeader.includes('remarques')) {
                    colObservations = index;
                }
            });
            
            console.log('üìä Colonnes d√©tect√©es:', {
                colDateDebut, colDateFin, colNom, colPays, colLieu,
                colAdresse, colEmail, colFacebook, colTelephone,
                colMpihiraLehilahy, colMpitendry, colFeo1, colFeo2,
                colPriere, colMarquants, colPhotosHotes, colPhotosLieux,
                colFormulaire, colRepartition, colHebergeEn,
                colAdresseHebergeur, colLieuHebergeur, colPaysHebergeur,
                colNumeroHebergeur, colASavoirHote, colObservations
            });
        }
        
        function normalizeData() {
            let maxColumns = headers.length;
            sheetData.forEach(row => {
                if (row.length > maxColumns) {
                    maxColumns = row.length;
                }
            });
            
            while (headers.length < maxColumns) {
                headers.push(`Colonne ${headers.length + 1}`);
            }
            
            sheetData.forEach(row => {
                while (row.length < maxColumns) {
                    row.push('');
                }
                if (row.length > maxColumns) {
                    row.length = maxColumns;
                }
            });
            
            console.log(`üìê Donn√©es normalis√©es: ${maxColumns} colonnes`);
        }
        
        function extractAllData() {
            allHotes = new Set();
            allPays = new Set();
            allLieux = new Set();
            allHeberges.clear();
            allPrieres = [];
            bookingPeriods = [];
            allTypes.clear();
            
            sheetData.forEach((row, index) => {
                if (colNom !== -1) {
                    const nom = row[colNom] || '';
                    if (nom.trim()) allHotes.add(nom.trim());
                }
                
                if (colPays !== -1) {
                    const pays = row[colPays] || '';
                    if (pays.trim()) allPays.add(pays.trim());
                }
                
                if (colLieu !== -1) {
                    const lieu = row[colLieu] || '';
                    if (lieu.trim()) allLieux.add(lieu.trim());
                }
                
                const colonnesPersonnes = [colMpihiraLehilahy, colMpitendry, colFeo1, colFeo2];
                colonnesPersonnes.forEach(colIndex => {
                    if (colIndex !== -1) {
                        const personnes = row[colIndex] || '';
                        if (personnes.trim()) {
                            personnes.split(',').forEach(p => {
                                const trimmed = p.trim();
                                if (trimmed) allHeberges.add(trimmed);
                            });
                        }
                    }
                });
                
                if (colPriere !== -1) {
                    const priere = row[colPriere] || '';
                    if (priere.trim()) {
                        allPrieres.push({
                            hote: row[colNom] || 'Anonyme',
                            priere: priere,
                            rowIndex: index
                        });
                    }
                }
                
                if (colHebergeEn !== -1) {
                    const typeValue = (row[colHebergeEn] || '').trim();
                    if (typeValue) {
                        // Ajouter le type √† la Map avec compteur
                        if (allTypes.has(typeValue)) {
                            allTypes.set(typeValue, allTypes.get(typeValue) + 1);
                        } else {
                            allTypes.set(typeValue, 1);
                        }
                    }
                }
                
                if (colDateDebut !== -1 && colDateFin !== -1) {
                    const dateDebut = parseDate(row[colDateDebut]);
                    const dateFin = parseDate(row[colDateFin]);
                    
                    if (dateDebut && dateFin) {
                        bookingPeriods.push({
                            start: dateDebut,
                            end: new Date(dateFin.getTime() - 24 * 60 * 60 * 1000),
                            rowIndex: index
                        });
                    }
                }
            });
            
            allHotes = Array.from(allHotes).sort();
            allPays = Array.from(allPays).sort();
            allLieux = Array.from(allLieux).sort();
            allHeberges = Array.from(allHeberges).sort();
            
            console.log('üë§ H√¥tes extraits:', allHotes.length);
            console.log('üåç Pays extraits:', allPays.length);
            console.log('üìç Lieux extraits:', allLieux.length);
            console.log('üë• Personnes h√©berg√©es extraites:', allHeberges.length);
            console.log('üôè Pri√®res extraites:', allPrieres.length);
            console.log('üìÖ P√©riodes de r√©servation:', bookingPeriods.length);
            console.log('üè† Types d\'h√©bergement:', Array.from(allTypes.entries()));
        }
        
        function updateStats() {
            document.getElementById('totalHebergements').textContent = sheetData.length;
            document.getElementById('totalHotes').textContent = allHotes.length;
            document.getElementById('totalPays').textContent = allPays.length;
            document.getElementById('totalLieux').textContent = allLieux.length;
            document.getElementById('totalHeberges').textContent = allHeberges.length;
            
            // Compter les types principaux
            let typeFamille = 0;
            let typeHotel = 0;
            let typeCentre = 0;
            let typeAutre = 0;
            
            allTypes.forEach((count, type) => {
                const typeLower = type.toLowerCase();
                if (typeLower.includes('famille')) {
                    typeFamille += count;
                } else if (typeLower.includes('hotel') || typeLower.includes('h√¥tel')) {
                    typeHotel += count;
                } else if (typeLower.includes('centre')) {
                    typeCentre += count;
                } else {
                    typeAutre += count;
                }
            });
            
            document.getElementById('totalFamille').textContent = typeFamille;
            document.getElementById('totalHotel').textContent = typeHotel;
            document.getElementById('totalCentre').textContent = typeCentre;
            document.getElementById('totalAutre').textContent = typeAutre;
            
            document.getElementById('totalHebergementsMobile').textContent = sheetData.length;
            document.getElementById('totalHotesMobile').textContent = allHotes.length;
            document.getElementById('totalPaysMobile').textContent = allPays.length;
            document.getElementById('totalLieuxMobile').textContent = allLieux.length;
            document.getElementById('totalHebergesMobile').textContent = allHeberges.length;
            document.getElementById('totalFamilleMobile').textContent = typeFamille;
            document.getElementById('totalHotelMobile').textContent = typeHotel;
            document.getElementById('totalCentreMobile').textContent = typeCentre;
            document.getElementById('totalAutreMobile').textContent = typeAutre;
            
            // Ajouter les statistiques pour les types suppl√©mentaires
            renderAdditionalTypeStats();
        }
        
        function renderAdditionalTypeStats() {
            const additionalTypeStats = document.getElementById('additionalTypeStats');
            const additionalTypeStatsMobile = document.getElementById('additionalTypeStatsMobile');
            
            let desktopHtml = '';
            let mobileHtml = '';
            
            // Trier les types par fr√©quence d√©croissante
            const sortedTypes = Array.from(allTypes.entries())
                .filter(([type, count]) => {
                    const typeLower = type.toLowerCase();
                    return !typeLower.includes('famille') && 
                           !typeLower.includes('hotel') && 
                           !typeLower.includes('h√¥tel') && 
                           !typeLower.includes('centre');
                })
                .sort((a, b) => b[1] - a[1]);
            
            sortedTypes.forEach(([type, count], index) => {
                if (index < 5) { // Limiter √† 5 types suppl√©mentaires pour √©viter le surchargement
                    desktopHtml += `
                        <div class="stat-card" onclick="filterByType('${type.replace(/'/g, "\\'")}')">
                            <div class="stat-value">${count}</div>
                            <div class="stat-label">${type}</div>
                        </div>
                    `;
                    
                    mobileHtml += `
                        <div class="stat-card" onclick="filterByType('${type.replace(/'/g, "\\'")}')">
                            <div class="stat-value">${count}</div>
                            <div class="stat-label">${type.length > 15 ? type.substring(0, 15) + '...' : type}</div>
                        </div>
                    `;
                }
            });
            
            additionalTypeStats.innerHTML = desktopHtml;
            additionalTypeStatsMobile.innerHTML = mobileHtml;
        }
        
        function renderFilterTags() {
            renderTags('hotesTags', allHotes, 'nom');
            renderTags('paysTags', allPays, 'pays');
            renderTags('lieuxTags', allLieux, 'lieu');
            renderTags('hebergesTags', allHeberges, 'heberge');
            
            // Rendre les tags de types
            const typesContainer = document.getElementById('typesTags');
            typesContainer.innerHTML = '';
            
            // Ajouter d'abord les types principaux
            const mainTypes = ['Famille', 'H√¥tel', 'Centre', 'Autre'];
            mainTypes.forEach(type => {
                const tag = document.createElement('div');
                tag.className = `tag type`;
                tag.textContent = type;
                tag.title = `Cliquez pour voir les fiches pour le type: ${type}`;
                tag.addEventListener('click', (event) => {
                    event.stopPropagation();
                    event.preventDefault();
                    filterByType(type);
                });
                typesContainer.appendChild(tag);
            });
            
            // Puis les types sp√©cifiques de la Map
            allTypes.forEach((count, type) => {
                // Ne pas ajouter les types principaux qui sont d√©j√† inclus
                const typeLower = type.toLowerCase();
                if (!typeLower.includes('famille') && 
                    !typeLower.includes('hotel') && 
                    !typeLower.includes('h√¥tel') && 
                    !typeLower.includes('centre') &&
                    type !== 'Autre') {
                    
                    const tag = document.createElement('div');
                    tag.className = `tag type`;
                    tag.textContent = type;
                    tag.title = `Cliquez pour voir les fiches pour le type: ${type} (${count})`;
                    tag.addEventListener('click', (event) => {
                        event.stopPropagation();
                        event.preventDefault();
                        filterByType(type);
                    });
                    typesContainer.appendChild(tag);
                }
            });
        }
        
        function renderMobileFilterTags() {
            renderMobileTags('mobileHotesTags', allHotes, 'nom');
            renderMobileTags('mobilePaysTags', allPays, 'pays');
            renderMobileTags('mobileLieuxTags', allLieux, 'lieu');
            renderMobileTags('mobileHebergesTags', allHeberges, 'heberge');
            
            // Rendre les tags de types mobiles
            const mobileTypesContainer = document.getElementById('mobileTypesTags');
            mobileTypesContainer.innerHTML = '';
            
            // Ajouter d'abord les types principaux
            const mainTypes = ['Famille', 'H√¥tel', 'Centre', 'Autre'];
            mainTypes.forEach(type => {
                const tag = document.createElement('div');
                tag.className = `mobile-tag type`;
                tag.textContent = type;
                tag.title = `Cliquez pour voir les fiches pour le type: ${type}`;
                tag.addEventListener('click', (event) => {
                    event.stopPropagation();
                    event.preventDefault();
                    filterByType(type);
                });
                mobileTypesContainer.appendChild(tag);
            });
            
            // Puis les types sp√©cifiques de la Map
            allTypes.forEach((count, type) => {
                // Ne pas ajouter les types principaux qui sont d√©j√† inclus
                const typeLower = type.toLowerCase();
                if (!typeLower.includes('famille') && 
                    !typeLower.includes('hotel') && 
                    !typeLower.includes('h√¥tel') && 
                    !typeLower.includes('centre') &&
                    type !== 'Autre') {
                    
                    const tag = document.createElement('div');
                    tag.className = `mobile-tag type`;
                    tag.textContent = type.length > 20 ? type.substring(0, 20) + '...' : type;
                    tag.title = `Cliquez pour voir les fiches pour le type: ${type} (${count})`;
                    tag.addEventListener('click', (event) => {
                        event.stopPropagation();
                        event.preventDefault();
                        filterByType(type);
                    });
                    mobileTypesContainer.appendChild(tag);
                }
            });
        }
        
        function renderTags(containerId, items, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if (items.length === 0) {
                container.innerHTML = '<div style="color: #7f8c8d; font-style: italic;">Aucun ' + type + ' trouv√©</div>';
                return;
            }
            
            items.forEach(item => {
                const tag = document.createElement('div');
                tag.className = `tag ${type}`;
                tag.textContent = item;
                
                if (type === 'heberge') {
                    tag.title = `Cliquez pour voir les options pour ${item}`;
                    tag.addEventListener('click', (event) => {
                        event.stopPropagation();
                        event.preventDefault();
                        showPersonOptionsBubble(tag, item);
                    });
                } else if (type === 'type') {
                    tag.title = `Cliquez pour voir les fiches pour le type: ${item}`;
                    tag.addEventListener('click', (event) => {
                        event.stopPropagation();
                        event.preventDefault();
                        filterByType(item);
                    });
                } else {
                    tag.title = `Cliquez pour voir les fiches pour ${item}`;
                    tag.addEventListener('click', (event) => {
                        event.stopPropagation();
                        event.preventDefault();
                        const results = filterDataByType(item, type);
                        displayResults(results, `Fiches pour ${type}: ${item}`);
                    });
                }
                
                container.appendChild(tag);
            });
        }
        
        function renderMobileTags(containerId, items, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if (items.length === 0) {
                container.innerHTML = '<div style="color: #7f8c8d; font-style: italic; font-size: 0.9em; padding: 10px; text-align: center;">Aucun ' + type + ' trouv√©</div>';
                return;
            }
            
            items.forEach(item => {
                const tag = document.createElement('div');
                tag.className = `mobile-tag ${type}`;
                tag.textContent = item;
                
                if (type === 'heberge') {
                    tag.title = `Cliquez pour voir les options pour ${item}`;
                    tag.addEventListener('click', (event) => {
                        event.stopPropagation();
                        event.preventDefault();
                        showPersonOptionsBubble(tag, item);
                    });
                } else if (type === 'type') {
                    tag.title = `Cliquez pour voir les fiches pour le type: ${item}`;
                    tag.addEventListener('click', (event) => {
                        event.stopPropagation();
                        event.preventDefault();
                        filterByType(item);
                    });
                } else {
                    tag.title = `Cliquez pour voir les fiches pour ${item}`;
                    tag.addEventListener('click', (event) => {
                        event.stopPropagation();
                        event.preventDefault();
                        const results = filterDataByType(item, type);
                        displayResults(results, `Fiches pour ${type}: ${item}`);
                    });
                }
                
                container.appendChild(tag);
            });
        }
        
        function filterDataByType(value, type) {
            let columnIndex = -1;
            
            switch(type) {
                case 'nom':
                    columnIndex = colNom;
                    break;
                case 'pays':
                    columnIndex = colPays;
                    break;
                case 'lieu':
                    columnIndex = colLieu;
                    break;
                case 'type':
                    columnIndex = colHebergeEn;
                    break;
            }
            
            if (columnIndex === -1) return [];
            
            return sheetData.filter(row => {
                const cellValue = row[columnIndex] || '';
                return cellValue.includes(value);
            });
        }
        
        function filterByHeberge(nom) {
            return sheetData.filter(row => {
                const colonnesPersonnes = [colMpihiraLehilahy, colMpitendry, colFeo1, colFeo2];
                return colonnesPersonnes.some(colIndex => {
                    if (colIndex === -1) return false;
                    const personnes = row[colIndex] || '';
                    return personnes.toLowerCase().includes(nom.toLowerCase());
                });
            });
        }
        
        function showPrieres() {
            if (allPrieres.length === 0) {
                alert('Aucun sujet de pri√®re trouv√©');
                return;
            }
            
            let html = `
                <div style="margin-bottom: 20px; padding: 15px; background: #ecf0f1; border-radius: 5px;">
                    <strong>${allPrieres.length} sujet(s) de pri√®re trouv√©(s)</strong>
                </div>
            `;
            
            allPrieres.forEach(priere => {
                html += `
                    <div class="fiche-item">
                        <div class="fiche-header">
                            <h2>üôè Sujet de Pri√®re</h2>
                            <h3 class="fiche-title">${priere.hote}</h3>
                            <div class="fiche-pays">${getPaysForRow(priere.rowIndex)}</div>
                        </div>
                        <div class="priere-section">
                            <div class="priere-content">${priere.priere}</div>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('resultContent').innerHTML = html;
            document.getElementById('resultTitle').textContent = 'Sujets de pri√®re';
            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('tableauSection').style.display = 'none';
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        function getPaysForRow(rowIndex) {
            if (rowIndex >= 0 && rowIndex < sheetData.length && colPays !== -1) {
                return sheetData[rowIndex][colPays] || '';
            }
            return '';
        }
        
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const monthElement = document.getElementById('currentMonth');
            
            const monthNames = ["Janvier", "F√©vrier", "Mars", "Avril", "Mai", "Juin",
                "Juillet", "Ao√ªt", "Septembre", "Octobre", "Novembre", "D√©cembre"];
            monthElement.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            
            grid.innerHTML = '';
            
            ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'].forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-day-header';
                dayHeader.textContent = day;
                grid.appendChild(dayHeader);
            });
            
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const today = new Date();
            
            let startDay = firstDay.getDay();
            startDay = startDay === 0 ? 6 : startDay - 1;
            
            for (let i = 0; i < startDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day other-month';
                grid.appendChild(emptyDay);
            }
            
            for (let i = 1; i <= lastDay.getDate(); i++) {
                const day = document.createElement('div');
                day.className = 'calendar-day';
                day.textContent = i;
                
                const date = new Date(currentDate.getFullYear(), currentDate.getMonth(), i);
                
                if (date.getDate() === today.getDate() && 
                    date.getMonth() === today.getMonth() && 
                    date.getFullYear() === today.getFullYear()) {
                    day.classList.add('today');
                }
                
                const isInBookingPeriod = bookingPeriods.some(period => 
                    date >= period.start && date <= period.end
                );
                
                if (isInBookingPeriod) {
                    day.classList.add('booking-period');
                    day.classList.add('has-data');
                    day.title = 'P√©riode de r√©servation d\'h√©bergement - Cliquez pour voir les options';
                }
                
                if (selectedDate && 
                    selectedDate.getDate() === date.getDate() &&
                    selectedDate.getMonth() === date.getMonth() &&
                    selectedDate.getFullYear() === date.getFullYear()) {
                    day.classList.add('selected');
                }
                
                day.addEventListener('click', (e) => {
                    e.stopPropagation();
                    selectDate(date);
                });
                
                grid.appendChild(day);
            }
        }
        
        function selectDate(date) {
            selectedDate = date;
            const matchingRows = findEntriesByDate(date);
            displayResults(matchingRows, `H√©bergements pour le ${formatDateForDisplay(date)}`);
            renderCalendar();
            hidePersonBubble();
        }
        
        function findEntriesByDate(date) {
            return sheetData.filter((row, index) => {
                if (colDateDebut === -1 || colDateFin === -1) return false;
                
                const dateDebut = parseDate(row[colDateDebut]);
                const dateFin = parseDate(row[colDateFin]);
                
                if (!dateDebut || !dateFin) return false;
                
                const dateFinMinusOne = new Date(dateFin.getTime() - 24 * 60 * 60 * 1000);
                return date >= dateDebut && date <= dateFinMinusOne;
            });
        }
        
        function parseDate(dateString) {
            if (!dateString) return null;
            
            const formats = [
                /^(\d{1,2})\/(\d{1,2})\/(\d{4})$/,
                /^(\d{4})-(\d{1,2})-(\d{1,2})$/,
                /^(\d{1,2})-(\d{1,2})-(\d{4})$/
            ];
            
            for (const format of formats) {
                const match = dateString.match(format);
                if (match) {
                    if (format === formats[0]) {
                        return new Date(match[3], match[2] - 1, match[1]);
                    } else if (format === formats[1]) {
                        return new Date(match[1], match[2] - 1, match[3]);
                    } else if (format === formats[2]) {
                        return new Date(match[3], match[2] - 1, match[1]);
                    }
                }
            }
            
            const parsed = Date.parse(dateString);
            if (!isNaN(parsed)) {
                return new Date(parsed);
            }
            
            console.warn('Impossible de parser la date:', dateString);
            return null;
        }
        
        function formatDateForDisplay(date) {
            return date.toLocaleDateString('fr-FR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        function showDataInfo() {
            const dataInfo = document.getElementById('dataInfo');
            dataInfo.innerHTML = `
                <div class="success-message">
                    ‚úÖ Donn√©es charg√©es avec succ√®s : ${sheetData.length} h√©bergement(s) trouv√©(s)
                    <br><small>${allHotes.length} h√¥tes - ${allPays.length} pays - ${allLieux.length} lieux - ${allHeberges.length} personnes h√©berg√©es</small>
                    <br><small>${Array.from(allTypes.entries()).map(([type, count]) => `${count} ${type}`).join(', ')}</small>
                </div>
            `;
            dataInfo.style.display = 'block';
        }
        
        function showError(message) {
            const searchSection = document.querySelector('.search-section');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.innerHTML = `
                <strong>‚ùå Erreur de chargement:</strong> ${message}
                <br><small>V√©rifiez votre connexion internet et que le Google Sheet est public</small>
            `;
            searchSection.appendChild(errorDiv);
        }
        
        function clearErrorMessages() {
            const errorMessages = document.querySelectorAll('.error-message');
            errorMessages.forEach(msg => msg.remove());
        }
        
        function handleSearch() {
            const dateValue = document.getElementById('dateInput')?.value;
            
            if (!dateValue) {
                alert('Veuillez s√©lectionner une date');
                return;
            }
            
            if (sheetData.length === 0) {
                alert('Aucune donn√©e charg√©e');
                return;
            }
            
            const selectedDate = new Date(dateValue);
            searchByDate(selectedDate);
            hidePersonBubble();
        }
        
        function searchByDate(date) {
            const results = findEntriesByDate(date);
            const formattedDate = formatDateForDisplay(date);
            displayResults(results, `H√©bergements pour le ${formattedDate}`);
            
            scrollToDateInCalendar(date);
        }
        
        function scrollToDateInCalendar(date) {
            if (date.getMonth() !== currentDate.getMonth() || date.getFullYear() !== currentDate.getFullYear()) {
                currentDate = new Date(date.getFullYear(), date.getMonth(), 1);
                renderCalendar();
            }
            
            setTimeout(() => {
                const dayElements = document.querySelectorAll('.calendar-day:not(.other-month)');
                dayElements.forEach(dayElement => {
                    if (parseInt(dayElement.textContent) === date.getDate()) {
                        document.querySelectorAll('.calendar-day.selected').forEach(el => {
                            el.classList.remove('selected');
                        });
                        
                        dayElement.classList.add('selected');
                        dayElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                });
            }, 100);
        }
        
        function showAllData() {
            if (sheetData.length === 0) {
                alert('Aucune donn√©e charg√©e');
                return;
            }
            
            displayResults(sheetData, 'Tous les h√©bergements');
            document.getElementById('tableauSection').style.display = 'none';
            hidePersonBubble();
        }
        
        function displayResults(results, title, allDataForHighlighting = null) {
            const resultsSection = document.getElementById('resultsSection');
            const resultContent = document.getElementById('resultContent');
            const resultTitle = document.getElementById('resultTitle');
            
            document.getElementById('tableauSection').style.display = 'none';
            
            if (results.length === 0) {
                resultContent.innerHTML = `
                    <div class="empty-state">
                        <h3>‚ùå Aucun h√©bergement trouv√©</h3>
                        <p>Aucun h√©bergement ne correspond √† votre recherche</p>
                    </div>
                `;
            } else {
                const searchTerms = currentSearchTerm ? currentSearchTerm.toLowerCase().split(/\s+/).filter(term => term.length > 0) : [];
                
                let html = `
                    <div style="margin-bottom: 20px; padding: 15px; background: #ecf0f1; border-radius: 5px;">
                        <strong>${results.length} h√©bergement(s) trouv√©(s)</strong>
                `;
                
                if (currentSearchTerm) {
                    html += `<br><em>Recherche: "${currentSearchTerm}"</em>`;
                }
                
                if (currentSelectedPerson) {
                    html += `<br><em>Filtr√© par: ${currentSelectedPerson}</em>`;
                }
                
                html += `</div>`;
                
                results.forEach((row, index) => {
                    const numeroData = sheetData.findIndex(r => r === row) + 1;
                    
                    const dateDebut = colDateDebut !== -1 ? row[colDateDebut] : '';
                    const dateFin = colDateFin !== -1 ? row[colDateFin] : '';
                    const nom = colNom !== -1 ? row[colNom] : '';
                    const pays = colPays !== -1 ? row[colPays] : '';
                    const lieu = colLieu !== -1 ? row[colLieu] : '';
                    const adresse = colAdresse !== -1 ? row[colAdresse] : '';
                    const email = colEmail !== -1 ? row[colEmail] : '';
                    const facebook = colFacebook !== -1 ? row[colFacebook] : '';
                    const telephone = colTelephone !== -1 ? row[colTelephone] : '';
                    const mpihiraLehilahy = colMpihiraLehilahy !== -1 ? row[colMpihiraLehilahy] : '';
                    const mpitendry = colMpitendry !== -1 ? row[colMpitendry] : '';
                    const feo1 = colFeo1 !== -1 ? row[colFeo1] : '';
                    const feo2 = colFeo2 !== -1 ? row[colFeo2] : '';
                    const priere = colPriere !== -1 ? row[colPriere] : '';
                    const marquants = colMarquants !== -1 ? row[colMarquants] : '';
                    const photosHotes = colPhotosHotes !== -1 ? row[colPhotosHotes] : '';
                    const photosLieux = colPhotosLieux !== -1 ? row[colPhotosLieux] : '';
                    const formulaire = colFormulaire !== -1 ? row[colFormulaire] : '';
                    const repartition = colRepartition !== -1 ? row[colRepartition] : '';
                    const type = colHebergeEn !== -1 ? row[colHebergeEn] : '';
                    const observations = colObservations !== -1 ? row[colObservations] : '';
                    
                    const adresseHebergeur = colAdresseHebergeur !== -1 ? row[colAdresseHebergeur] : '';
                    const lieuHebergeur = colLieuHebergeur !== -1 ? row[colLieuHebergeur] : '';
                    const paysHebergeur = colPaysHebergeur !== -1 ? row[colPaysHebergeur] : '';
                    const numeroHebergeur = colNumeroHebergeur !== -1 ? row[colNumeroHebergeur] : '';
                    
                    const aSavoirHote = colASavoirHote !== -1 ? row[colASavoirHote] : '';
                    
                    let adresseComplete = adresseHebergeur || adresse || '';
                    if (adresseComplete && lieuHebergeur) {
                        adresseComplete += ` - ${lieuHebergeur}`;
                    }
                    if (adresseComplete && paysHebergeur) {
                        adresseComplete += ` / ${paysHebergeur}`;
                    }
                    
                    let toutesPersonnes = [];
                    const colonnesPersonnes = [
                        {data: mpihiraLehilahy, type: 'Mpihira Lehilahy'},
                        {data: mpitendry, type: 'Mpitendry'},
                        {data: feo1, type: 'Feo 1'},
                        {data: feo2, type: 'Feo 2'}
                    ];
                    
                    colonnesPersonnes.forEach(col => {
                        if (col.data && col.data.trim()) {
                            col.data.split(',').forEach(p => {
                                const trimmed = p.trim();
                                if (trimmed) toutesPersonnes.push(trimmed);
                            });
                        }
                    });
                    
                    let personnesAffichees = '';
                    let personnesPourTags = [];
                    
                    if (repartition && repartition.trim()) {
                        if (repartition.toLowerCase().includes('tout le monde')) {
                            personnesPourTags = Array.from(allHeberges);
                            personnesAffichees = `Tout le monde / ${personnesPourTags.join(', ')}`;
                        } else {
                            personnesPourTags = toutesPersonnes;
                            personnesAffichees = `${repartition} / ${toutesPersonnes.join(', ')}`;
                        }
                    } else {
                        personnesPourTags = toutesPersonnes;
                        personnesAffichees = toutesPersonnes.join(', ');
                    }
                    
                    const titreFiche = `${dateDebut || '?'} - ${dateFin || '?'} / ${personnesPourTags.length > 0 ? personnesPourTags.join(', ') : 'Aucun h√©berg√©'}`;
                    
                    const isMobile = window.innerWidth <= 768;
                    
                    const rendreDateCliquable = (dateStr) => {
                        if (!dateStr || dateStr === 'Non sp√©cifi√©e') return dateStr;
                        const dateObj = parseDate(dateStr);
                        if (dateObj) {
                            return `<span class="date-clickable" onclick="searchByDate(new Date(${dateObj.getTime()}))">${dateStr}</span>`;
                        }
                        return dateStr;
                    };
                    
                    const rendreLocationCliquable = (value, type) => {
                        if (!value || value === 'Non sp√©cifi√©') return value;
                        return `<span class="location-clickable" onclick="filterByLocation('${value.replace(/'/g, "\\'")}', '${type}')">${value}</span>`;
                    };
                    
                    const highlightedNom = highlightText(nom, searchTerms);
                    const highlightedPays = highlightText(pays, searchTerms);
                    const highlightedLieu = highlightText(lieu, searchTerms);
                    const highlightedType = highlightText(type, searchTerms);
                    const highlightedDateDebut = highlightText(dateDebut, searchTerms);
                    const highlightedDateFin = highlightText(dateFin, searchTerms);
                    const highlightedAdresse = highlightText(adresseComplete, searchTerms);
                    const highlightedEmail = highlightText(email, searchTerms);
                    const highlightedFacebook = highlightText(facebook, searchTerms);
                    const highlightedTelephone = highlightText(telephone, searchTerms);
                    const highlightedNumeroHebergeur = highlightText(numeroHebergeur, searchTerms);
                    const highlightedPersonnes = toutesPersonnes.map(p => highlightText(p, searchTerms));
                    const highlightedPriere = highlightText(priere, searchTerms);
                    const highlightedMarquants = highlightText(marquants, searchTerms);
                    const highlightedASavoir = highlightText(aSavoirHote, searchTerms);
                    const highlightedRepartition = highlightText(repartition, searchTerms);
                    const highlightedObservations = highlightText(observations, searchTerms);
                    
                    let highlightedFields = '';
                    if (searchTerms.length > 0) {
                        if (nom && searchTerms.some(term => nom.toLowerCase().includes(term))) {
                            highlightedFields += createHighlightedField('üë§ H√¥te', nom, searchTerms);
                        }
                        if (pays && searchTerms.some(term => pays.toLowerCase().includes(term))) {
                            highlightedFields += createHighlightedField('üåç Pays', pays, searchTerms);
                        }
                        if (lieu && searchTerms.some(term => lieu.toLowerCase().includes(term))) {
                            highlightedFields += createHighlightedField('üìç Lieu', lieu, searchTerms);
                        }
                        if (type && searchTerms.some(term => type.toLowerCase().includes(term))) {
                            highlightedFields += createHighlightedField('üè† Type', type, searchTerms);
                        }
                        if (dateDebut && searchTerms.some(term => dateDebut.toLowerCase().includes(term))) {
                            highlightedFields += createHighlightedField('üìÖ Date d√©but', dateDebut, searchTerms);
                        }
                        if (dateFin && searchTerms.some(term => dateFin.toLowerCase().includes(term))) {
                            highlightedFields += createHighlightedField('üìÖ Date fin', dateFin, searchTerms);
                        }
                        if (adresseComplete && searchTerms.some(term => adresseComplete.toLowerCase().includes(term))) {
                            highlightedFields += createHighlightedField('üìç Adresse', adresseComplete, searchTerms);
                        }
                        if (email && searchTerms.some(term => email.toLowerCase().includes(term))) {
                            highlightedFields += createHighlightedField('üìß Email', email, searchTerms);
                        }
                        if (facebook && searchTerms.some(term => facebook.toLowerCase().includes(term))) {
                            highlightedFields += createHighlightedField('üë• Facebook', facebook, searchTerms);
                        }
                        if (telephone && searchTerms.some(term => telephone.toLowerCase().includes(term))) {
                            highlightedFields += createHighlightedField('üì± T√©l√©phone', telephone, searchTerms);
                        }
                        if (numeroHebergeur && searchTerms.some(term => numeroHebergeur.toLowerCase().includes(term))) {
                            highlightedFields += createHighlightedField('üî¢ Num√©ro', numeroHebergeur, searchTerms);
                        }
                        if (personnesPourTags.length > 0) {
                            const personnesMatch = personnesPourTags.filter(p => 
                                searchTerms.some(term => p.toLowerCase().includes(term))
                            );
                            if (personnesMatch.length > 0) {
                                highlightedFields += createHighlightedField('üë• Personnes h√©berg√©es', personnesMatch.join(', '), searchTerms);
                            }
                        }
                        if (priere && searchTerms.some(term => priere.toLowerCase().includes(term))) {
                            highlightedFields += createHighlightedField('üôè Sujet de pri√®re', priere, searchTerms);
                        }
                        if (marquants && searchTerms.some(term => marquants.toLowerCase().includes(term))) {
                            highlightedFields += createHighlightedField('‚≠ê Marquants', marquants, searchTerms);
                        }
                        if (aSavoirHote && searchTerms.some(term => aSavoirHote.toLowerCase().includes(term))) {
                            highlightedFields += createHighlightedField('‚ÑπÔ∏è √Ä savoir sur le h√¥te', aSavoirHote, searchTerms);
                        }
                        if (repartition && searchTerms.some(term => repartition.toLowerCase().includes(term))) {
                            highlightedFields += createHighlightedField('üìä R√©partition', repartition, searchTerms);
                        }
                        if (observations && searchTerms.some(term => observations.toLowerCase().includes(term))) {
                            highlightedFields += createHighlightedField('üìù Observations', observations, searchTerms);
                        }
                    }
                    
                    function generatePhotoPreviews(photoLinks, type) {
                        if (!photoLinks || !photoLinks.trim()) return '';
                        
                        const links = photoLinks.split(/[,;]/).map(link => link.trim()).filter(link => link);
                        if (links.length === 0) return '';
                        
                        let previewsHtml = '<div class="photos-preview-grid">';
                        
                        links.forEach((link, idx) => {
                            const linkText = link.replace(/^https?:\/\//, '').replace(/\/$/, '');
                            const displayText = linkText.length > 30 ? linkText.substring(0, 30) + '...' : linkText;
                            const photoTitle = `${type} - ${displayText}`;
                            const thumbnailUrl = generatePhotoThumbnail(link);
                            
                            previewsHtml += `
                                <div class="photo-preview-container">
                                    <a href="${link}" target="_blank" class="photo-link-with-preview" onclick="event.stopPropagation()">
                                        <img src="${thumbnailUrl}" alt="${photoTitle}" class="photo-thumbnail" 
                                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjgwIiBoZWlnaHQ9IjI4MCIgdmlld0JveD0iMCAwIDI4MCAyODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjI4MCIgaGVpZ2h0PSIyODAiIGZpbGw9IiNlOGY0ZjgiLz48cGF0aCBkPSJNNjAgMTAwTDIyMCAxMDBMMTgwIDE4MEg5MEwyMjAgMTgwSDYwVjEwMFoiIGZpbGw9IiMzNDk4ZGIiLz48Y2lyY2xlIGN4PSIxNDAiIGN5PSIxNDAiIHI9IjQ1IiBmaWxsPSIjZjc0YzNjIi8+PC9zdmc+'; this.alt='Image non disponible'">
                                    </a>
                                    <div class="photo-label">
                                        ${type} ${idx + 1}<br>
                                        <small style="font-size: 0.8em; font-weight: normal; opacity: 0.8;">Cliquer pour agrandir</small>
                                    </div>
                                </div>
                            `;
                        });
                        
                        previewsHtml += '</div>';
                        return previewsHtml;
                    }
                    
                    html += `
                        <div class="fiche-item">
                            <div class="fiche-header">
                                <h2>üè® H√©bergement Tourn√©e 2026</h2>
                                <h3 class="fiche-title">${highlightText(titreFiche, searchTerms)}</h3>
                                <div class="fiche-pays">${highlightedPays || ''}</div>
                            </div>
                            
                            ${highlightedFields ? `
                            <div style="padding: 15px; background: #fff3cd; border-bottom: 1px solid #ffc107;">
                                <div style="font-weight: bold; color: #856404; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                                    üîç Correspondances trouv√©es
                                </div>
                                ${highlightedFields}
                            </div>
                            ` : ''}
                            
                            <div class="hote-section">
                                <span class="hote-label">üë§ H√©berg√© chez :</span>
                                <div class="hote-name">${highlightedNom || 'H√¥te non sp√©cifi√©'}</div>
                            </div>
                            
                            <div class="localisation-section">
                                <span class="localisation-label">üìç Localisation :</span>
                                <div class="localisation-content">
                                    ${rendreLocationCliquable(highlightedLieu, 'lieu') || 'Non sp√©cifi√©'}, 
                                    ${rendreLocationCliquable(highlightedPays, 'pays') || 'Non sp√©cifi√©'}
                                </div>
                            </div>
                            
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">üìÖ Dates:</span>
                                    <span class="info-value">
                                        ${rendreDateCliquable(highlightedDateDebut) || 'Non sp√©cifi√©e'} - 
                                        ${rendreDateCliquable(highlightedDateFin) || 'Non sp√©cifi√©e'}
                                    </span>
                                </div>
                            </div>
                            
                            ${type ? `
                            <div class="hebergement-type-section">
                                <div class="hebergement-type-label">üè† H√©berg√© en:</div>
                                <div class="hebergement-type-content">${highlightedType}</div>
                            </div>
                            ` : ''}
                            
                            ${personnesPourTags.length > 0 ? `
                            <div class="heberges-list">
                                <div class="heberges-label">üë• Les h√©berg√©s:</div>
                                <div class="heberges-tags">
                                    ${personnesPourTags.map(p => `<div class="heberge-tag" onclick="showPersonOptions(event, '${p.replace(/'/g, "\\'")}')">${highlightText(p, searchTerms)}</div>`).join('')}
                                </div>
                                <div style="margin-top: 10px; font-style: italic; color: #666;">
                                    ${highlightText(personnesAffichees, searchTerms)}
                                </div>
                            </div>
                            ` : ''}
                            
                            ${(adresseComplete || email || facebook || telephone || numeroHebergeur) ? `
                            <div class="contact-section">
                                <div class="contact-label">üìû Information sur ${highlightText(nom, searchTerms) || 'l\'h√©bergeur'}:</div>
                                ${adresseComplete ? `<div style="margin-bottom: 8px;"><strong>üìç Adresse:</strong> ${highlightedAdresse}</div>` : ''}
                                ${numeroHebergeur ? `<div style="margin-bottom: 8px;"><strong>üî¢ Num√©ro:</strong> <span class="phone-clickable" onclick="window.location.href='tel:${numeroHebergeur}'">${highlightedNumeroHebergeur}</span></div>` : ''}
                                <div style="height: 1px; background: #ddd; margin: 10px 0;"></div>
                                ${email ? `<div style="margin-bottom: 8px;"><strong>üìß Adresse e-mail:</strong> <a href="mailto:${email}" class="contact-link">${highlightedEmail}</a></div>` : ''}
                                ${facebook ? `<div style="margin-bottom: 8px;"><strong>üë• Nom sur Facebook ou autres compte r√©seaux sociaux:</strong> ${highlightedFacebook}</div>` : ''}
                                ${telephone ? `<div style="margin-bottom: 8px;"><strong>üì± Num√©ro t√©l√©phone/Whatsapp:</strong> <span class="phone-clickable" onclick="window.location.href='tel:${telephone}'">${highlightedTelephone}</span></div>` : ''}
                            </div>
                            ` : ''}
                            
                            ${aSavoirHote ? `
                            <div class="hote-info-section">
                                <div class="hote-info-label">‚ÑπÔ∏è √Ä savoir sur le h√¥te/l'h√©bergeur:</div>
                                <div class="hote-info-content">${highlightedASavoir}</div>
                            </div>
                            ` : ''}
                            
                            ${marquants ? `
                            <div class="marquants-section">
                                <div class="marquants-label">‚≠ê Marquants:</div>
                                <div class="marquants-content">${highlightedMarquants}</div>
                            </div>
                            ` : ''}
                            
                            ${priere ? `
                            <div class="priere-section">
                                <div class="priere-label">üôè Sujet de pri√®re:</div>
                                <div class="priere-content">${highlightedPriere}</div>
                            </div>
                            ` : ''}
                            
                            ${observations ? `
                            <div class="observations-section">
                                <div class="observations-label">üìù Observations:</div>
                                <div class="observations-content">${highlightedObservations}</div>
                            </div>
                            ` : ''}
                            
                            ${(photosHotes || photosLieux) ? `
                            <div class="photo-link-section">
                                <div class="photo-link-label">üì∏ Aper√ßus des photos (cliquez pour agrandir)</div>
                                ${photosHotes ? `
                                <div style="margin-bottom: 15px;">
                                    <div style="font-weight: bold; color: #9b59b6; margin-bottom: 8px;">üì∑ Photos avec les h√¥tes:</div>
                                    ${generatePhotoPreviews(photosHotes, 'Photos h√¥tes')}
                                </div>
                                ` : ''}
                                ${photosLieux ? `
                                <div>
                                    <div style="font-weight: bold; color: #e74c3c; margin-bottom: 8px;">üèûÔ∏è Photos des lieux:</div>
                                    ${generatePhotoPreviews(photosLieux, 'Photos lieux')}
                                </div>
                                ` : ''}
                            </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                resultContent.innerHTML = html;
            }
            
            resultTitle.textContent = `${title} (${results.length} h√©bergement${results.length > 1 ? 's' : ''})`;
            resultsSection.style.display = 'block';
            
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        function closeResults() {
            document.getElementById('resultsSection').style.display = 'none';
            hidePersonBubble();
        }

        function showPasswordModal() {
            document.getElementById('passwordModal').style.display = 'flex';
            document.getElementById('adminPassword').focus();
        }

        function showExportModal() {
            if (sheetData.length === 0) {
                alert('Aucune donn√©e √† exporter');
                return;
            }
            
            resetExportModal();
            document.getElementById('exportModal').style.display = 'flex';
        }

        function resetExportModal() {
            selectedExportType = null;
            selectedExportFormat = null;
            document.getElementById('exportType1').classList.remove('selected');
            document.getElementById('exportType2').classList.remove('selected');
            document.getElementById('exportType3').classList.remove('selected');
            document.getElementById('exportType4').classList.remove('selected');
            document.querySelectorAll('.format-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.getElementById('formatOptions').style.display = 'none';
            document.getElementById('confirmExport').style.display = 'none';
        }

        function selectExportType(type) {
            selectedExportType = type;
            
            document.getElementById('exportType1').classList.remove('selected');
            document.getElementById('exportType2').classList.remove('selected');
            document.getElementById('exportType3').classList.remove('selected');
            document.getElementById('exportType4').classList.remove('selected');
            
            if (type === 1) {
                document.getElementById('exportType1').classList.add('selected');
            } else if (type === 2) {
                document.getElementById('exportType2').classList.add('selected');
            } else if (type === 3) {
                document.getElementById('exportType3').classList.add('selected');
            } else if (type === 4) {
                document.getElementById('exportType4').classList.add('selected');
            }
            
            if (type === 3 || type === 4) {
                document.getElementById('formatOptions').style.display = 'none';
                document.getElementById('confirmExport').style.display = 'block';
                selectedExportFormat = 'pdf';
            } else {
                document.getElementById('formatOptions').style.display = 'flex';
                document.getElementById('confirmExport').style.display = 'none';
            }
        }

        function exportData() {
            if (!selectedExportType || (selectedExportType !== 3 && selectedExportType !== 4 && !selectedExportFormat)) {
                alert('Veuillez s√©lectionner un type et un format d\'exportation');
                return;
            }
            
            document.getElementById('exportModal').style.display = 'none';
            
            if (selectedExportType === 3) {
                if (sheetData.length === 0) {
                    alert('Aucune donn√©e √† exporter');
                    return;
                }
                
                exportFiches(sheetData, 'fiches_hebergements_completes');
                
            } else if (selectedExportType === 4) {
                generateTableauData();
                exportTableauPDF();
            } else {
                let exportData = [];
                let filename = '';
                let mimeType = '';
                let content = '';
                
                if (selectedExportType === 1) {
                    filename = 'liste_coordonnees_hebergeurs';
                    
                    const exportHeaders = ['Nom', 'Email', 'T√©l√©phone', 'Facebook', 'Adresse', 'Lieu', 'Pays', 'Type', 'Date D√©but', 'Date Fin'];
                    
                    const uniqueHebergeurs = new Map();
                    
                    sheetData.forEach((row, index) => {
                        const nom = colNom !== -1 ? row[colNom] : '';
                        const email = colEmail !== -1 ? row[colEmail] : '';
                        const telephone = colTelephone !== -1 ? row[colTelephone] : '';
                        const facebook = colFacebook !== -1 ? row[colFacebook] : '';
                        const adresse = colAdresse !== -1 ? row[colAdresse] : '';
                        const lieu = colLieu !== -1 ? row[colLieu] : '';
                        const pays = colPays !== -1 ? row[colPays] : '';
                        const type = colHebergeEn !== -1 ? row[colHebergeEn] : '';
                        const dateDebut = colDateDebut !== -1 ? row[colDateDebut] : '';
                        const dateFin = colDateFin !== -1 ? row[colDateFin] : '';
                        
                        if (nom && nom.trim()) {
                            const key = nom.trim().toLowerCase();
                            if (!uniqueHebergeurs.has(key)) {
                                uniqueHebergeurs.set(key, {
                                    nom: nom.trim(),
                                    email: email ? email.trim() : '',
                                    telephone: telephone ? telephone.trim() : '',
                                    facebook: facebook ? facebook.trim() : '',
                                    adresse: adresse ? adresse.trim() : '',
                                    lieu: lieu ? lieu.trim() : '',
                                    pays: pays ? pays.trim() : '',
                                    type: type ? type.trim() : '',
                                    dates: dateDebut && dateFin ? `${dateDebut} au ${dateFin}` : ''
                                });
                            }
                        }
                    });
                    
                    exportData = Array.from(uniqueHebergeurs.values());
                    
                    if (selectedExportFormat === 'csv' || selectedExportFormat === 'excel') {
                        let csvContent = exportHeaders.join(',') + '\n';
                        
                        exportData.forEach(item => {
                            const row = [
                                `"${item.nom}"`,
                                `"${item.email}"`,
                                `"${item.telephone}"`,
                                `"${item.facebook}"`,
                                `"${item.adresse}"`,
                                `"${item.lieu}"`,
                                `"${item.pays}"`,
                                `"${item.type}"`,
                                `"${item.dates}"`
                            ];
                            csvContent += row.join(',') + '\n';
                        });
                        
                        content = csvContent;
                        filename += '.csv';
                        mimeType = 'text/csv;charset=utf-8;';
                        
                    } else if (selectedExportFormat === 'pdf') {
                        createPDFExport(exportData, 'Liste avec coordonn√©es des h√©bergeurs', exportHeaders, filename);
                        return;
                    }
                    
                } else if (selectedExportType === 2) {
                    filename = 'liste_hebergeurs_par_pays';
                    
                    const hebergeursParPays = {};
                    
                    sheetData.forEach((row, index) => {
                        const nom = colNom !== -1 ? row[colNom] : '';
                        const pays = colPays !== -1 ? row[colPays] : '';
                        const email = colEmail !== -1 ? row[colEmail] : '';
                        const telephone = colTelephone !== -1 ? row[colTelephone] : '';
                        const adresse = colAdresse !== -1 ? row[colAdresse] : '';
                        const lieu = colLieu !== -1 ? row[colLieu] : '';
                        const type = colHebergeEn !== -1 ? row[colHebergeEn] : '';
                        const dateDebut = colDateDebut !== -1 ? row[colDateDebut] : '';
                        const dateFin = colDateFin !== -1 ? row[colDateFin] : '';
                        
                        if (pays && pays.trim() && nom && nom.trim()) {
                            const paysKey = pays.trim();
                            
                            if (!hebergeursParPays[paysKey]) {
                                hebergeursParPays[paysKey] = [];
                            }
                            
                            const hebergeurKey = nom.trim().toLowerCase();
                            const existeDeja = hebergeursParPays[paysKey].some(h => 
                                h.nom.toLowerCase() === hebergeurKey
                            );
                            
                            if (!existeDeja) {
                                hebergeursParPays[paysKey].push({
                                    nom: nom.trim(),
                                    email: email ? email.trim() : '',
                                    telephone: telephone ? telephone.trim() : '',
                                    adresse: adresse ? adresse.trim() : '',
                                    lieu: lieu ? lieu.trim() : '',
                                    type: type ? type.trim() : '',
                                    dates: dateDebut && dateFin ? `${dateDebut} au ${dateFin}` : ''
                                });
                            }
                        }
                    });
                    
                    if (selectedExportFormat === 'csv' || selectedExportFormat === 'excel') {
                        let csvContent = 'Pays,Nom,Email,T√©l√©phone,Adresse,Lieu,Type,Dates\n';
                        
                        Object.keys(hebergeursParPays).sort().forEach(pays => {
                            hebergeursParPays[pays].forEach(hebergeur => {
                                const row = [
                                    `"${pays}"`,
                                    `"${hebergeur.nom}"`,
                                    `"${hebergeur.email}"`,
                                    `"${hebergeur.telephone}"`,
                                    `"${hebergeur.adresse}"`,
                                    `"${hebergeur.lieu}"`,
                                    `"${hebergeur.type}"`,
                                    `"${hebergeur.dates}"`
                                ];
                                csvContent += row.join(',') + '\n';
                            });
                        });
                        
                        content = csvContent;
                        filename += '.csv';
                        mimeType = 'text/csv;charset=utf-8;';
                        
                    } else if (selectedExportFormat === 'pdf') {
                        createPDFByCountryExport(hebergeursParPays, filename);
                        return;
                    }
                }
                
                downloadFile(content, filename, mimeType);
            }
            
            resetExportModal();
        }
        
        function exportFiches(rows, baseFilename) {
            if (rows.length === 0) {
                alert('Aucune fiche √† exporter');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            let pdfContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Fiches d'h√©bergement - Tourn√©e 2026</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #8b0000; text-align: center; margin-bottom: 30px; }
                        .fiche-container { margin-bottom: 40px; page-break-inside: avoid; border: 1px solid #ddd; padding: 20px; border-radius: 10px; }
                        .fiche-header { background: #6c757d; color: white; padding: 15px; border-radius: 5px; margin-bottom: 15px; position: relative; }
                        .fiche-title { color: white; font-size: 1.2em; margin: 0; }
                        .fiche-pays { position: absolute; top: 15px; right: 15px; background: rgba(255, 255, 255, 0.2); padding: 5px 10px; border-radius: 20px; font-size: 0.9em; color: white; }
                        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
                        .info-item { padding: 10px; background: #f8f9fa; border-radius: 5px; }
                        .info-label { font-weight: bold; color: #8b0000; font-size: 0.9em; margin-bottom: 5px; }
                        .info-value { color: #2c3e50; }
                        .hote-section { background: #e8f5e8; padding: 15px; border-radius: 5px; margin-bottom: 15px; }
                        .hote-name { font-size: 1.5em; color: #27ae60; font-weight: bold; margin-top: 5px; }
                        .localisation-section { background: #d4edda; padding: 15px; border-radius: 5px; margin-bottom: 15px; }
                        .localisation-label { font-weight: bold; color: #27ae60; font-size: 1.1em; margin-bottom: 5px; }
                        .localisation-content { color: #2c3e50; font-size: 1.2em; font-weight: bold; }
                        .section { margin-bottom: 15px; padding: 15px; border-left: 4px solid #3498db; background: #f8f9fa; border-radius: 5px; }
                        .section-title { font-weight: bold; color: #2c3e50; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
                        .type-section { border-left-color: #2196F3; background: #e3f2fd; }
                        .type-title { color: #0d47a1; }
                        .observations-section { border-left-color: #ff9800; background: #fff8e1; }
                        .observations-title { color: #e65100; }
                        .photo-section { border-left-color: #9b59b6; background: #f5e8f8; }
                        .photo-title { color: #8e44ad; }
                        @media print {
                            .fiche-container { page-break-inside: avoid; }
                            body { margin: 10px; }
                        }
                    </style>
                </head>
                <body>
                    <h1>üìÑ Fiches d'h√©bergement - Tourn√©e 2026</h1>
                    <p style="text-align: center; margin-bottom: 30px; color: #666;">
                        Export g√©n√©r√© le ${new Date().toLocaleDateString('fr-FR')} - ${rows.length} fiche(s)
                    </p>
            `;
            
            rows.forEach((row, index) => {
                const dateDebut = colDateDebut !== -1 ? row[colDateDebut] : '';
                const dateFin = colDateFin !== -1 ? row[colDateFin] : '';
                const nom = colNom !== -1 ? row[colNom] : '';
                const pays = colPays !== -1 ? row[colPays] : '';
                const lieu = colLieu !== -1 ? row[colLieu] : '';
                const adresse = colAdresse !== -1 ? row[colAdresse] : '';
                const email = colEmail !== -1 ? row[colEmail] : '';
                const facebook = colFacebook !== -1 ? row[colFacebook] : '';
                const telephone = colTelephone !== -1 ? row[colTelephone] : '';
                const mpihiraLehilahy = colMpihiraLehilahy !== -1 ? row[colMpihiraLehilahy] : '';
                const mpitendry = colMpitendry !== -1 ? row[colMpitendry] : '';
                const feo1 = colFeo1 !== -1 ? row[colFeo1] : '';
                const feo2 = colFeo2 !== -1 ? row[colFeo2] : '';
                const priere = colPriere !== -1 ? row[colPriere] : '';
                const marquants = colMarquants !== -1 ? row[colMarquants] : '';
                const photosHotes = colPhotosHotes !== -1 ? row[colPhotosHotes] : '';
                const photosLieux = colPhotosLieux !== -1 ? row[colPhotosLieux] : '';
                const formulaire = colFormulaire !== -1 ? row[colFormulaire] : '';
                const repartition = colRepartition !== -1 ? row[colRepartition] : '';
                const type = colHebergeEn !== -1 ? row[colHebergeEn] : '';
                const observations = colObservations !== -1 ? row[colObservations] : '';
                
                const adresseHebergeur = colAdresseHebergeur !== -1 ? row[colAdresseHebergeur] : '';
                const lieuHebergeur = colLieuHebergeur !== -1 ? row[colLieuHebergeur] : '';
                const paysHebergeur = colPaysHebergeur !== -1 ? row[colPaysHebergeur] : '';
                const numeroHebergeur = colNumeroHebergeur !== -1 ? row[colNumeroHebergeur] : '';
                
                const aSavoirHote = colASavoirHote !== -1 ? row[colASavoirHote] : '';
                
                let adresseComplete = adresseHebergeur || adresse || '';
                if (adresseComplete && lieuHebergeur) {
                    adresseComplete += ` - ${lieuHebergeur}`;
                }
                if (adresseComplete && paysHebergeur) {
                    adresseComplete += ` / ${paysHebergeur}`;
                }
                
                let toutesPersonnes = [];
                const colonnesPersonnes = [
                    {data: mpihiraLehilahy, type: 'Mpihira Lehilahy'},
                    {data: mpitendry, type: 'Mpitendry'},
                    {data: feo1, type: 'Feo 1'},
                    {data: feo2, type: 'Feo 2'}
                ];
                
                colonnesPersonnes.forEach(col => {
                    if (col.data && col.data.trim()) {
                        col.data.split(',').forEach(p => {
                            const trimmed = p.trim();
                            if (trimmed) toutesPersonnes.push(trimmed);
                        });
                    }
                });
                
                let personnesAffichees = '';
                let personnesPourTags = [];
                
                if (repartition && repartition.trim()) {
                    if (repartition.toLowerCase().includes('tout le monde')) {
                        personnesPourTags = Array.from(allHeberges);
                        personnesAffichees = `Tout le monde / ${personnesPourTags.join(', ')}`;
                    } else {
                        personnesPourTags = toutesPersonnes;
                        personnesAffichees = `${repartition} / ${toutesPersonnes.join(', ')}`;
                    }
                } else {
                    personnesPourTags = toutesPersonnes;
                    personnesAffichees = toutesPersonnes.join(', ');
                }
                
                const titreFiche = `${dateDebut || '?'} - ${dateFin || '?'} / ${personnesPourTags.length > 0 ? personnesPourTags.join(', ') : 'Aucun h√©berg√©'}`;
                
                pdfContent += `
                    <div class="fiche-container">
                        <div class="fiche-header">
                            <h2 class="fiche-title">üè® H√©bergement Tourn√©e 2026 - Fiche ${index + 1}</h2>
                            <div class="fiche-pays">${pays || ''}</div>
                            <div style="color: #e0e0e0; margin-top: 5px;">${titreFiche}</div>
                        </div>
                        
                        <div class="hote-section">
                            <div style="font-weight: bold; color: #27ae60;">üë§ H√©berg√© chez :</div>
                            <div class="hote-name">${nom || 'H√¥te non sp√©cifi√©'}</div>
                        </div>
                        
                        <div class="localisation-section">
                            <div class="localisation-label">üìç Localisation :</div>
                            <div class="localisation-content">${lieu || 'Non sp√©cifi√©'}, ${pays || 'Non sp√©cifi√©'}</div>
                        </div>
                        
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label">üìÖ Dates:</div>
                                <div class="info-value">${dateDebut || 'Non sp√©cifi√©e'} - ${dateFin || 'Non sp√©cifi√©e'}</div>
                            </div>
                        </div>
                        
                        ${type ? `
                        <div class="section type-section">
                            <div class="section-title type-title">üè† H√©berg√© en:</div>
                            <div>${type}</div>
                        </div>
                        ` : ''}
                        
                        ${personnesPourTags.length > 0 ? `
                        <div class="section" style="border-left-color: #ffc107;">
                            <div class="section-title">üë• Les h√©berg√©s:</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 5px; margin-top: 10px;">
                                ${personnesPourTags.map(p => `<span style="background: #ffc107; color: #856404; padding: 4px 8px; border-radius: 12px; font-size: 0.9em;">${p}</span>`).join('')}
                            </div>
                            <div style="margin-top: 10px; font-style: italic; color: #666;">
                                ${personnesAffichees}
                            </div>
                        </div>
                        ` : ''}
                        
                        ${(adresseComplete || email || facebook || telephone || numeroHebergeur) ? `
                        <div class="section" style="border-left-color: #3498db;">
                            <div class="section-title">üìû Information de contact:</div>
                            ${adresseComplete ? `<div style="margin-bottom: 8px;"><strong>üìç Adresse:</strong> ${adresseComplete}</div>` : ''}
                            ${numeroHebergeur ? `<div style="margin-bottom: 8px;"><strong>üî¢ Num√©ro:</strong> ${numeroHebergeur}</div>` : ''}
                            ${email ? `<div style="margin-bottom: 8px;"><strong>üìß Email:</strong> ${email}</div>` : ''}
                            ${facebook ? `<div style="margin-bottom: 8px;"><strong>üë• R√©seaux sociaux:</strong> ${facebook}</div>` : ''}
                            ${telephone ? `<div style="margin-bottom: 8px;"><strong>üì± T√©l√©phone:</strong> <a href="tel:${telephone}">${telephone}</a></div>` : ''}
                        </div>
                        ` : ''}
                        
                        ${aSavoirHote ? `
                        <div class="section" style="border-left-color: #e65100;">
                            <div class="section-title">‚ÑπÔ∏è √Ä savoir sur le h√¥te:</div>
                            <div>${aSavoirHote}</div>
                        </div>
                        ` : ''}
                        
                        ${marquants ? `
                        <div class="section" style="border-left-color: #9b59b6;">
                            <div class="section-title">‚≠ê Marquants:</div>
                            <div>${marquants}</div>
                        </div>
                        ` : ''}
                        
                        ${priere ? `
                        <div class="section" style="border-left-color: #e74c3c;">
                            <div class="section-title">üôè Sujet de pri√®re:</div>
                            <div>${priere}</div>
                        </div>
                        ` : ''}
                        
                        ${observations ? `
                        <div class="section observations-section">
                            <div class="section-title observations-title">üìù Observations:</div>
                            <div>${observations}</div>
                        </div>
                        ` : ''}
                        
                        ${(photosHotes || photosLieux || formulaire) ? `
                        <div class="section photo-section">
                            <div class="section-title photo-title">üîó Liens et photos:</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
                                ${photosHotes ? `<span style="background: #9b59b6; color: white; padding: 8px 12px; border-radius: 5px; font-size: 0.9em;">üì∏ Photos avec h√¥tes</span>` : ''}
                                ${photosLieux ? `<span style="background: #e74c3c; color: white; padding: 8px 12px; border-radius: 5px; font-size: 0.9em;">üèûÔ∏è Photos des lieux</span>` : ''}
                                ${formulaire ? `<span style="background: #27ae60; color: white; padding: 8px 12px; border-radius: 5px; font-size: 0.9em;">üîó Formulaire</span>` : ''}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
            });
            
            pdfContent += `</body></html>`;
            
            printWindow.document.write(pdfContent);
            printWindow.document.close();
            printWindow.print();
        }
        
        function createPDFExport(data, title, headers, filename) {
            const printWindow = window.open('', '_blank');
            let pdfContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${title} - Tourn√©e 2026</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #8b0000; text-align: center; margin-bottom: 30px; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th { background-color: #8b0000; color: white; padding: 12px; text-align: left; }
                        td { padding: 10px; border: 1px solid #ddd; }
                        tr:nth-child(even) { background-color: #f9f9f9; }
                    </style>
                </head>
                <body>
                    <h1>${title} - Tourn√©e 2026</h1>
                    <p>Export g√©n√©r√© le ${new Date().toLocaleDateString('fr-FR')}</p>
                    <table>
                        <thead>
                            <tr>
                                ${headers.map(header => `<th>${header}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            ${data.map(item => `
                                <tr>
                                    <td>${item.nom}</td>
                                    <td>${item.email}</td>
                                    <td>${item.telephone}</td>
                                    <td>${item.facebook}</td>
                                    <td>${item.adresse}</td>
                                    <td>${item.lieu}</td>
                                    <td>${item.pays}</td>
                                    <td>${item.type}</td>
                                    <td>${item.dates}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </body>
                </html>
            `;
            
            printWindow.document.write(pdfContent);
            printWindow.document.close();
            printWindow.print();
        }
        
        function createPDFByCountryExport(hebergeursParPays, filename) {
            const printWindow = window.open('', '_blank');
            let pdfContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Liste des h√©bergeurs par pays - Tourn√©e 2026</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #8b0000; text-align: center; margin-bottom: 30px; }
                        h2 { color: #2c3e50; margin-top: 30px; padding-bottom: 10px; border-bottom: 2px solid #3498db; }
                        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
                        th { background-color: #27ae60; color: white; padding: 12px; text-align: left; }
                        td { padding: 10px; border: 1px solid #ddd; }
                        tr:nth-child(even) { background-color: #f9f9f9; }
                        .country-section { margin-bottom: 40px; }
                        .type { background: #2196F3; color: white; padding: 2px 6px; border-radius: 5px; font-size: 0.9em; }
                    </style>
                </head>
                <body>
                    <h1>üåç Liste des h√©bergeurs par pays - Tourn√©e 2026</h1>
                    <p>Export g√©n√©r√© le ${new Date().toLocaleDateString('fr-FR')}</p>
            `;
            
            Object.keys(hebergeursParPays).sort().forEach(pays => {
                pdfContent += `
                    <div class="country-section">
                        <h2>${pays}</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Nom</th>
                                    <th>Email</th>
                                    <th>T√©l√©phone</th>
                                    <th>Adresse</th>
                                    <th>Lieu</th>
                                    <th>Type</th>
                                    <th>Dates</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${hebergeursParPays[pays].map(hebergeur => `
                                    <tr>
                                        <td>${hebergeur.nom}</td>
                                        <td>${hebergeur.email}</td>
                                        <td>${hebergeur.telephone}</td>
                                        <td>${hebergeur.adresse}</td>
                                        <td>${hebergeur.lieu}</td>
                                        <td><span class="type">${hebergeur.type}</span></td>
                                        <td>${hebergeur.dates}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            });
            
            pdfContent += `</body></html>`;
            
            printWindow.document.write(pdfContent);
            printWindow.document.close();
            printWindow.print();
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.setAttribute('download', filename);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert(`Fichier ${filename} t√©l√©charg√© avec succ√®s!`);
        }

        function handlePhotoUpload(event) {
            const files = event.target.files;
            if (files.length === 0) return;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                if (file.size > 5 * 1024 * 1024) {
                    alert(`La photo "${file.name}" est trop volumineuse. Maximum 5MB.`);
                    continue;
                }
                
                if (!file.type.startsWith('image/')) {
                    alert(`Le fichier "${file.name}" n'est pas une image valide.`);
                    continue;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const photoData = {
                        name: file.name,
                        size: formatFileSize(file.size),
                        data: e.target.result,
                        type: file.type
                    };
                    
                    uploadedPhotos.push(photoData);
                    renderPhotoPreview();
                };
                
                reader.readAsDataURL(file);
            }
            
            event.target.value = '';
        }

        function renderPhotoPreview() {
            const previewContainer = document.getElementById('photosPreview');
            previewContainer.innerHTML = '';
            
            if (uploadedPhotos.length === 0) {
                previewContainer.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">Aucune photo s√©lectionn√©e</div>';
                return;
            }
            
            uploadedPhotos.forEach((photo, index) => {
                const photoElement = document.createElement('div');
                photoElement.className = 'photo-preview';
                photoElement.innerHTML = `
                    <img src="${photo.data}" alt="${photo.name}">
                    <button class="remove-photo" onclick="removePhoto(${index})">√ó</button>
                    <div class="photo-info">${photo.name}<br>${photo.size}</div>
                `;
                previewContainer.appendChild(photoElement);
            });
        }

        function removePhoto(index) {
            uploadedPhotos.splice(index, 1);
            renderPhotoPreview();
        }

        function clearUploadedPhotos() {
            uploadedPhotos = [];
            renderPhotoPreview();
            document.getElementById('photoUpload').value = '';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function showEmailModal() {
            if (sheetData.length === 0) {
                alert('Aucune donn√©e charg√©e');
                return;
            }
            
            const modal = document.getElementById('emailModal');
            const recipientsContainer = document.getElementById('emailRecipients');
            const recipientCount = document.getElementById('recipientCount');
            
            const hotesAvecEmail = sheetData.filter(row => {
                const email = colEmail !== -1 ? row[colEmail] : '';
                const nom = colNom !== -1 ? row[colNom] : '';
                return email && email.trim() && nom && nom.trim();
            });
            
            const uniqueHotes = [];
            const emailsDejaVus = new Set();
            
            hotesAvecEmail.forEach(hote => {
                const email = hote[colEmail].trim().toLowerCase();
                if (!emailsDejaVus.has(email)) {
                    emailsDejaVus.add(email);
                    uniqueHotes.push(hote);
                }
            });
            
            recipientsContainer.innerHTML = '';
            uniqueHotes.forEach((hote, index) => {
                const recipientDiv = document.createElement('div');
                recipientDiv.className = 'recipient-item';
                recipientDiv.innerHTML = `
                    <input type="checkbox" class="recipient-checkbox" data-index="${index}" checked style="margin-right: 10px;">
                    <div>
                        <strong>${hote[colNom]}</strong><br>
                        <small style="color: #666;">${hote[colEmail]}</small>
                    </div>
                `;
                recipientsContainer.appendChild(recipientDiv);
            });
            
            recipientCount.textContent = uniqueHotes.length;
            modal.style.display = 'flex';
        }

        function sendEmails() {
            const checkboxes = document.querySelectorAll('.recipient-checkbox:checked');
            const subject = document.getElementById('emailSubject').value;
            const message = document.getElementById('emailMessage').value;
            
            if (checkboxes.length === 0) {
                alert('Veuillez s√©lectionner au moins un destinataire');
                return;
            }
            
            const emails = [];
            checkboxes.forEach(checkbox => {
                const index = parseInt(checkbox.getAttribute('data-index'));
                const hote = sheetData.filter(row => {
                    const email = colEmail !== -1 ? row[colEmail] : '';
                    const nom = colNom !== -1 ? row[colNom] : '';
                    return email && email.trim() && nom && nom.trim();
                })[index];
                
                if (hote) {
                    emails.push({
                        nom: hote[colNom],
                        email: hote[colEmail]
                    });
                }
            });
            
            let emailBody = message;
            
            if (uploadedPhotos.length > 0) {
                emailBody += '\n\n---\nüì∏ Photos jointes √† cet email :\n';
                uploadedPhotos.forEach(photo => {
                    emailBody += `‚Ä¢ ${photo.name} (${photo.size})\n`;
                });
                emailBody += '\nLes photos sont jointes √† cet email.';
            }
            
            const encodedBody = encodeURIComponent(emailBody);
            const encodedSubject = encodeURIComponent(subject);
            
            const emailRecipients = emails.map(e => e.email).join(',');
            
            const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&to=${emailRecipients}&su=${encodedSubject}&body=${encodedBody}`;
            
            window.open(gmailUrl, '_blank');
            
            if (uploadedPhotos.length > 0) {
                setTimeout(() => {
                    alert(`${emails.length} email(s) pr√©par√©(s) pour envoi.\n\nüì∏ IMPORTANT: Les photos doivent √™tre ajout√©es manuellement en pi√®ces jointes dans votre client email.\n\nPhotos √† attacher:\n${uploadedPhotos.map(p => `‚Ä¢ ${p.name}`).join('\n')}`);
                }, 1000);
            } else {
                alert(`${emails.length} email(s) pr√©par√©(s) pour envoi. V√©rifiez les destinataires avant d'envoyer.`);
            }
            
            document.getElementById('emailModal').style.display = 'none';
            clearUploadedPhotos();
        }

        function copyEmailAddresses() {
            const checkboxes = document.querySelectorAll('.recipient-checkbox:checked');
            const emails = [];
            
            checkboxes.forEach(checkbox => {
                const index = parseInt(checkbox.getAttribute('data-index'));
                const hote = sheetData.filter(row => {
                    const email = colEmail !== -1 ? row[colEmail] : '';
                    const nom = colNom !== -1 ? row[colNom] : '';
                    return email && email.trim() && nom && nom.trim();
                })[index];
                
                if (hote) {
                    emails.push(hote[colEmail]);
                }
            });
            
            if (emails.length === 0) {
                alert('Aucun email √† copier');
                return;
            }
            
            const emailString = emails.join('; ');
            navigator.clipboard.writeText(emailString).then(() => {
                alert(`${emails.length} adresse(s) email copi√©e(s) dans le presse-papier`);
            }).catch(err => {
                console.error('Erreur lors de la copie:', err);
                const textArea = document.createElement('textarea');
                textArea.value = emailString;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert(`${emails.length} adresse(s) email copi√©e(s) dans le presse-papier`);
            });
        }
    </script>
</body>
</html>
