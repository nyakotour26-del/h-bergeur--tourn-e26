<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H√©bergements Tourn√©e 2026</title>
    <style>
        :root {
            --primary-color: #8b0000;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --text-color: #2c3e50;
            --border-radius: 8px;
            --box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            --orange-color: #ff6b35;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #f5f7fa;
            padding: 20px;
            background-image: linear-gradient(rgba(245, 247, 250, 0.9), rgba(245, 247, 250, 0.9)), 
                              url('https://images.unsplash.com/photo-1513584684374-8bab748fbf90?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 45% 1fr; /* Sidebar gauche √©largie √† 45% */
            gap: 20px;
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* Header am√©lior√© avec fond photo clair */
        header {
            grid-column: 1 / -1;
            text-align: center;
            margin-bottom: 20px;
            padding: 15px 20px;
            background: linear-gradient(rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.98)), 
                        url('https://images.unsplash.com/photo-1512917774080-9991f1c4c750?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80');
            background-size: cover;
            background-position: center;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            color: var(--text-color);
            position: sticky;
            top: 20px;
            z-index: 100;
            border-bottom: 3px solid var(--primary-color);
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .header-content {
            position: relative;
            z-index: 2;
        }
        
        .decoration-images {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 10px;
            font-size: 1.5em;
            opacity: 0.6;
        }
        
        .decoration-images-left {
            position: absolute;
            top: 10px;
            left: 20px;
            display: flex;
            gap: 10px;
            font-size: 1.5em;
            opacity: 0.6;
        }
        
        h1 {
            margin-bottom: 5px;
            font-size: 2em;
            font-weight: 600;
            color: var(--primary-color);
            letter-spacing: 0.5px;
            line-height: 1.2;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
        }
        
        header p {
            font-size: 1em;
            opacity: 0.9;
            margin-bottom: 10px;
            color: var(--secondary-color);
            line-height: 1.3;
        }
        
        /* Boutons de navigation fixes - MODIFI√â avec bouton calendrier */
        .fixed-nav-buttons {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }
        
        .icon-button {
            background: rgba(44, 62, 80, 0.9);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            font-size: 24px;
        }
        
        .icon-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }
        
        .icon-button.home {
            background: rgba(39, 174, 96, 0.9);
        }
        
        .icon-button.calendar {
            background: rgba(231, 76, 60, 0.9);
        }
        
        .icon-button.list {
            background: rgba(52, 152, 219, 0.9);
        }
        
        .icon-button.export {
            background: rgba(155, 89, 182, 0.9);
            position: relative;
        }
        
        .icon-button.export.locked {
            background: rgba(149, 165, 166, 0.9);
            cursor: not-allowed;
        }
        
        .icon-button.export.locked:hover {
            transform: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        /* Barre de recherche dans le header */
        .header-search {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .date-search-input {
            padding: 8px 12px;
            font-size: 14px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            transition: border-color 0.3s;
            flex: 1;
            max-width: 200px;
        }
        
        .date-search-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .search-loupe {
            background: linear-gradient(135deg, var(--primary-color), #6a0000);
            color: white;
            border: none;
            padding: 10px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(139, 0, 0, 0.2);
        }
        
        .search-loupe:hover {
            background: linear-gradient(135deg, #6a0000, var(--primary-color));
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(139, 0, 0, 0.3);
        }
        
        .search-section {
            background-color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            position: relative;
            background-image: linear-gradient(to bottom right, rgba(255,255,255,0.95), rgba(255,255,255,0.98));
        }
        
        .search-section::before {
            content: "";
            position: absolute;
            top: 10px;
            right: 10px;
            width: 50px;
            height: 50px;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%238b0000"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>');
            opacity: 0.1;
        }
        
        .search-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .date-input-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .date-input-container input {
            flex: 1;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            transition: border-color 0.3s;
        }
        
        .date-input-container input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .search-button {
            background: linear-gradient(135deg, var(--primary-color), #6a0000);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(139, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .search-button:hover {
            background: linear-gradient(135deg, #6a0000, var(--primary-color));
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(139, 0, 0, 0.3);
        }
        
        .search-button.disabled {
            background: #95a5a6;
            cursor: not-allowed;
            opacity: 0.6;
            box-shadow: none;
        }
        
        .search-button.disabled:hover {
            background: #95a5a6;
            transform: none;
            box-shadow: none;
        }
        
        /* Boutons align√©s sur une m√™me ligne - MODIFI√â pour mobile */
        .buttons-row {
            display: flex;
            flex-direction: row;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .buttons-row .search-button {
            flex: 1;
            min-width: 200px;
        }
        
        /* Calendrier √† droite avec le mois en cours */
        .calendar-section {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
        }
        
        .calendar-section::before {
            content: "";
            position: absolute;
            top: -50px;
            right: -50px;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(139,0,0,0.1) 0%, transparent 70%);
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .calendar-nav {
            display: flex;
            gap: 10px;
        }
        
        .calendar-nav button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .calendar-nav button:hover {
            background: #6a0000;
            transform: scale(1.05);
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            padding: 10px;
            background-color: var(--light-color);
            border-radius: 4px;
            color: var(--secondary-color);
        }
        
        .calendar-day {
            text-align: center;
            padding: 12px;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.2s;
            border: 1px solid #f0f0f0;
            position: relative;
            min-height: 60px;
            font-size: 14px;
        }
        
        .calendar-day:hover {
            background-color: #f8f9fa;
        }
        
        .calendar-day.has-data {
            background-color: #e8f4fd;
            font-weight: bold;
        }
        
        .calendar-day.selected {
            background-color: var(--primary-color);
            color: white;
        }
        
        .calendar-day.other-month {
            background-color: #f9f9f9;
            color: #aaa;
        }
        
        .calendar-day.booking-period {
            background-color: #fff3cd;
            border: 2px solid #ffc107;
        }
        
        .calendar-day.booking-period::after {
            content: 'üè®';
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 12px;
        }
        
        .calendar-day.today {
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
            border: 2px solid #388E3C;
        }
        
        /* Statistiques 3 par ligne */
        .stats-section {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, white, #f8f9fa);
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
            border: 1px solid #e9ecef;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.8em;
        }
        
        .lists-section {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow-y: auto;
            max-height: 500px;
        }
        
        .lists-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .list-card {
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .list-header {
            background: #3498db;
            color: white;
            padding: 12px;
            border-radius: 5px;
            margin: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .list-header:hover {
            background: #2980b9;
        }
        
        .list-header.pays {
            background: #27ae60;
        }
        
        .list-header.pays:hover {
            background: #219653;
        }
        
        .list-header.lieux {
            background: #9b59b6;
        }
        
        .list-header.lieux:hover {
            background: #8e44ad;
        }
        
        .list-header.heberges {
            background: #f39c12;
        }
        
        .list-header.heberges:hover {
            background: #d35400;
        }
        
        .toggle-icon {
            font-weight: bold;
            font-size: 1.2em;
            transition: transform 0.3s;
        }
        
        .toggle-icon.collapsed {
            transform: rotate(-90deg);
        }
        
        .list-content {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e1e1e1;
            border-top: none;
            padding: 10px;
            transition: max-height 0.3s ease, padding 0.3s ease, border 0.3s ease;
        }
        
        .list-content.collapsed {
            max-height: 0;
            padding: 0;
            border: none;
            overflow: hidden;
        }
        
        .list-item {
            padding: 8px 12px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s;
        }
        
        .list-item:hover {
            background-color: #f8f9fa;
        }
        
        .list-count {
            background: #ecf0f1;
            color: #7f8c8d;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
        }
        
        /* Filtres 2 par 2 - MODIFI√â */
        .filters-section {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2 par ligne */
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .filter-group {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: var(--border-radius);
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
        }
        
        .filter-group:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .filter-group h3 {
            margin-bottom: 10px;
            color: var(--secondary-color);
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            max-height: 120px;
            overflow-y: auto;
        }
        
        .tag {
            background: var(--primary-color);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tag:hover {
            background: #6a0000;
            transform: translateY(-2px);
        }
        
        .tag.nom {
            background: #3498db;
        }
        
        .tag.nom:hover {
            background: #2980b9;
        }
        
        .tag.pays {
            background: #27ae60;
        }
        
        .tag.pays:hover {
            background: #219653;
        }
        
        .tag.lieu {
            background: #9b59b6;
        }
        
        .tag.lieu:hover {
            background: #8e44ad;
        }
        
        .tag.priere {
            background: #e74c3c;
        }
        
        .tag.priere:hover {
            background: #c0392b;
        }
        
        .tag.heberge {
            background: #f39c12;
        }
        
        .tag.heberge:hover {
            background: #d35400;
        }
        
        .results-section {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            margin-top: 0;
        }
        
        .result-header {
            background-color: var(--secondary-color);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .result-content {
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .fiche-item {
            margin-bottom: 40px;
            border: 1px solid #e1e1e1;
            border-radius: var(--border-radius);
            overflow: hidden;
            background: #f8f9fa;
        }
        
        .fiche-header {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            padding: 20px;
        }
        
        .fiche-title {
            color: white;
            font-weight: bold;
            margin-top: 0;
            font-size: 1.4em;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .info-item {
            padding: 15px;
            border-right: 1px solid #e9ecef;
        }
        
        .info-item:last-child {
            border-right: none;
        }
        
        .info-label {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 0.9em;
            margin-bottom: 5px;
            display: block;
        }
        
        .info-value {
            color: var(--text-color);
            font-size: 1.1em;
        }
        
        .hote-section {
            padding: 20px;
            background: linear-gradient(135deg, #f8fff8, #e8f5e8);
            border-bottom: 1px solid #d4edda;
            text-align: left;
        }
        
        .hote-label {
            font-weight: bold;
            color: #27ae60;
            font-size: 1em;
            margin-bottom: 10px;
            display: block;
        }
        
        .hote-name {
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Marker Felt', cursive;
            font-size: 2.2em;
            color: #27ae60;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            line-height: 1.2;
        }
        
        .links-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            padding: 15px;
            background: #e8f4fd;
            border-bottom: 1px solid #b3d9ff;
        }
        
        .link-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            text-align: center;
            text-decoration: none;
            display: block;
            transition: all 0.3s;
        }
        
        .link-button:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .link-button.photos-hotes {
            background: #9b59b6;
        }
        
        .link-button.photos-hotes:hover {
            background: #8e44ad;
        }
        
        .link-button.photos-lieux {
            background: #e74c3c;
        }
        
        .link-button.photos-lieux:hover {
            background: #c0392b;
        }
        
        .link-button.formulaire {
            background: #27ae60;
        }
        
        .link-button.formulaire:hover {
            background: #219653;
        }
        
        .heberges-list {
            margin-top: 15px;
            padding: 15px;
            background: #fff3cd;
            border-radius: var(--border-radius);
            border-left: 4px solid #ffc107;
        }
        
        .heberges-label {
            font-weight: bold;
            color: var(--orange-color);
            font-size: 1em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .heberges-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .heberge-tag {
            background: #ffc107;
            color: #856404;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .heberge-tag:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .marquants-section {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: var(--border-radius);
            border-left: 4px solid #9b59b6;
        }
        
        .marquants-label {
            font-weight: bold;
            color: #9b59b6;
            font-size: 1em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .marquants-content {
            color: var(--text-color);
            line-height: 1.5;
        }
        
        .priere-section {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: var(--border-radius);
            border-left: 4px solid #e74c3c;
        }
        
        .priere-label {
            font-weight: bold;
            color: #e74c3c;
            font-size: 1em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .priere-content {
            color: var(--text-color);
            font-style: italic;
            line-height: 1.5;
            white-space: pre-wrap;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            text-align: left;
            padding: 12px;
            width: 20%;
            background: var(--light-color);
            color: var(--primary-color);
            font-weight: bold;
            font-size: 14px;
            vertical-align: top;
            white-space: normal;
            word-wrap: break-word;
            border-bottom: 1px solid #ddd;
        }
        
        .data-table td {
            padding: 12px;
            font-size: 15px;
            color: var(--text-color);
            white-space: pre-wrap;
            border-bottom: 1px solid #ddd;
        }
        
        .data-table tr:nth-child(even) td {
            background: #f9f9f9;
        }
        
        .data-table img {
            max-width: 95%;
            max-height: 250px;
            display: block;
            margin: 5px auto;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .data-table a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: bold;
        }
        
        .data-table a:hover {
            text-decoration: underline;
        }
        
        .contact-section {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: var(--border-radius);
            border-left: 4px solid #3498db;
        }
        
        .contact-label {
            font-weight: bold;
            color: var(--orange-color);
            font-size: 1em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .contact-link {
            color: #3498db;
            text-decoration: none;
            font-weight: bold;
        }
        
        .contact-link:hover {
            text-decoration: underline;
        }
        
        .loading {
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }
        
        .error-message {
            background-color: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
        }
        
        .success-message {
            background-color: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
        }
        
        /* Styles pour la modale d'export */
        .export-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .export-modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .export-options {
            margin: 20px 0;
        }
        
        .export-type {
            margin-bottom: 20px;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .export-type:hover {
            border-color: var(--primary-color);
            background: #f8f9fa;
        }
        
        .export-type.selected {
            border-color: var(--primary-color);
            background: #f8f9fa;
        }
        
        .export-type-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .export-type-description {
            font-size: 0.9em;
            color: #666;
        }
        
        .export-format-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .format-option {
            flex: 1;
            padding: 10px;
            text-align: center;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .format-option:hover {
            border-color: var(--primary-color);
        }
        
        .format-option.selected {
            border-color: var(--primary-color);
            background: #f8f9fa;
            color: var(--primary-color);
            font-weight: bold;
        }
        
        /* Styles pour la modale d'email */
        .email-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .email-modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .email-recipients {
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            background: #f9f9f9;
        }
        
        .recipient-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
        }
        
        .recipient-item:last-child {
            border-bottom: none;
        }
        
        /* Styles pour l'upload de photos */
        .upload-section {
            margin: 20px 0;
            padding: 15px;
            border: 2px dashed #3498db;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .upload-area {
            text-align: center;
            padding: 20px;
        }
        
        .upload-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        
        .upload-button:hover {
            background: #2980b9;
        }
        
        .photos-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .photo-preview {
            position: relative;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .photo-preview img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            display: block;
        }
        
        .remove-photo {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(231, 76, 60, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .photo-info {
            padding: 5px;
            background: rgba(0,0,0,0.7);
            color: white;
            font-size: 10px;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
        }
        
        .upload-instructions {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
            text-align: center;
        }

        .hote-info-section {
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #fff3e0, #ffe0b2);
            border-radius: var(--border-radius);
            border-left: 4px solid #ff9800;
        }
        
        .hote-info-label {
            font-weight: bold;
            color: #e65100;
            font-size: 1em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .hote-info-content {
            color: var(--text-color);
            line-height: 1.5;
            font-style: italic;
        }

        /* Style pour la modale de mot de passe */
        .password-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1001;
            justify-content: center;
            align-items: center;
        }
        
        .password-modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
        }
        
        .password-input {
            width: 100%;
            padding: 10px;
            margin: 15px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .password-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .data-info {
            grid-column: 1 / -1;
        }

        /* Responsive - IMPORTANT: pas d'agrandissement de largeur mobile */
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 45% 1fr; /* Garder 45% m√™me sur tablette */
            }
            
            .fixed-nav-buttons {
                flex-direction: row;
                top: 10px;
                right: 10px;
            }
            
            .icon-button {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            .buttons-row {
                flex-direction: row;
            }
            
            .buttons-row .search-button {
                min-width: 180px;
            }
            
            .filters-section {
                grid-template-columns: repeat(2, 1fr); /* Garder 2 par ligne */
            }
        }

        @media (max-width: 768px) {
            /* IMPORTANT: pas d'agrandissement de largeur mobile */
            body {
                padding: 10px; /* R√©duire le padding */
            }
            
            .container {
                grid-template-columns: 1fr;
                max-width: 100%;
                width: 100%;
            }
            
            .sidebar {
                order: 2;
            }
            
            .main-content {
                order: 1;
            }
            
            .search-form {
                flex-direction: column;
            }
            
            /* Boutons c√¥te √† c√¥te sur mobile */
            .buttons-row {
                flex-direction: row;
                flex-wrap: nowrap;
                overflow-x: auto;
                padding-bottom: 10px;
                margin-bottom: 15px;
            }
            
            .buttons-row .search-button {
                min-width: 280px;
                flex: 0 0 auto;
                padding: 10px 15px;
                font-size: 14px;
                white-space: nowrap;
            }
            
            /* Filtres 2 par ligne sur mobile */
            .filters-section {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .filter-group {
                padding: 15px;
            }
            
            .filter-group h3 {
                font-size: 1em;
            }
            
            .tag {
                padding: 4px 8px;
                font-size: 12px;
            }
            
            .calendar-grid {
                gap: 2px;
            }
            
            .calendar-day {
                padding: 8px 4px;
                font-size: 0.9em;
                min-height: 50px;
            }
            
            h1 {
                font-size: 1.5em; /* Plus petit sur mobile */
            }
            
            header p {
                font-size: 0.9em;
            }
            
            .decoration-images,
            .decoration-images-left {
                display: none;
            }
            
            /* Navigation fixe en bas sur mobile */
            .fixed-nav-buttons {
                position: fixed;
                bottom: 10px;
                top: auto;
                right: 10px;
                flex-direction: row;
                background: rgba(255, 255, 255, 0.9);
                padding: 5px;
                border-radius: 30px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            }
            
            .icon-button {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .stat-card {
                padding: 10px;
            }
            
            .stat-value {
                font-size: 1.2em;
            }
            
            .data-table th, .data-table td {
                display: block;
                width: 100%;
            }
            
            .data-table th {
                background: var(--secondary-color);
                color: white;
                margin-top: 10px;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .info-item {
                border-right: none;
                border-bottom: 1px solid #e9ecef;
                padding: 12px 15px;
                display: flex;
                flex-direction: column;
            }
            
            .info-item:nth-child(1),
            .info-item:nth-child(2) {
                display: inline-block;
                width: 50%;
                vertical-align: top;
                border-right: 1px solid #e9ecef;
                border-bottom: none;
            }
            
            .info-item:nth-child(1) {
                border-bottom: 1px solid #e9ecef;
            }
            
            .info-item:nth-child(2) {
                border-left: 1px solid #e9ecef;
                border-bottom: 1px solid #e9ecef;
            }
            
            .info-item:nth-child(3),
            .info-item:nth-child(4) {
                display: inline-block;
                width: 50%;
                vertical-align: top;
                border-right: 1px solid #e9ecef;
            }
            
            .info-item:nth-child(3) {
                border-bottom: none;
            }
            
            .info-item:nth-child(4) {
                border-left: 1px solid #e9ecef;
                border-bottom: none;
            }
            
            .info-item:nth-child(2),
            .info-item:nth-child(4) {
                border-right: none;
            }
            
            .info-grid-mobile {
                display: grid;
                grid-template-columns: 1fr 1fr;
                grid-template-rows: 1fr 1fr;
                gap: 0;
            }
            
            .info-grid-mobile .info-item {
                border: none;
                border-right: 1px solid #e9ecef;
                border-bottom: 1px solid #e9ecef;
            }
            
            .info-grid-mobile .info-item:nth-child(2n) {
                border-right: none;
            }
            
            .info-grid-mobile .info-item:nth-child(3),
            .info-grid-mobile .info-item:nth-child(4) {
                border-bottom: none;
            }
            
            .hote-name {
                font-size: 1.5em;
            }
            
            .links-section {
                grid-template-columns: 1fr;
            }
            
            .lists-container {
                grid-template-columns: 1fr;
            }
            
            .email-modal-content,
            .password-modal-content,
            .export-modal-content {
                padding: 15px;
                width: 95%;
                margin: 10px;
            }
            
            .photos-preview {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
            
            .photo-preview img {
                height: 80px;
            }
            
            .export-format-options {
                flex-direction: column;
            }
            
            /* Header avec recherche int√©gr√©e */
            .header-search {
                flex-direction: row;
                margin-top: 8px;
            }
            
            .date-search-input {
                max-width: 150px;
                padding: 6px 10px;
                font-size: 13px;
            }
            
            .search-loupe {
                width: 40px;
                height: 40px;
                padding: 8px;
            }
        }

        @media (max-width: 480px) {
            .buttons-row .search-button {
                min-width: 250px;
                font-size: 13px;
                padding: 8px 12px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }
            
            .stat-card {
                padding: 8px;
            }
            
            .stat-value {
                font-size: 1em;
            }
            
            .stat-label {
                font-size: 0.7em;
            }
            
            .filters-section {
                grid-template-columns: 1fr; /* 1 par ligne sur tr√®s petit mobile */
                gap: 8px;
            }
            
            .filter-group {
                padding: 12px;
            }
            
            .header-search {
                flex-direction: column;
                gap: 8px;
            }
            
            .date-search-input {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Boutons de navigation fixes - MODIFI√â avec bouton calendrier -->
    <div class="fixed-nav-buttons">
        <button class="icon-button home" id="homeButton" title="Accueil">
            üè†
        </button>
        <button class="icon-button calendar" id="calendarButton" title="Calendrier">
            üìÖ
        </button>
        <button class="icon-button list" id="showAllDataButton" title="Toutes les donn√©es">
            üìã
        </button>
        <button class="icon-button export locked" id="exportDataButton" title="Exporter les donn√©es (verrouill√©)">
            üì§
        </button>
    </div>

    <div class="container">
        <header>
            <div class="decoration-images-left">
                <span>üèòÔ∏è</span>
                <span>üè†</span>
                <span>üè®</span>
            </div>
            <div class="decoration-images">
                <span>üõå</span>
                <span>üè°</span>
                <span>üö™</span>
            </div>
            <div class="header-content">
                <h1>H√©bergements Tourn√©e 2026</h1>
                <p>Consultation des h√©bergements par date et par h√¥te</p>
                
                <!-- Barre de recherche dans le header -->
                <div class="header-search">
                    <input type="date" id="headerDateInput" class="date-search-input">
                    <button class="search-loupe" id="headerSearchButton" title="Rechercher par date">
                        üîç
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Sidebar gauche √©largie √† 45% -->
        <div class="sidebar">
            <div class="stats-section">
                <h3 style="margin-bottom: 15px; color: var(--secondary-color); text-align: center;">üìä Statistiques</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalHebergements">0</div>
                        <div class="stat-label">H√©bergements total</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalHotes">0</div>
                        <div class="stat-label">H√¥tes diff√©rents</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalPays">0</div>
                        <div class="stat-label">Pays diff√©rents</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalLieux">0</div>
                        <div class="stat-label">Lieux diff√©rents</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalHeberges">0</div>
                        <div class="stat-label">Personnes h√©berg√©es</div>
                    </div>
                </div>
            </div>
            
            <div class="lists-section">
                <h3 style="margin-bottom: 15px; color: var(--secondary-color); text-align: center;">üìã Listes organis√©es</h3>
                
                <div class="lists-container">
                    <div class="list-card">
                        <div class="list-header" id="hotesHeader">
                            <span>üë§ H√¥tes (<span id="hotesCount">0</span>)</span>
                            <span class="toggle-icon collapsed">‚ñ∂</span>
                        </div>
                        <div class="list-content collapsed" id="hotesList">
                            <!-- Liste des h√¥tes g√©n√©r√©e ici -->
                        </div>
                    </div>
                    
                    <div class="list-card">
                        <div class="list-header pays" id="paysHeader">
                            <span>üåç Pays (<span id="paysCount">0</span>)</span>
                            <span class="toggle-icon collapsed">‚ñ∂</span>
                        </div>
                        <div class="list-content collapsed" id="paysList">
                            <!-- Liste des pays g√©n√©r√©e ici -->
                        </div>
                    </div>
                    
                    <div class="list-card">
                        <div class="list-header lieux" id="lieuxHeader">
                            <span>üìç Lieux (<span id="lieuxCount">0</span>)</span>
                            <span class="toggle-icon collapsed">‚ñ∂</span>
                        </div>
                        <div class="list-content collapsed" id="lieuxList">
                            <!-- Liste des lieux g√©n√©r√©e ici -->
                        </div>
                    </div>
                    
                    <div class="list-card">
                        <div class="list-header heberges" id="hebergesHeader">
                            <span>üë• Personnes h√©berg√©es (<span id="hebergesCount">0</span>)</span>
                            <span class="toggle-icon collapsed">‚ñ∂</span>
                        </div>
                        <div class="list-content collapsed" id="hebergesList">
                            <!-- Liste des personnes h√©berg√©es g√©n√©r√©e ici -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Contenu principal -->
        <div class="main-content">
            <section class="search-section">
                <form id="searchForm" class="search-form" autocomplete="off">
                    <div class="date-input-container">
                        <input type="date" id="dateInput">
                    </div>
                    <button type="submit" class="search-button">üîç Rechercher par date</button>
                </form>
                
                <!-- Boutons sur la m√™me ligne - MODIFI√â pour mobile -->
                <div class="buttons-row">
                    <button id="showAllButton" class="search-button" style="background: linear-gradient(135deg, #27ae60, #219a53);">
                        üìã Afficher tous les h√©bergements
                    </button>
                    
                    <button id="showPrieresButton" class="search-button" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                        üôè Afficher les sujets de pri√®re
                    </button>
                    
                    <button id="sendEmailsButton" class="search-button disabled" style="background: linear-gradient(135deg, #3498db, #2980b9);">
                        üìß Envoyer un email de remerciements
                    </button>
                </div>
                
                <!-- Filtres 2 par 2 - MODIFI√â -->
                <div class="filters-section">
                    <div class="filter-group">
                        <h3>üë§ H√¥tes</h3>
                        <div class="filter-tags" id="hotesTags">
                            <!-- Les h√¥tes seront g√©n√©r√©s ici -->
                        </div>
                    </div>
                    
                    <div class="filter-group">
                        <h3>üåç Pays</h3>
                        <div class="filter-tags" id="paysTags">
                            <!-- Les pays seront g√©n√©r√©s ici -->
                        </div>
                    </div>
                    
                    <div class="filter-group">
                        <h3>üìç Lieux</h3>
                        <div class="filter-tags" id="lieuxTags">
                            <!-- Les lieux seront g√©n√©r√©s ici -->
                        </div>
                    </div>
                    
                    <div class="filter-group">
                        <h3>üë• Personnes h√©berg√©es</h3>
                        <div class="filter-tags" id="hebergesTags">
                            <!-- Les personnes h√©berg√©es seront g√©n√©r√©s ici -->
                        </div>
                    </div>
                </div>
                
                <button id="retryButton" style="background: linear-gradient(135deg, #f39c12, #e67e22); margin-top: 10px; width: 100%; display: none;">
                    üîÑ R√©essayer le chargement
                </button>
            </section>
            
            <!-- Calendrier au-dessus des r√©sultats -->
            <div class="calendar-section">
                <div class="calendar-header">
                    <h3>üìÖ Calendrier des h√©bergements</h3>
                    <div class="calendar-nav">
                        <button id="prevMonth">‚óÄ</button>
                        <span id="currentMonth">Mois en cours</span>
                        <button id="nextMonth">‚ñ∂</button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                    <!-- Le calendrier sera g√©n√©r√© ici -->
                </div>
            </div>
            
            <div class="loading" id="loadingIndicator">
                <div class="spinner"></div>
                <p>Chargement des donn√©es depuis Google Sheets...</p>
            </div>

            <div id="dataInfo" class="data-info"></div>
            
            <section class="results-section" id="resultsSection" style="display: none;">
                <div class="result-header">
                    <h2 id="resultTitle">R√©sultats de la recherche</h2>
                    <button id="closeResults" style="background: none; border: none; color: white; font-size: 1.2em; cursor: pointer;">‚úï Fermer</button>
                </div>
                <div class="result-content" id="resultContent">
                    <!-- Les r√©sultats seront affich√©s ici -->
                </div>
            </section>
        </div>
    </div>

    <!-- Modale pour l'exportation -->
    <div id="exportModal" class="export-modal">
        <div class="export-modal-content">
            <h3 style="margin-bottom: 20px; color: var(--secondary-color);">üì§ Exporter les donn√©es</h3>
            
            <div class="export-options">
                <div class="export-type" id="exportType1">
                    <div class="export-type-title">
                        <span>üìã</span>
                        <span>Liste de tous les h√©bergeurs</span>
                    </div>
                    <div class="export-type-description">
                        Exporte tous les h√©bergeurs avec leurs informations compl√®tes (nom, coordonn√©es, adresse, etc.)
                    </div>
                </div>
                
                <div class="export-type" id="exportType2">
                    <div class="export-type-title">
                        <span>üåç</span>
                        <span>Liste par pays des h√©bergeurs</span>
                    </div>
                    <div class="export-type-description">
                        Exporte les h√©bergeurs organis√©s par pays avec leurs informations de contact
                    </div>
                </div>
            </div>
            
            <div class="export-format-options" id="formatOptions" style="display: none;">
                <div class="format-option" data-format="csv">CSV</div>
                <div class="format-option" data-format="excel">Excel</div>
                <div class="format-option" data-format="pdf">PDF</div>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button id="cancelExport" style="padding: 10px 20px; background: #95a5a6; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Annuler
                </button>
                <button id="confirmExport" style="padding: 10px 20px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer; display: none;">
                    üì§ Exporter
                </button>
            </div>
        </div>
    </div>

    <!-- Modale pour le mot de passe admin -->
    <div id="passwordModal" class="password-modal">
        <div class="password-modal-content">
            <h3 style="margin-bottom: 20px; color: var(--secondary-color);">üîê Acc√®s administrateur requis</h3>
            
            <p style="margin-bottom: 15px;">Veuillez entrer le mot de passe pour acc√©der √† la fonction d'export :</p>
            
            <input type="password" id="adminPassword" class="password-input" placeholder="Mot de passe" autocomplete="off">
            
            <div id="passwordError" style="color: #e74c3c; margin-bottom: 15px; display: none;">
                ‚ùå Mot de passe incorrect
            </div>
            
            <div class="password-buttons">
                <button id="cancelPassword" style="padding: 10px 20px; background: #95a5a6; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Annuler
                </button>
                <button id="submitPassword" style="padding: 10px 20px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Valider
                </button>
            </div>
        </div>
    </div>

    <!-- Modale pour l'envoi d'emails -->
    <div id="emailModal" class="email-modal">
        <div class="email-modal-content">
            <h3 style="margin-bottom: 20px; color: var(--secondary-color);">üìß Envoi d'email de remerciements</h3>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: bold;">Destinataires avec email:</label>
                <div id="emailRecipients" class="email-recipients">
                    <!-- Liste des destinataires g√©n√©r√©e ici -->
                </div>
                <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
                    <span id="recipientCount">0</span> destinataire(s) s√©lectionn√©(s)
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: bold;">Sujet:</label>
                <input type="text" id="emailSubject" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" 
                       value="Remerciements pour votre hospitalit√© - Tourn√©e 2026">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: bold;">Message:</label>
                <textarea id="emailMessage" style="width: 100%; height: 200px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-family: inherit;">Cher/ch√®re [Nom],

Nous tenons √† vous remercier chaleureusement pour votre g√©n√©reux accueil et votre hospitalit√© durant notre tourn√©e 2026. Votre soutien a √©t√© pr√©cieux pour nous.

Nous gardons un excellent souvenir de notre s√©jour chez vous et esp√©rons avoir l'occasion de vous revoir bient√¥t.

Avec toute notre gratitude,

L'√©quipe de la Tourn√©e 2026</textarea>
            </div>

            <div class="upload-section">
                <h4 style="margin-bottom: 15px; color: #3498db;">üì∏ Ajouter des photos √† l'email</h4>
                
                <div class="upload-area">
                    <input type="file" id="photoUpload" multiple accept="image/*" style="display: none;">
                    <button type="button" id="uploadButton" class="upload-button">
                        üìÅ Choisir des photos
                    </button>
                    <div class="upload-instructions">
                        Formats accept√©s: JPG, PNG, GIF (max 5MB par photo)
                    </div>
                </div>
                
                <div id="photosPreview" class="photos-preview">
                    <!-- Aper√ßu des photos upload√©es -->
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; flex-wrap: wrap;">
                <button id="cancelEmail" style="padding: 10px 20px; background: #95a5a6; color: white; border: none; border-radius: 5px; cursor: pointer;">Annuler</button>
                <button id="copyEmails" style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">üìã Copier les adresses</button>
                <button id="sendEmails" style="padding: 10px 20px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer;">üìß Envoyer les emails</button>
            </div>
        </div>
    </div>

    <script>
        // URL de la feuille Google Sheets pour les h√©bergements
        const GOOGLE_SHEETS_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSXIJyclDLf2asT-FMnmaeWMSPtQHxpAC1wiGJ_xzXbl2StziwiUw9ElW9XyK5yemQ-PHaWlRQbtdHb/pub?gid=1650312054&single=true&output=csv';
        
        // Mot de passe admin
        const ADMIN_PASSWORD = "admin";
        
        let sheetData = [];
        let headers = [];
        // Commencer le calendrier au mois en cours
        let currentDate = new Date(); // Mois en cours
        let selectedDate = null;
        let allHotes = [];
        let allPays = [];
        let allLieux = [];
        let allHeberges = new Set();
        let allPrieres = [];
        let bookingPeriods = [];
        let uploadedPhotos = []; // Stocker les photos upload√©es
        let isAdmin = false; // √âtat d'authentification admin
        let selectedExportType = null;
        let selectedExportFormat = null;

        // Index des colonnes (√† d√©tecter automatiquement)
        let colDateDebut = -1;
        let colDateFin = -1;
        let colNom = -1;
        let colPays = -1;
        let colLieu = -1;
        let colAdresse = -1;
        let colEmail = -1;
        let colFacebook = -1;
        let colTelephone = -1;
        let colMpihiraLehilahy = -1;
        let colMpitendry = -1;
        let colFeo1 = -1;
        let colFeo2 = -1;
        let colPriere = -1;
        let colMarquants = -1;
        let colPhotosHotes = -1;
        let colPhotosLieux = -1;
        let colFormulaire = -1;
        let colRepartition = -1;

        // Colonnes pour les informations suppl√©mentaires
        let colAdresseHebergeur = -1;
        let colLieuHebergeur = -1;
        let colPaysHebergeur = -1;
        let colNumeroHebergeur = -1;
        let colHebergeEn = -1;
        let colASavoirHote = -1;

        // √âtat des listes (masqu√©es par d√©faut)
        let listStates = {
            hotes: false,
            pays: false,
            lieux: false,
            heberges: false
        };

        document.addEventListener('DOMContentLoaded', function() {
            // Initialiser les boutons de navigation fixes - MODIFI√â
            document.getElementById('homeButton').addEventListener('click', function() {
                window.scrollTo({ top: 0, behavior: 'smooth' });
                document.getElementById('resultsSection').style.display = 'none';
            });
            
            // Nouveau bouton calendrier
            document.getElementById('calendarButton').addEventListener('click', function() {
                document.querySelector('.calendar-section').scrollIntoView({ behavior: 'smooth' });
            });
            
            document.getElementById('showAllDataButton').addEventListener('click', showAllData);
            document.getElementById('exportDataButton').addEventListener('click', function() {
                if (this.classList.contains('locked')) {
                    checkAdminPasswordForExport();
                } else {
                    showExportModal();
                }
            });
            
            // Recherche depuis le header
            document.getElementById('headerSearchButton').addEventListener('click', function() {
                const dateValue = document.getElementById('headerDateInput').value;
                if (!dateValue) {
                    alert('Veuillez s√©lectionner une date');
                    return;
                }
                const selectedDate = new Date(dateValue);
                searchByDate(selectedDate);
            });
            
            // Entr√©e sur le champ de recherche du header
            document.getElementById('headerDateInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('headerSearchButton').click();
                }
            });
            
            document.getElementById('searchForm').addEventListener('submit', handleSearch);
            document.getElementById('showAllButton').addEventListener('click', showAllData);
            document.getElementById('showPrieresButton').addEventListener('click', showPrieres);
            document.getElementById('sendEmailsButton').addEventListener('click', checkAdminPasswordForEmail);
            document.getElementById('closeResults').addEventListener('click', closeResults);
            document.getElementById('retryButton').addEventListener('click', loadDataFromGoogleSheets);
            
            // Navigation du calendrier
            document.getElementById('prevMonth').addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });
            
            document.getElementById('nextMonth').addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });
            
            // √âv√©nements pour la modale d'exportation
            document.getElementById('cancelExport').addEventListener('click', function() {
                document.getElementById('exportModal').style.display = 'none';
                resetExportModal();
            });
            
            document.getElementById('confirmExport').addEventListener('click', exportData);
            
            // S√©lection du type d'export
            document.getElementById('exportType1').addEventListener('click', function() {
                selectExportType(1);
            });
            
            document.getElementById('exportType2').addEventListener('click', function() {
                selectExportType(2);
            });
            
            // S√©lection du format d'export
            document.querySelectorAll('.format-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.format-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    selectedExportFormat = this.getAttribute('data-format');
                    document.getElementById('confirmExport').style.display = 'block';
                });
            });
            
            // √âv√©nements pour la modale de mot de passe (export)
            document.getElementById('cancelPassword').addEventListener('click', function() {
                document.getElementById('passwordModal').style.display = 'none';
                document.getElementById('adminPassword').value = '';
                document.getElementById('passwordError').style.display = 'none';
            });
            
            document.getElementById('submitPassword').addEventListener('click', function() {
                const password = document.getElementById('adminPassword').value;
                if (password === ADMIN_PASSWORD) {
                    isAdmin = true;
                    document.getElementById('exportDataButton').classList.remove('locked');
                    document.getElementById('exportDataButton').title = "Exporter les donn√©es";
                    document.getElementById('sendEmailsButton').classList.remove('disabled');
                    document.getElementById('sendEmailsButton').disabled = false;
                    document.getElementById('passwordModal').style.display = 'none';
                    document.getElementById('adminPassword').value = '';
                    document.getElementById('passwordError').style.display = 'none';
                    showExportModal();
                } else {
                    document.getElementById('passwordError').style.display = 'block';
                    document.getElementById('adminPassword').value = '';
                }
            });
            
            document.getElementById('adminPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('submitPassword').click();
                }
            });
            
            // √âv√©nements pour la modale d'email
            document.getElementById('cancelEmail').addEventListener('click', function() {
                document.getElementById('emailModal').style.display = 'none';
                clearUploadedPhotos();
            });
            
            document.getElementById('sendEmails').addEventListener('click', sendEmails);
            document.getElementById('copyEmails').addEventListener('click', copyEmailAddresses);
            
            // √âv√©nements pour l'upload de photos
            document.getElementById('uploadButton').addEventListener('click', function() {
                document.getElementById('photoUpload').click();
            });
            
            document.getElementById('photoUpload').addEventListener('change', handlePhotoUpload);
            
            // √âv√©nements pour les listes d√©pliables
            document.getElementById('hotesHeader').addEventListener('click', () => toggleList('hotes'));
            document.getElementById('paysHeader').addEventListener('click', () => toggleList('pays'));
            document.getElementById('lieuxHeader').addEventListener('click', () => toggleList('lieux'));
            document.getElementById('hebergesHeader').addEventListener('click', () => toggleList('heberges'));
            
            // Initialiser l'affichage des listes (masqu√©es par d√©faut)
            initializeLists();
            
            // Charger les donn√©es
            loadDataFromGoogleSheets();
        });

        function checkAdminPasswordForExport() {
            document.getElementById('passwordModal').style.display = 'flex';
            document.getElementById('adminPassword').focus();
        }

        function checkAdminPasswordForEmail() {
            if (isAdmin) {
                showEmailModal();
            } else {
                document.getElementById('passwordModal').style.display = 'flex';
                document.getElementById('adminPassword').focus();
            }
        }

        function showExportModal() {
            if (sheetData.length === 0) {
                alert('Aucune donn√©e √† exporter');
                return;
            }
            
            resetExportModal();
            document.getElementById('exportModal').style.display = 'flex';
        }

        function resetExportModal() {
            selectedExportType = null;
            selectedExportFormat = null;
            document.getElementById('exportType1').classList.remove('selected');
            document.getElementById('exportType2').classList.remove('selected');
            document.querySelectorAll('.format-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.getElementById('formatOptions').style.display = 'none';
            document.getElementById('confirmExport').style.display = 'none';
        }

        function selectExportType(type) {
            selectedExportType = type;
            document.getElementById('exportType1').classList.remove('selected');
            document.getElementById('exportType2').classList.remove('selected');
            document.getElementById('exportType' + type).classList.add('selected');
            document.getElementById('formatOptions').style.display = 'flex';
            document.getElementById('confirmExport').style.display = 'none';
        }

        function exportData() {
            if (!selectedExportType || !selectedExportFormat) {
                alert('Veuillez s√©lectionner un type et un format d\'exportation');
                return;
            }
            
            document.getElementById('exportModal').style.display = 'none';
            
            let exportData = [];
            let filename = '';
            let mimeType = '';
            let content = '';
            
            if (selectedExportType === 1) {
                // Export de tous les h√©bergeurs avec leurs informations
                filename = 'liste_tous_hebergeurs';
                
                // Cr√©er les en-t√™tes pour l'export
                const exportHeaders = ['Nom', 'Email', 'T√©l√©phone', 'Facebook', 'Adresse', 'Lieu', 'Pays', 'Date D√©but', 'Date Fin'];
                
                // R√©cup√©rer tous les h√©bergeurs uniques
                const uniqueHebergeurs = new Map();
                
                sheetData.forEach((row, index) => {
                    const nom = colNom !== -1 ? row[colNom] : '';
                    const email = colEmail !== -1 ? row[colEmail] : '';
                    const telephone = colTelephone !== -1 ? row[colTelephone] : '';
                    const facebook = colFacebook !== -1 ? row[colFacebook] : '';
                    const adresse = colAdresse !== -1 ? row[colAdresse] : '';
                    const lieu = colLieu !== -1 ? row[colLieu] : '';
                    const pays = colPays !== -1 ? row[colPays] : '';
                    const dateDebut = colDateDebut !== -1 ? row[colDateDebut] : '';
                    const dateFin = colDateFin !== -1 ? row[colDateFin] : '';
                    
                    if (nom && nom.trim()) {
                        const key = nom.trim().toLowerCase();
                        if (!uniqueHebergeurs.has(key)) {
                            uniqueHebergeurs.set(key, {
                                nom: nom.trim(),
                                email: email ? email.trim() : '',
                                telephone: telephone ? telephone.trim() : '',
                                facebook: facebook ? facebook.trim() : '',
                                adresse: adresse ? adresse.trim() : '',
                                lieu: lieu ? lieu.trim() : '',
                                pays: pays ? pays.trim() : '',
                                dates: dateDebut && dateFin ? `${dateDebut} au ${dateFin}` : ''
                            });
                        }
                    }
                });
                
                // Convertir en tableau pour l'export
                exportData = Array.from(uniqueHebergeurs.values());
                
                if (selectedExportFormat === 'csv' || selectedExportFormat === 'excel') {
                    // Cr√©er le CSV
                    let csvContent = exportHeaders.join(',') + '\n';
                    
                    exportData.forEach(item => {
                        const row = [
                            `"${item.nom}"`,
                            `"${item.email}"`,
                            `"${item.telephone}"`,
                            `"${item.facebook}"`,
                            `"${item.adresse}"`,
                            `"${item.lieu}"`,
                            `"${item.pays}"`,
                            `"${item.dates}"`
                        ];
                        csvContent += row.join(',') + '\n';
                    });
                    
                    content = csvContent;
                    filename += '.csv';
                    mimeType = 'text/csv;charset=utf-8;';
                    
                } else if (selectedExportFormat === 'pdf') {
                    // Cr√©er le PDF (version simplifi√©e - ouvre une nouvelle fen√™tre)
                    const printWindow = window.open('', '_blank');
                    let pdfContent = `
                        <!DOCTYPE html>
                        <html>
                        <head>
                            <title>Liste de tous les h√©bergeurs - Tourn√©e 2026</title>
                            <style>
                                body { font-family: Arial, sans-serif; margin: 20px; }
                                h1 { color: #8b0000; text-align: center; margin-bottom: 30px; }
                                table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                                th { background-color: #8b0000; color: white; padding: 12px; text-align: left; }
                                td { padding: 10px; border: 1px solid #ddd; }
                                tr:nth-child(even) { background-color: #f9f9f9; }
                            </style>
                        </head>
                        <body>
                            <h1>üìã Liste de tous les h√©bergeurs - Tourn√©e 2026</h1>
                            <p>Export g√©n√©r√© le ${new Date().toLocaleDateString('fr-FR')}</p>
                            <table>
                                <thead>
                                    <tr>
                                        ${exportHeaders.map(header => `<th>${header}</th>`).join('')}
                                    </tr>
                                </thead>
                                <tbody>
                                    ${exportData.map(item => `
                                        <tr>
                                            <td>${item.nom}</td>
                                            <td>${item.email}</td>
                                            <td>${item.telephone}</td>
                                            <td>${item.facebook}</td>
                                            <td>${item.adresse}</td>
                                            <td>${item.lieu}</td>
                                            <td>${item.pays}</td>
                                            <td>${item.dates}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </body>
                        </html>
                    `;
                    
                    printWindow.document.write(pdfContent);
                    printWindow.document.close();
                    printWindow.print();
                    return;
                }
                
            } else if (selectedExportType === 2) {
                // Export par pays
                filename = 'liste_hebergeurs_par_pays';
                
                // Organiser par pays
                const hebergeursParPays = {};
                
                sheetData.forEach((row, index) => {
                    const nom = colNom !== -1 ? row[colNom] : '';
                    const pays = colPays !== -1 ? row[colPays] : '';
                    const email = colEmail !== -1 ? row[colEmail] : '';
                    const telephone = colTelephone !== -1 ? row[colTelephone] : '';
                    const adresse = colAdresse !== -1 ? row[colAdresse] : '';
                    const lieu = colLieu !== -1 ? row[colLieu] : '';
                    const dateDebut = colDateDebut !== -1 ? row[colDateDebut] : '';
                    const dateFin = colDateFin !== -1 ? row[colDateFin] : '';
                    
                    if (pays && pays.trim() && nom && nom.trim()) {
                        const paysKey = pays.trim();
                        
                        if (!hebergeursParPays[paysKey]) {
                            hebergeursParPays[paysKey] = [];
                        }
                        
                        const hebergeurKey = nom.trim().toLowerCase();
                        const existeDeja = hebergeursParPays[paysKey].some(h => 
                            h.nom.toLowerCase() === hebergeurKey
                        );
                        
                        if (!existeDeja) {
                            hebergeursParPays[paysKey].push({
                                nom: nom.trim(),
                                email: email ? email.trim() : '',
                                telephone: telephone ? telephone.trim() : '',
                                adresse: adresse ? adresse.trim() : '',
                                lieu: lieu ? lieu.trim() : '',
                                dates: dateDebut && dateFin ? `${dateDebut} au ${dateFin}` : ''
                            });
                        }
                    }
                });
                
                if (selectedExportFormat === 'csv' || selectedExportFormat === 'excel') {
                    // Cr√©er le CSV
                    let csvContent = 'Pays,Nom,Email,T√©l√©phone,Adresse,Lieu,Dates\n';
                    
                    Object.keys(hebergeursParPays).sort().forEach(pays => {
                        hebergeursParPays[pays].forEach(hebergeur => {
                            const row = [
                                `"${pays}"`,
                                `"${hebergeur.nom}"`,
                                `"${hebergeur.email}"`,
                                `"${hebergeur.telephone}"`,
                                `"${hebergeur.adresse}"`,
                                `"${hebergeur.lieu}"`,
                                `"${hebergeur.dates}"`
                            ];
                            csvContent += row.join(',') + '\n';
                        });
                    });
                    
                    content = csvContent;
                    filename += '.csv';
                    mimeType = 'text/csv;charset=utf-8;';
                    
                } else if (selectedExportFormat === 'pdf') {
                    // Cr√©er le PDF (version simplifi√©e - ouvre une nouvelle fen√™tre)
                    const printWindow = window.open('', '_blank');
                    let pdfContent = `
                        <!DOCTYPE html>
                        <html>
                        <head>
                            <title>Liste des h√©bergeurs par pays - Tourn√©e 2026</title>
                            <style>
                                body { font-family: Arial, sans-serif; margin: 20px; }
                                h1 { color: #8b0000; text-align: center; margin-bottom: 30px; }
                                h2 { color: #2c3e50; margin-top: 30px; padding-bottom: 10px; border-bottom: 2px solid #3498db; }
                                table { width: 100%; border-collapse: collapse; margin-top: 10px; }
                                th { background-color: #27ae60; color: white; padding: 12px; text-align: left; }
                                td { padding: 10px; border: 1px solid #ddd; }
                                tr:nth-child(even) { background-color: #f9f9f9; }
                                .country-section { margin-bottom: 40px; }
                            </style>
                        </head>
                        <body>
                            <h1>üåç Liste des h√©bergeurs par pays - Tourn√©e 2026</h1>
                            <p>Export g√©n√©r√© le ${new Date().toLocaleDateString('fr-FR')}</p>
                    `;
                    
                    Object.keys(hebergeursParPays).sort().forEach(pays => {
                        pdfContent += `
                            <div class="country-section">
                                <h2>${pays}</h2>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Nom</th>
                                            <th>Email</th>
                                            <th>T√©l√©phone</th>
                                            <th>Adresse</th>
                                            <th>Lieu</th>
                                            <th>Dates</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${hebergeursParPays[pays].map(hebergeur => `
                                            <tr>
                                                <td>${hebergeur.nom}</td>
                                                <td>${hebergeur.email}</td>
                                                <td>${hebergeur.telephone}</td>
                                                <td>${hebergeur.adresse}</td>
                                                <td>${hebergeur.lieu}</td>
                                                <td>${hebergeur.dates}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        `;
                    });
                    
                    pdfContent += `</body></html>`;
                    
                    printWindow.document.write(pdfContent);
                    printWindow.document.close();
                    printWindow.print();
                    return;
                }
            }
            
            // T√©l√©charger le fichier pour CSV/Excel
            downloadFile(content, filename, mimeType);
            resetExportModal();
        }

        // Fonction pour t√©l√©charger un fichier
        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.setAttribute('download', filename);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert(`Fichier ${filename} t√©l√©charg√© avec succ√®s!`);
        }

        function initializeLists() {
            Object.keys(listStates).forEach(listType => {
                const content = document.getElementById(`${listType}List`);
                const icon = document.getElementById(`${listType}Header`).querySelector('.toggle-icon');
                
                content.classList.add('collapsed');
                icon.classList.add('collapsed');
            });
        }

        function toggleList(listType) {
            const header = document.getElementById(`${listType}Header`);
            const content = document.getElementById(`${listType}List`);
            const icon = header.querySelector('.toggle-icon');
            
            listStates[listType] = !listStates[listType];
            
            if (listStates[listType]) {
                content.classList.remove('collapsed');
                icon.classList.remove('collapsed');
            } else {
                content.classList.add('collapsed');
                icon.classList.add('collapsed');
            }
        }

        function handlePhotoUpload(event) {
            const files = event.target.files;
            if (files.length === 0) return;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                if (file.size > 5 * 1024 * 1024) {
                    alert(`La photo "${file.name}" est trop volumineuse. Maximum 5MB.`);
                    continue;
                }
                
                if (!file.type.startsWith('image/')) {
                    alert(`Le fichier "${file.name}" n'est pas une image valide.`);
                    continue;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const photoData = {
                        name: file.name,
                        size: formatFileSize(file.size),
                        data: e.target.result,
                        type: file.type
                    };
                    
                    uploadedPhotos.push(photoData);
                    renderPhotoPreview();
                };
                
                reader.readAsDataURL(file);
            }
            
            event.target.value = '';
        }

        function renderPhotoPreview() {
            const previewContainer = document.getElementById('photosPreview');
            previewContainer.innerHTML = '';
            
            if (uploadedPhotos.length === 0) {
                previewContainer.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">Aucune photo s√©lectionn√©e</div>';
                return;
            }
            
            uploadedPhotos.forEach((photo, index) => {
                const photoElement = document.createElement('div');
                photoElement.className = 'photo-preview';
                photoElement.innerHTML = `
                    <img src="${photo.data}" alt="${photo.name}">
                    <button class="remove-photo" onclick="removePhoto(${index})">√ó</button>
                    <div class="photo-info">${photo.name}<br>${photo.size}</div>
                `;
                previewContainer.appendChild(photoElement);
            });
        }

        function removePhoto(index) {
            uploadedPhotos.splice(index, 1);
            renderPhotoPreview();
        }

        function clearUploadedPhotos() {
            uploadedPhotos = [];
            renderPhotoPreview();
            document.getElementById('photoUpload').value = '';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function sendEmails() {
            const checkboxes = document.querySelectorAll('.recipient-checkbox:checked');
            const subject = document.getElementById('emailSubject').value;
            const message = document.getElementById('emailMessage').value;
            
            if (checkboxes.length === 0) {
                alert('Veuillez s√©lectionner au moins un destinataire');
                return;
            }
            
            // R√©cup√©rer les emails s√©lectionn√©s
            const emails = [];
            checkboxes.forEach(checkbox => {
                const index = parseInt(checkbox.getAttribute('data-index'));
                const hote = sheetData.filter(row => {
                    const email = colEmail !== -1 ? row[colEmail] : '';
                    const nom = colNom !== -1 ? row[colNom] : '';
                    return email && email.trim() && nom && nom.trim();
                })[index];
                
                if (hote) {
                    emails.push({
                        nom: hote[colNom],
                        email: hote[colEmail]
                    });
                }
            });
            
            // Pr√©parer le corps de l'email avec les photos
            let emailBody = message;
            
            if (uploadedPhotos.length > 0) {
                emailBody += '\n\n---\nüì∏ Photos jointes √† cet email :\n';
                uploadedPhotos.forEach(photo => {
                    emailBody += `‚Ä¢ ${photo.name} (${photo.size})\n`;
                });
                emailBody += '\nLes photos sont jointes √† cet email.';
            }
            
            const encodedBody = encodeURIComponent(emailBody);
            const encodedSubject = encodeURIComponent(subject);
            
            const emailRecipients = emails.map(e => e.email).join(',');
            
            const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&to=${emailRecipients}&su=${encodedSubject}&body=${encodedBody}`;
            
            window.open(gmailUrl, '_blank');
            
            if (uploadedPhotos.length > 0) {
                setTimeout(() => {
                    alert(`${emails.length} email(s) pr√©par√©(s) pour envoi.\n\nüì∏ IMPORTANT: Les photos doivent √™tre ajout√©es manuellement en pi√®ces jointes dans votre client email.\n\nPhotos √† attacher:\n${uploadedPhotos.map(p => `‚Ä¢ ${p.name}`).join('\n')}`);
                }, 1000);
            } else {
                alert(`${emails.length} email(s) pr√©par√©(s) pour envoi. V√©rifiez les destinataires avant d'envoyer.`);
            }
            
            document.getElementById('emailModal').style.display = 'none';
            clearUploadedPhotos();
        }

        async function loadDataFromGoogleSheets() {
            console.log('üîç D√©but du chargement des donn√©es...');
            document.getElementById('loadingIndicator').style.display = 'block';
            document.getElementById('retryButton').style.display = 'none';
            clearErrorMessages();
            
            try {
                console.log('üîÑ Essai 1: Acc√®s direct...');
                let response = await fetch(GOOGLE_SHEETS_URL);
                
                if (response.ok) {
                    const csvText = await response.text();
                    console.log('‚úÖ Succ√®s avec acc√®s direct');
                    processCSVData(csvText);
                    return;
                }
                throw new Error(`Direct failed: ${response.status}`);
                
            } catch (error1) {
                console.log('‚ùå √âchec acc√®s direct:', error1.message);
                
                try {
                    console.log('üîÑ Essai 2: AllOrigins...');
                    const proxyUrl = 'https://api.allorigins.win/raw?url=';
                    let response = await fetch(proxyUrl + encodeURIComponent(GOOGLE_SHEETS_URL));
                    
                    if (response.ok) {
                        const csvText = await response.text();
                        console.log('‚úÖ Succ√®s avec AllOrigins');
                        processCSVData(csvText);
                        return;
                    }
                    throw new Error(`AllOrigins failed: ${response.status}`);
                    
                } catch (error2) {
                    console.log('‚ùå √âchec AllOrigins:', error2.message);
                    showError('Impossible de charger les donn√©es. V√©rifiez votre connexion internet.');
                }
            }
        }

        function parseCSVWithNewlines(csvText) {
            console.log('üîÑ Parsing CSV avec gestion des retours √† la ligne...');
            
            const lines = [];
            let currentLine = [];
            let currentField = '';
            let inQuotes = false;
            let quoteChar = '"';
            
            for (let i = 0; i < csvText.length; i++) {
                const char = csvText[i];
                const nextChar = csvText[i + 1];
                
                if (char === quoteChar) {
                    if (inQuotes && nextChar === quoteChar) {
                        currentField += quoteChar;
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    currentLine.push(currentField);
                    currentField = '';
                } else if (char === '\n' && !inQuotes) {
                    currentLine.push(currentField);
                    lines.push(currentLine);
                    currentLine = [];
                    currentField = '';
                } else if (char === '\r') {
                    if (nextChar === '\n' && !inQuotes) {
                        currentLine.push(currentField);
                        lines.push(currentLine);
                        currentLine = [];
                        currentField = '';
                        i++;
                    }
                } else {
                    currentField += char;
                }
            }
            
            if (currentField !== '' || currentLine.length > 0) {
                currentLine.push(currentField);
                lines.push(currentLine);
            }
            
            console.log(`‚úÖ Parsing termin√©: ${lines.length} lignes d√©tect√©es`);
            return lines;
        }
        
        function processCSVData(csvText) {
            try {
                console.log('üìÑ Traitement des donn√©es CSV...');
                
                if (!csvText || csvText.trim().length === 0) {
                    throw new Error('Le fichier CSV est vide');
                }
                
                const lines = parseCSVWithNewlines(csvText);
                
                if (!lines || lines.length === 0) {
                    throw new Error('Aucune donn√©e pars√©e');
                }
                
                headers = lines[0] || [];
                console.log('üè∑Ô∏è En-t√™tes d√©tect√©s:', headers);
                
                detectColumns();
                
                sheetData = lines.slice(1).filter(row => 
                    row && row.some(cell => cell && cell.trim() !== '')
                );
                
                console.log('üìà Donn√©es extraites:', sheetData.length, 'h√©bergements');
                
                if (sheetData.length === 0) {
                    throw new Error('Aucun h√©bergement avec des donn√©es trouv√©');
                }
                
                normalizeData();
                extractAllData();
                updateStats();
                renderFilterTags();
                renderCalendar();
                renderOrganizedLists();
                showDataInfo();
                
            } catch (error) {
                console.error('‚ùå Erreur de traitement:', error);
                showError(error.message);
            } finally {
                document.getElementById('loadingIndicator').style.display = 'none';
            }
        }
        
        function detectColumns() {
            headers.forEach((header, index) => {
                const lowerHeader = header.toLowerCase();
                
                if (lowerHeader.includes('date d√©but') || lowerHeader.includes('date debut')) {
                    colDateDebut = index;
                    console.log('üìÖ Colonne Date d√©but d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('date fin')) {
                    colDateFin = index;
                    console.log('üìÖ Colonne Date fin d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('nom') && !lowerHeader.includes('facebook') && !lowerHeader.includes('r√©seau')) {
                    colNom = index;
                    console.log('üë§ Colonne Nom d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('pays')) {
                    colPays = index;
                    console.log('üåç Colonne Pays d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('lieu:')) {
                    colLieu = index;
                    console.log('üìç Colonne Lieu: d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('adresse') && !lowerHeader.includes('e-mail')) {
                    colAdresse = index;
                    console.log('üè† Colonne Adresse d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('e-mail') || lowerHeader.includes('email')) {
                    colEmail = index;
                    console.log('üìß Colonne Email d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('facebook') || lowerHeader.includes('r√©seau')) {
                    colFacebook = index;
                    console.log('üë• Colonne Facebook d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('t√©l√©phone') || lowerHeader.includes('telephone') || lowerHeader.includes('whatsapp')) {
                    colTelephone = index;
                    console.log('üì± Colonne T√©l√©phone d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('mpihira lehilahy')) {
                    colMpihiraLehilahy = index;
                    console.log('üé§ Colonne Mpihira Lehilahy d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('mpitendry')) {
                    colMpitendry = index;
                    console.log('üéπ Colonne Mpitendry d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('feo 1')) {
                    colFeo1 = index;
                    console.log('üéµ Colonne Feo 1 d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('feo 2')) {
                    colFeo2 = index;
                    console.log('üéµ Colonne Feo 2 d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('sujet de pri√®re') || lowerHeader.includes('pri√®re')) {
                    colPriere = index;
                    console.log('üôè Colonne Pri√®re d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('marquant')) {
                    colMarquants = index;
                    console.log('‚≠ê Colonne Marquants d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('photos avec les h√¥tes')) {
                    colPhotosHotes = index;
                    console.log('üì∏ Colonne Photos h√¥tes d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('photos des lieux')) {
                    colPhotosLieux = index;
                    console.log('üèûÔ∏è Colonne Photos lieux d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('lien de ce formulaire')) {
                    colFormulaire = index;
                    console.log('üîó Colonne Formulaire d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('r√©partition')) {
                    colRepartition = index;
                    console.log('üë• Colonne R√©partition d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('adresse:') && !lowerHeader.includes('e-mail')) {
                    colAdresseHebergeur = index;
                    console.log('üìç Colonne Adresse h√©bergeur d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('lieu:') && lowerHeader !== 'lieu:') {
                    colLieuHebergeur = index;
                    console.log('üèôÔ∏è Colonne Lieu h√©bergeur d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('pays:') && lowerHeader !== 'pays') {
                    colPaysHebergeur = index;
                    console.log('üåç Colonne Pays h√©bergeur d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('num√©ro:') || lowerHeader.includes('numero:')) {
                    colNumeroHebergeur = index;
                    console.log('üî¢ Colonne Num√©ro h√©bergeur d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('heberg√© en') || lowerHeader.includes('h√©berg√© en')) {
                    colHebergeEn = index;
                    console.log('üè† Colonne Heberg√© en d√©tect√©e:', index);
                }
                else if (lowerHeader.includes('savoir sur le h√¥te') || lowerHeader.includes('savoir sur l\'h√©bergeur') || lowerHeader.includes('√† savoir')) {
                    colASavoirHote = index;
                    console.log('‚ÑπÔ∏è Colonne √Ä savoir sur le h√¥te d√©tect√©e:', index);
                }
            });
        }
        
        function normalizeData() {
            let maxColumns = headers.length;
            sheetData.forEach(row => {
                if (row.length > maxColumns) {
                    maxColumns = row.length;
                }
            });
            
            while (headers.length < maxColumns) {
                headers.push(`Colonne ${headers.length + 1}`);
            }
            
            sheetData.forEach(row => {
                while (row.length < maxColumns) {
                    row.push('');
                }
                if (row.length > maxColumns) {
                    row.length = maxColumns;
                }
            });
            
            console.log(`üìê Donn√©es normalis√©es: ${maxColumns} colonnes`);
        }
        
        function extractAllData() {
            allHotes = new Set();
            allPays = new Set();
            allLieux = new Set();
            allHeberges.clear();
            allPrieres = [];
            bookingPeriods = [];
            
            sheetData.forEach((row, index) => {
                if (colNom !== -1) {
                    const nom = row[colNom] || '';
                    if (nom.trim()) allHotes.add(nom.trim());
                }
                
                if (colPays !== -1) {
                    const pays = row[colPays] || '';
                    if (pays.trim()) allPays.add(pays.trim());
                }
                
                if (colLieu !== -1) {
                    const lieu = row[colLieu] || '';
                    if (lieu.trim()) allLieux.add(lieu.trim());
                }
                
                const colonnesPersonnes = [colMpihiraLehilahy, colMpitendry, colFeo1, colFeo2];
                colonnesPersonnes.forEach(colIndex => {
                    if (colIndex !== -1) {
                        const personnes = row[colIndex] || '';
                        if (personnes.trim()) {
                            personnes.split(',').forEach(p => {
                                const trimmed = p.trim();
                                if (trimmed) allHeberges.add(trimmed);
                            });
                        }
                    }
                });
                
                if (colPriere !== -1) {
                    const priere = row[colPriere] || '';
                    if (priere.trim()) {
                        allPrieres.push({
                            hote: row[colNom] || 'Anonyme',
                            priere: priere,
                            rowIndex: index
                        });
                    }
                }
                
                if (colDateDebut !== -1 && colDateFin !== -1) {
                    const dateDebut = parseDate(row[colDateDebut]);
                    const dateFin = parseDate(row[colDateFin]);
                    
                    if (dateDebut && dateFin) {
                        bookingPeriods.push({
                            start: dateDebut,
                            end: new Date(dateFin.getTime() - 24 * 60 * 60 * 1000),
                            rowIndex: index
                        });
                    }
                }
            });
            
            allHotes = Array.from(allHotes).sort();
            allPays = Array.from(allPays).sort();
            allLieux = Array.from(allLieux).sort();
            allHeberges = Array.from(allHeberges).sort();
            
            console.log('üë§ H√¥tes extraits:', allHotes.length);
            console.log('üåç Pays extraits:', allPays.length);
            console.log('üìç Lieux extraits:', allLieux.length);
            console.log('üë• Personnes h√©berg√©es extraites:', allHeberges.length);
            console.log('üôè Pri√®res extraites:', allPrieres.length);
            console.log('üìÖ P√©riodes de r√©servation:', bookingPeriods.length);
        }
        
        function updateStats() {
            document.getElementById('totalHebergements').textContent = sheetData.length;
            document.getElementById('totalHotes').textContent = allHotes.length;
            document.getElementById('totalPays').textContent = allPays.length;
            document.getElementById('totalLieux').textContent = allLieux.length;
            document.getElementById('totalHeberges').textContent = allHeberges.length;
        }
        
        function renderFilterTags() {
            renderTags('hotesTags', allHotes, 'nom');
            renderTags('paysTags', allPays, 'pays');
            renderTags('lieuxTags', allLieux, 'lieu');
            renderTags('hebergesTags', allHeberges, 'heberge');
        }
        
        function renderTags(containerId, items, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if (items.length === 0) {
                container.innerHTML = '<div style="color: #7f8c8d; font-style: italic;">Aucun ' + type + ' trouv√©</div>';
                return;
            }
            
            items.forEach(item => {
                const tag = document.createElement('div');
                tag.className = `tag ${type}`;
                tag.textContent = item;
                tag.title = `Filtrer par ${type}: ${item}`;
                
                tag.addEventListener('click', () => {
                    if (type === 'heberge') {
                        const results = filterByHeberge(item);
                        displayResults(results, `Personne h√©berg√©e: ${item}`);
                    } else {
                        const results = filterDataByType(item, type);
                        displayResults(results, `${type.charAt(0).toUpperCase() + type.slice(1)}: ${item}`);
                    }
                });
                
                container.appendChild(tag);
            });
        }
        
        function renderOrganizedLists() {
            document.getElementById('hotesCount').textContent = allHotes.length;
            document.getElementById('paysCount').textContent = allPays.length;
            document.getElementById('lieuxCount').textContent = allLieux.length;
            document.getElementById('hebergesCount').textContent = allHeberges.length;
            
            renderList('hotesList', allHotes, 'nom');
            renderList('paysList', allPays, 'pays');
            renderList('lieuxList', allLieux, 'lieu');
            renderList('hebergesList', allHeberges, 'heberge');
        }

        function renderList(containerId, items, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if (items.length === 0) {
                container.innerHTML = '<div style="color: #7f8c8d; font-style: italic; padding: 10px; text-align: center;">Aucun ' + type + ' trouv√©</div>';
                return;
            }
            
            items.forEach((item, index) => {
                const listItem = document.createElement('div');
                listItem.className = 'list-item';
                listItem.innerHTML = `
                    <span>${item}</span>
                    <span class="list-count">${getItemCount(item, type)}</span>
                `;
                
                listItem.addEventListener('click', () => {
                    if (type === 'heberge') {
                        const results = filterByHeberge(item);
                        displayResults(results, `Personne h√©berg√©e: ${item}`);
                    } else {
                        const results = filterDataByType(item, type);
                        displayResults(results, `${type.charAt(0).toUpperCase() + type.slice(1)}: ${item}`);
                    }
                });
                
                container.appendChild(listItem);
            });
        }

        function getItemCount(item, type) {
            switch(type) {
                case 'nom':
                    return sheetData.filter(row => row[colNom] === item).length;
                case 'pays':
                    return sheetData.filter(row => row[colPays] === item).length;
                case 'lieu':
                    return sheetData.filter(row => row[colLieu] === item).length;
                case 'heberge':
                    return filterByHeberge(item).length;
                default:
                    return 0;
            }
        }
        
        function filterDataByType(value, type) {
            let columnIndex = -1;
            
            switch(type) {
                case 'nom':
                    columnIndex = colNom;
                    break;
                case 'pays':
                    columnIndex = colPays;
                    break;
                case 'lieu':
                    columnIndex = colLieu;
                    break;
            }
            
            if (columnIndex === -1) return [];
            
            return sheetData.filter(row => {
                const cellValue = row[columnIndex] || '';
                return cellValue.includes(value);
            });
        }
        
        function filterByHeberge(nom) {
            return sheetData.filter(row => {
                const colonnesPersonnes = [colMpihiraLehilahy, colMpitendry, colFeo1, colFeo2];
                return colonnesPersonnes.some(colIndex => {
                    if (colIndex === -1) return false;
                    const personnes = row[colIndex] || '';
                    return personnes.toLowerCase().includes(nom.toLowerCase());
                });
            });
        }
        
        function showPrieres() {
            if (allPrieres.length === 0) {
                alert('Aucun sujet de pri√®re trouv√©');
                return;
            }
            
            let html = `
                <div style="margin-bottom: 20px; padding: 15px; background: #ecf0f1; border-radius: 5px;">
                    <strong>${allPrieres.length} sujet(s) de pri√®re trouv√©(s)</strong>
                </div>
            `;
            
            allPrieres.forEach(priere => {
                html += `
                    <div class="fiche-item">
                        <div class="fiche-header">
                            <h2>üôè Sujet de Pri√®re</h2>
                            <h3 class="fiche-title">${priere.hote}</h3>
                        </div>
                        <div class="priere-section">
                            <div class="priere-content">${priere.priere}</div>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('resultContent').innerHTML = html;
            document.getElementById('resultTitle').textContent = 'Sujets de pri√®re';
            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        function showEmailModal() {
            const modal = document.getElementById('emailModal');
            const recipientsContainer = document.getElementById('emailRecipients');
            const recipientCount = document.getElementById('recipientCount');
            
            const hotesAvecEmail = sheetData.filter(row => {
                const email = colEmail !== -1 ? row[colEmail] : '';
                const nom = colNom !== -1 ? row[colNom] : '';
                return email && email.trim() && nom && nom.trim();
            });
            
            const uniqueHotes = [];
            const emailsDejaVus = new Set();
            
            hotesAvecEmail.forEach(hote => {
                const email = hote[colEmail].trim().toLowerCase();
                if (!emailsDejaVus.has(email)) {
                    emailsDejaVus.add(email);
                    uniqueHotes.push(hote);
                }
            });
            
            recipientsContainer.innerHTML = '';
            uniqueHotes.forEach((hote, index) => {
                const recipientDiv = document.createElement('div');
                recipientDiv.className = 'recipient-item';
                recipientDiv.innerHTML = `
                    <input type="checkbox" class="recipient-checkbox" data-index="${index}" checked style="margin-right: 10px;">
                    <div>
                        <strong>${hote[colNom]}</strong><br>
                        <small style="color: #666;">${hote[colEmail]}</small>
                    </div>
                `;
                recipientsContainer.appendChild(recipientDiv);
            });
            
            recipientCount.textContent = uniqueHotes.length;
            modal.style.display = 'flex';
        }

        function copyEmailAddresses() {
            const checkboxes = document.querySelectorAll('.recipient-checkbox:checked');
            const emails = [];
            
            checkboxes.forEach(checkbox => {
                const index = parseInt(checkbox.getAttribute('data-index'));
                const hote = sheetData.filter(row => {
                    const email = colEmail !== -1 ? row[colEmail] : '';
                    const nom = colNom !== -1 ? row[colNom] : '';
                    return email && email.trim() && nom && nom.trim();
                })[index];
                
                if (hote) {
                    emails.push(hote[colEmail]);
                }
            });
            
            if (emails.length === 0) {
                alert('Aucun email √† copier');
                return;
            }
            
            const emailString = emails.join('; ');
            navigator.clipboard.writeText(emailString).then(() => {
                alert(`${emails.length} adresse(s) email copi√©e(s) dans le presse-papier`);
            }).catch(err => {
                console.error('Erreur lors de la copie:', err);
                const textArea = document.createElement('textarea');
                textArea.value = emailString;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert(`${emails.length} adresse(s) email copi√©e(s) dans le presse-papier`);
            });
        }
        
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const monthElement = document.getElementById('currentMonth');
            
            const monthNames = ["Janvier", "F√©vrier", "Mars", "Avril", "Mai", "Juin",
                "Juillet", "Ao√ªt", "Septembre", "Octobre", "Novembre", "D√©cembre"];
            monthElement.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            
            grid.innerHTML = '';
            
            ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'].forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-day-header';
                dayHeader.textContent = day;
                grid.appendChild(dayHeader);
            });
            
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const today = new Date();
            
            let startDay = firstDay.getDay();
            startDay = startDay === 0 ? 6 : startDay - 1;
            
            for (let i = 0; i < startDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day other-month';
                grid.appendChild(emptyDay);
            }
            
            for (let i = 1; i <= lastDay.getDate(); i++) {
                const day = document.createElement('div');
                day.className = 'calendar-day';
                day.textContent = i;
                
                const date = new Date(currentDate.getFullYear(), currentDate.getMonth(), i);
                
                // V√©rifier si c'est aujourd'hui
                if (date.getDate() === today.getDate() && 
                    date.getMonth() === today.getMonth() && 
                    date.getFullYear() === today.getFullYear()) {
                    day.classList.add('today');
                }
                
                const isInBookingPeriod = bookingPeriods.some(period => 
                    date >= period.start && date <= period.end
                );
                
                if (isInBookingPeriod) {
                    day.classList.add('booking-period');
                    day.title = 'P√©riode de r√©servation d\'h√©bergement';
                }
                
                if (selectedDate && 
                    selectedDate.getDate() === date.getDate() &&
                    selectedDate.getMonth() === date.getMonth() &&
                    selectedDate.getFullYear() === date.getFullYear()) {
                    day.classList.add('selected');
                }
                
                day.addEventListener('click', () => {
                    selectDate(date);
                });
                
                grid.appendChild(day);
            }
        }
        
        function selectDate(date) {
            selectedDate = date;
            const matchingRows = findEntriesByDate(date);
            displayResults(matchingRows, `H√©bergements pour le ${formatDateForDisplay(date)}`);
            renderCalendar();
        }
        
        function findEntriesByDate(date) {
            return sheetData.filter((row, index) => {
                if (colDateDebut === -1 || colDateFin === -1) return false;
                
                const dateDebut = parseDate(row[colDateDebut]);
                const dateFin = parseDate(row[colDateFin]);
                
                if (!dateDebut || !dateFin) return false;
                
                const dateFinMinusOne = new Date(dateFin.getTime() - 24 * 60 * 60 * 1000);
                return date >= dateDebut && date <= dateFinMinusOne;
            });
        }
        
        function parseDate(dateString) {
            if (!dateString) return null;
            
            const formats = [
                /^(\d{1,2})\/(\d{1,2})\/(\d{4})$/,
                /^(\d{4})-(\d{1,2})-(\d{1,2})$/,
                /^(\d{1,2})-(\d{1,2})-(\d{4})$/
            ];
            
            for (const format of formats) {
                const match = dateString.match(format);
                if (match) {
                    if (format === formats[0]) {
                        return new Date(match[3], match[2] - 1, match[1]);
                    } else if (format === formats[1]) {
                        return new Date(match[1], match[2] - 1, match[3]);
                    } else if (format === formats[2]) {
                        return new Date(match[3], match[2] - 1, match[1]);
                    }
                }
            }
            
            const parsed = Date.parse(dateString);
            if (!isNaN(parsed)) {
                return new Date(parsed);
            }
            
            console.warn('Impossible de parser la date:', dateString);
            return null;
        }
        
        function formatDateForDisplay(date) {
            return date.toLocaleDateString('fr-FR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        function showDataInfo() {
            const dataInfo = document.getElementById('dataInfo');
            dataInfo.innerHTML = `
                <div class="success-message">
                    ‚úÖ Donn√©es charg√©es avec succ√®s : ${sheetData.length} h√©bergement(s) trouv√©(s)
                    <br><small>${allHotes.length} h√¥tes - ${allPays.length} pays - ${allLieux.length} lieux - ${allHeberges.length} personnes h√©berg√©es</small>
                </div>
            `;
            dataInfo.style.display = 'block';
        }
        
        function showError(message) {
            const searchSection = document.querySelector('.search-section');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.innerHTML = `
                <strong>‚ùå Erreur de chargement:</strong> ${message}
                <br><small>V√©rifiez votre connexion internet et que le Google Sheet est public</small>
            `;
            searchSection.appendChild(errorDiv);
            
            document.getElementById('retryButton').style.display = 'block';
        }
        
        function clearErrorMessages() {
            const errorMessages = document.querySelectorAll('.error-message');
            errorMessages.forEach(msg => msg.remove());
        }
        
        function handleSearch(event) {
            if (event) event.preventDefault();
            
            const dateValue = document.getElementById('dateInput').value;
            
            if (!dateValue) {
                alert('Veuillez s√©lectionner une date');
                return;
            }
            
            if (sheetData.length === 0) {
                alert('Aucune donn√©e charg√©e');
                return;
            }
            
            const selectedDate = new Date(dateValue);
            searchByDate(selectedDate);
        }
        
        function searchByDate(date) {
            const results = findEntriesByDate(date);
            const formattedDate = formatDateForDisplay(date);
            displayResults(results, `H√©bergements pour le ${formattedDate}`);
            
            scrollToDateInCalendar(date);
        }
        
        function scrollToDateInCalendar(date) {
            if (date.getMonth() !== currentDate.getMonth() || date.getFullYear() !== currentDate.getFullYear()) {
                currentDate = new Date(date.getFullYear(), date.getMonth(), 1);
                renderCalendar();
            }
            
            setTimeout(() => {
                const dayElements = document.querySelectorAll('.calendar-day:not(.other-month)');
                dayElements.forEach(dayElement => {
                    if (parseInt(dayElement.textContent) === date.getDate()) {
                        document.querySelectorAll('.calendar-day.selected').forEach(el => {
                            el.classList.remove('selected');
                        });
                        
                        dayElement.classList.add('selected');
                        dayElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                });
            }, 100);
        }
        
        function showAllData() {
            if (sheetData.length === 0) {
                alert('Aucune donn√©e charg√©e');
                return;
            }
            
            displayResults(sheetData, 'Tous les h√©bergements');
        }
        
        function displayResults(results, title) {
            const resultsSection = document.getElementById('resultsSection');
            const resultContent = document.getElementById('resultContent');
            const resultTitle = document.getElementById('resultTitle');
            
            if (results.length === 0) {
                resultContent.innerHTML = `
                    <div class="empty-state">
                        <h3>‚ùå Aucun h√©bergement trouv√©</h3>
                        <p>Aucun h√©bergement ne correspond √† votre recherche</p>
                    </div>
                `;
            } else {
                let html = `
                    <div style="margin-bottom: 20px; padding: 15px; background: #ecf0f1; border-radius: 5px;">
                        <strong>${results.length} h√©bergement(s) trouv√©(s)</strong>
                    </div>
                `;
                
                results.forEach((row, index) => {
                    const numeroData = sheetData.findIndex(r => r === row) + 1;
                    
                    const dateDebut = colDateDebut !== -1 ? row[colDateDebut] : '';
                    const dateFin = colDateFin !== -1 ? row[colDateFin] : '';
                    const nom = colNom !== -1 ? row[colNom] : '';
                    const pays = colPays !== -1 ? row[colPays] : '';
                    const lieu = colLieu !== -1 ? row[colLieu] : '';
                    const adresse = colAdresse !== -1 ? row[colAdresse] : '';
                    const email = colEmail !== -1 ? row[colEmail] : '';
                    const facebook = colFacebook !== -1 ? row[colFacebook] : '';
                    const telephone = colTelephone !== -1 ? row[colTelephone] : '';
                    const mpihiraLehilahy = colMpihiraLehilahy !== -1 ? row[colMpihiraLehilahy] : '';
                    const mpitendry = colMpitendry !== -1 ? row[colMpitendry] : '';
                    const feo1 = colFeo1 !== -1 ? row[colFeo1] : '';
                    const feo2 = colFeo2 !== -1 ? row[colFeo2] : '';
                    const priere = colPriere !== -1 ? row[colPriere] : '';
                    const marquants = colMarquants !== -1 ? row[colMarquants] : '';
                    const photosHotes = colPhotosHotes !== -1 ? row[colPhotosHotes] : '';
                    const photosLieux = colPhotosLieux !== -1 ? row[colPhotosLieux] : '';
                    const formulaire = colFormulaire !== -1 ? row[colFormulaire] : '';
                    const repartition = colRepartition !== -1 ? row[colRepartition] : '';
                    
                    const adresseHebergeur = colAdresseHebergeur !== -1 ? row[colAdresseHebergeur] : '';
                    const lieuHebergeur = colLieuHebergeur !== -1 ? row[colLieuHebergeur] : '';
                    const paysHebergeur = colPaysHebergeur !== -1 ? row[colPaysHebergeur] : '';
                    const numeroHebergeur = colNumeroHebergeur !== -1 ? row[colNumeroHebergeur] : '';
                    
                    const hebergeEn = colHebergeEn !== -1 ? row[colHebergeEn] : '';
                    const aSavoirHote = colASavoirHote !== -1 ? row[colASavoirHote] : '';
                    
                    let adresseComplete = adresseHebergeur || adresse || '';
                    if (adresseComplete && lieuHebergeur) {
                        adresseComplete += ` - ${lieuHebergeur}`;
                    }
                    if (adresseComplete && paysHebergeur) {
                        adresseComplete += ` / ${paysHebergeur}`;
                    }
                    
                    let toutesPersonnes = [];
                    const colonnesPersonnes = [
                        {data: mpihiraLehilahy, type: 'Mpihira Lehilahy'},
                        {data: mpitendry, type: 'Mpitendry'},
                        {data: feo1, type: 'Feo 1'},
                        {data: feo2, type: 'Feo 2'}
                    ];
                    
                    colonnesPersonnes.forEach(col => {
                        if (col.data && col.data.trim()) {
                            col.data.split(',').forEach(p => {
                                const trimmed = p.trim();
                                if (trimmed) toutesPersonnes.push(trimmed);
                            });
                        }
                    });
                    
                    let personnesAffichees = '';
                    let personnesPourTags = [];
                    
                    if (repartition && repartition.trim()) {
                        if (repartition.toLowerCase().includes('tout le monde')) {
                            personnesPourTags = Array.from(allHeberges);
                            personnesAffichees = `Tout le monde / ${personnesPourTags.join(', ')}`;
                        } else {
                            personnesPourTags = toutesPersonnes;
                            personnesAffichees = `${repartition} / ${toutesPersonnes.join(', ')}`;
                        }
                    } else {
                        personnesPourTags = toutesPersonnes;
                        personnesAffichees = toutesPersonnes.join(', ');
                    }
                    
                    const titreFiche = `${dateDebut || '?'} - ${dateFin || '?'} / ${personnesPourTags.length > 0 ? personnesPourTags.join(', ') : 'Aucun h√©berg√©'}`;
                    
                    const isMobile = window.innerWidth <= 768;
                    const gridClass = isMobile ? 'info-grid-mobile' : 'info-grid';
                    
                    html += `
                        <div class="fiche-item">
                            <div class="fiche-header">
                                <h2>üè® H√©bergement Tourn√©e 2026</h2>
                                <h3 class="fiche-title">${titreFiche}</h3>
                            </div>
                            
                            <div class="hote-section">
                                <span class="hote-label">üë§ H√©berg√© chez :</span>
                                <div class="hote-name">${nom || 'H√¥te non sp√©cifi√©'}</div>
                            </div>
                            
                            <div class="${gridClass}">
                                <div class="info-item">
                                    <span class="info-label">üìÖ Date d√©but:</span>
                                    <span class="info-value">${dateDebut || 'Non sp√©cifi√©e'}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">üìÖ Date fin:</span>
                                    <span class="info-value">${dateFin || 'Non sp√©cifi√©e'}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">üìç Lieu:</span>
                                    <span class="info-value">${lieu || 'Non sp√©cifi√©'}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">üåç Pays:</span>
                                    <span class="info-value">${pays || 'Non sp√©cifi√©'}</span>
                                </div>
                            </div>
                            
                            ${hebergeEn ? `
                            <div class="hote-info-section">
                                <div class="hote-info-label">üè† H√©berg√© en:</div>
                                <div class="hote-info-content">${hebergeEn}</div>
                            </div>
                            ` : ''}
                            
                            ${personnesPourTags.length > 0 ? `
                            <div class="heberges-list">
                                <div class="heberges-label">üë• Les h√©berg√©s:</div>
                                <div class="heberges-tags">
                                    ${personnesPourTags.map(p => `<div class="heberge-tag" onclick="filterByHebergeAndShow('${p}')">${p}</div>`).join('')}
                                </div>
                                <div style="margin-top: 10px; font-style: italic; color: #666;">
                                    ${personnesAffichees}
                                </div>
                            </div>
                            ` : ''}
                            
                            ${(adresseComplete || email || facebook || telephone || numeroHebergeur) ? `
                            <div class="contact-section">
                                <div class="contact-label">üìû Information sur ${nom || 'l\'h√©bergeur'}:</div>
                                ${adresseComplete ? `<div style="margin-bottom: 8px;"><strong>üìç Adresse:</strong> ${adresseComplete}</div>` : ''}
                                ${numeroHebergeur ? `<div style="margin-bottom: 8px;"><strong>üî¢ Num√©ro:</strong> ${numeroHebergeur}</div>` : ''}
                                <div style="height: 1px; background: #ddd; margin: 10px 0;"></div>
                                ${email ? `<div style="margin-bottom: 8px;"><strong>üìß Adresse e-mail:</strong> <a href="mailto:${email}" class="contact-link">${email}</a></div>` : ''}
                                ${facebook ? `<div style="margin-bottom: 8px;"><strong>üë• Nom sur Facebook ou autres compte r√©seaux sociaux:</strong> ${facebook}</div>` : ''}
                                ${telephone ? `<div style="margin-bottom: 8px;"><strong>üì± Num√©ro t√©l√©phone/Whatsapp:</strong> <a href="tel:${telephone}" class="contact-link">${telephone}</a></div>` : ''}
                            </div>
                            ` : ''}
                            
                            ${aSavoirHote ? `
                            <div class="hote-info-section">
                                <div class="hote-info-label">‚ÑπÔ∏è √Ä savoir sur le h√¥te/l'h√©bergeur:</div>
                                <div class="hote-info-content">${aSavoirHote}</div>
                            </div>
                            ` : ''}
                            
                            ${(photosHotes || photosLieux || formulaire) ? `
                            <div class="links-section">
                                ${photosHotes ? `<a href="${photosHotes}" target="_blank" class="link-button photos-hotes">üì∏ PHOTOS AVEC LES H√îTES</a>` : ''}
                                ${photosLieux ? `<a href="${photosLieux}" target="_blank" class="link-button photos-lieux">üèûÔ∏è PHOTOS DES LIEUX</a>` : ''}
                                ${formulaire ? `<a href="${formulaire}" target="_blank" class="link-button formulaire">üîó LIEN DE CE FORMULAIRE</a>` : ''}
                            </div>
                            ` : ''}
                            
                            ${marquants ? `
                            <div class="marquants-section">
                                <div class="marquants-label">‚≠ê Marquants:</div>
                                <div class="marquants-content">${marquants}</div>
                            </div>
                            ` : ''}
                            
                            ${priere ? `
                            <div class="priere-section">
                                <div class="priere-label">üôè Sujet de pri√®re:</div>
                                <div class="priere-content">${priere}</div>
                            </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                resultContent.innerHTML = html;
            }
            
            resultTitle.textContent = `${title} (${results.length} h√©bergement${results.length > 1 ? 's' : ''})`;
            resultsSection.style.display = 'block';
            
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        function filterByHebergeAndShow(nom) {
            const results = filterByHeberge(nom);
            displayResults(results, `Personne h√©berg√©e: ${nom}`);
        }
        
        function closeResults() {
            document.getElementById('resultsSection').style.display = 'none';
        }
    </script>
</body>
</html>
